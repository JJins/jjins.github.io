// ==UserScript==
// @name         冰蛙宝鉴
// @namespace    SMTH
// @version      2.9.3
// @description  随时随地通过API接口看你想看！
// @author       bingri[1523812] kaeru[1769499] htys[1545351]
// @match        https://www.torn.com/*.php*
// @grant        none
// ==/UserScript==


!function(){"use strict";const F=window.jQuery,t=window.unsafeWindow||window;if(!t.BINGWA){const Wt=[{name:"foo",title:"阅兵助手",desc:"在部分页面显示阅兵按钮，可以快速获取玩家信息",default:!(t.BINGWA=!0)},{name:"noAssisting",title:"防打重",desc:"如果已有其他人进入战斗则屏蔽JOIN按钮",default:!1},{name:"mugoo",title:"山贼助手",desc:"在市场列表界面显示用户状态和攻击链接",default:!0},{name:"chatTimestamp",title:"聊天时间戳",desc:"聊天频道显示每条内容已发送时间",default:!0},{name:"travelFilter",title:"飞花过滤",desc:"在海外市场页面屏蔽不重要物品",default:!0},{name:"jailView",title:"监狱助手",desc:"在监狱页面屏蔽分数大于10000的目标，本帮人员置顶高亮显示",default:!0},{name:"stockexchange_show_abbr",title:"股票助手",desc:"在股票交易市场页面的股票名称前显示缩写",default:!0},{name:"gym_show_ratio",title:"健身房助手",desc:"在健身房页面显示推荐的属性比例",default:!0},{name:"common_modify_header_links",title:"顶部快捷入口",desc:"在页面顶部添加一些常用页面的链接",default:!0},{name:"hide_cloud_while_flying",title:"飞行无云",desc:"在飞行界面隐藏飞机和云彩",default:!0},{name:"withdrawal_helper",title:"取钱助手",desc:"右下角聊天people框高亮显示帮派可取钱名单",default:!0},{name:"bigger_screen_on_laptop",title:"laptop大屏",desc:"飞行中使用笔记本电脑时可以全屏显示",default:!0},{name:"taking_off_reminder",title:"起飞吃药提醒",desc:"起飞前根据CD提醒吃药和OC",default:!0},{name:"bounty_parade",title:"悬赏阅兵",desc:"报纸-悬赏页面显示目标BS",default:!1},{name:"nurse_suggestion",title:"护士建议",desc:"智能提醒出院吃药",default:!0}];Wt.forEach(t=>{var e=$t("BWM_SETTINGS",t.name);null==e&&It("BWM_SETTINGS",t.name,String(t.default)),window[t.name]="true"==$t("BWM_SETTINGS",t.name)});let y=localStorage.getItem("APIKey");const Bt={20465:"SMTH",36134:"Silver Hand",10741:"Trisolary",16335:"November Chopin",7074:"Legends Never Die",16424:"Party Animals"};var c,i,e,a,n,d,p,o={8836:"Vinerri",2095:"Guerrilla Warfare",11356:"-UGK-",31312:"TORNado",8255:"Scream Silence",26312:"The Avengers",28205:"Invictus",10913:"Unbroken Warriors",8510:"Ara Pacis",5113:"ThugLife",13343:"The Defiant",39756:"Abusement Park",38761:"Shadow Healers",42125:"Octogenarian DirtyBombers",35739:"Kingsmen",14820:"Unbroken Legion",10140:"In Memory of the Fallen",9405:"Lake Of Lerna",30085:"Rampage Total Destruction"};const Lt={gray:"#adadad",red:"#ff7373",green:"#8fbc8f",blue:"#65a5d1",purple:"#8d6dd7",yellow:"#f39826",yellowgreen:"#83a000",pink:"#e467b3",salmon:"#F9CDAD",orange:"#FFDEAD"};if(Date.prototype.format=function(t){var e,a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(e in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t},function(){var e=$t("APICache_companies","last-updated");if(null!=e&&null!=e){var a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&zt()}else zt()}(),travelFilter&&function(){const r={186:"绵羊",187:"泰迪熊",215:"猫咪",258:"美洲豹",261:"貂熊",266:"尼斯湖水怪",268:"赤狐",269:"猴子",273:"岩羚羊",274:"大熊猫",281:"狮子",384:"骆驼",618:"黄貂鱼",260:"大丽花",263:"番红花",264:"兰花",267:"帚石楠",271:"木棉花",272:"雪绒花",276:"牡丹花",277:"樱花",282:"非洲堇",385:"蒺藜花",617:"香蕉兰",256:"催泪弹",226:"烟雾弹",222:"闪光弹",616:"鳟鱼"},t=F(".travel-agency-market ul.users-list li"),s=[260,263,264,267,271,272,276,277,282,385,617].concat([186,187,215,258,261,266,268,269,273,274,281,384,618]).concat([206,616,222,226,256]);if(0<t.length&&"filtered"!=t.attr("filtered")){let o=parseInt(F("div.delimiter div.msg:contains(You have purchased) span.bold").last().text());var e=parseInt(F(F("div.delimiter div.msg:contains(You have purchased) span.bold").get(-2)).text());o-=e,(isNaN(o)||o<=0)&&(o=1),t.each((t,e)=>{var a=parseInt(F(e).find("div.details").attr("itemid"));if(isNaN(a)||!(0<a))return!1;if(s.indexOf(a)<0)F(e).addClass("hide");else{const n=F(e).find("input#item-"+a)[0];if(n.value=o,n.dispatchEvent(new Event("blur")),r[a]){a=r[a];const i=F(e).find("span.name");i.html(i.html()+"<span style='float:right;padding-right:10px;'>"+a+"</span>")}}}),t.attr("filtered","filtered")}F("#show_more").length<1&&(F(".travel-agency-market").after("<div><div id='show_more' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;background-color:#c0542f;text-align:center;'>点击显示全部</div></div>"),F("#show_more").click(function(){F(this).parent().remove(),t.removeClass("hide")}))}(),common_modify_header_links&&Tt(),chatTimestamp&&Nt(),setInterval(function(){if(0<F("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").length&&!F("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone")){F("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone","1");const t=F("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").children("a"),e=t?t.attr("href"):void 0,a=e?e.substr(20):void 0;a&&At(a,function(t){It("battlestats",a,t.estimate_bs),F("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").append(`
                            <div id="bingwa-estimate-bs" class="border-round" style="color:white;background-color:#c0542f;padding:3px;margin:5px;margin:5px;text-align:center;">
                                <span>估算战力: ${t.estimate_bs_display}</span>
                            </div>
                        `)})}},500),withdrawal_helper&&Pt(),hide_cloud_while_flying&&0<F("#plane").length&&(F("#clouds-1").remove(),F("#clouds-2").remove(),F("#clouds-3").remove(),F("#plane").children().remove()),bigger_screen_on_laptop&&0<F(".computer-wrap").length&&(F(".computer-navigation").insertBefore(".computer-wrap"),F("#computer-content-wrapper").insertBefore(".computer-wrap"),F(".computer-wrap").css("visibility","hidden"),F(".computer-navigation").attr("style","position: unset; margin-bottom: 10px;"),F("#computer-content-wrapper").removeClass("left"),F("#computer-content-wrapper").css("margin","auto")),0<=window.location.href.indexOf("loader.php?sid=racing")&&setInterval(function(){F(".bar-tpl-wrap:not([show-value])").each(function(t,e){let a=0,n=0,i=0;i=F(e).hasClass("negative")?(a=parseFloat(F(e).find(".progress-light-gray")[0].style.width),n=parseFloat(F(e).find(".progress-red")[0].style.width),a=parseFloat(a*n/100),a-n):F(e).hasClass("positive")?(n=parseFloat(F(e).find(".progress-light-gray")[0].style.width),a=parseFloat(F(e).find(".progress-light-green")[0].style.width),n=parseFloat(a*n/100),a-n):(n=parseFloat(F(e).find(".progress-")[0].style.width),0),F(e).css("line-height","17px").css("margin-top","0px").css("width","88px").html("<span style='color: gray'>"+n.toFixed(2)+"</span>"+(0<=i?" + ":" - ")+Math.abs(i).toFixed(2)),F(e).css("color",0<=i?"green":"red"),F(e).attr("show-value","show-value")})},500),0<=window.location.href.indexOf("shops.php?step=bitsnbobs")&&F(".buy-flexslider").find(":input").val("100"),0<=window.location.href.indexOf("factions.php?step=your")){function r(){var t=JSON.parse(F("#websocketConnectionData").text());return t.playername+" ["+t.userID+"]"}function s(t,e){const a=F("ul.money-depositors").children("li.depositor").find("span[title='"+e+"']").parent().siblings("div.amount").children().children().attr("data-value");let n="$"+a;0!=a&&(n=a.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})),n.includes("-")?t.text("").append(`<span>${e}</span><span class ='t-red right'>${n}</span>`):t.text("").append(`<span>${e}</span><span class ='right'>${n}</span>`)}function l(e,a,n){let i=ut(a);if(0<=a){var o="#5d9525";let t=100*a/n;"准备金率"==e&&(t=Math.min(100*a,100),i=(100*a).toFixed(2)+"%"),F("#faction_balance_li").append(`
                    <div style="overflow:hidden; margin:7px; border:1px solid gray;">
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${h(0,o,"#eee",e)}</div>
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${h(t,o,"#eee",i)}</div>
                    </div>`)}else{o="#c0542f",n=100*a/n+100;F("#faction_balance_li").append(`
                    <div style="overflow:hidden; margin:7px; border:1px solid gray;">
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${h(n,"#eee",o,e)}</div>
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${h(0,o,"#eee",i)}</div>
                    </div>`)}}function h(t,e,a,n){return`
                <div style="position:relative; top:0; width:100%; height:18px; color:${e}; background-color:${a}; padding:2px 0px; text-align:center;">${n}</div>
                <div style="position:relative; top:-22px; width:100%; left:${t-100}%; height:18px; padding:2px 0px; z-index:2; overflow:hidden;">
                    <div style="position:absolute; top:0; width:100%; left:${100-t}%; height:18px; color:${a}; background-color:${e}; padding:2px 0px; text-align:center;">${n}</div>
                </div>`}let t=new MutationObserver(function(t,e){console.log("changed"),function(){const t=F("div#money-user-cont").find("li.ui-custom-item");!F("input#money-user")||"."!=F("input#money-user").val()&&" "!=F("input#money-user").val()||(F("input#money-user").val(r()).addClass("chosen"),console.log(r()),s(t.children(),r())),0<t.length&&!t.children().text().includes("$")&&!t.hasClass("empty")&&t.each(function(){var t=F(this).children().text();s(F(this).children(),t)})}(),function(){const e=F(".money-wrap").children(".give-block"),t=[{button_name:"取1m","button-value":"1,000,000"},{button_name:"取5m","button-value":"5,000,000"},{button_name:"取10m","button-value":"10,000,000"},{button_name:"取25m","button-value":"25,000,000"}];F(".button-wrap").length<1&&(e.children(".info").after(`
                    <div class="button-wrap" style="margin:2px;">
                        <span id="deposit-self" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.purple};">给自己</span>
                        <span id="deposit0" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.blue};">${t[0].button_name}</span>
                        <span id="deposit1" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.blue};">${t[1].button_name}</span>
                        <span id="deposit2" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.blue};">${t[2].button_name}</span>
                        <span id="deposit3" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.blue};">${t[3].button_name}</span>
                        <span id="deposit-all" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${Lt.blue};">全取</span>
                    </div>`),e.children(".select-wrap").css("padding-top","1px"),F("#deposit-self").click(()=>{F("input#money-user").val(r()).addClass("chosen")}),F("#deposit0").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[0]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),F("#deposit1").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[1]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),F("#deposit2").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[2]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),F("#deposit3").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[3]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),F("#deposit-all").click(()=>{var t;0<=e.children(".select-wrap").children(".result").text().indexOf("]")&&(t=e.children(".select-wrap").children(".result").children(".right").text().replace("$",""),console.log(t),e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled"))}))}(),function(){F("div.input-money-group").attr("class","input-money-group no-max-value");const t=F("ul.money-depositors").children("li.depositor");if(0<F("div.give-block").length&&F("#faction_balance_li").length<=0&&0<t.length){var e=bt(F(".money-wrap").children(".balance-message").children(".sum-of-deposit").text()),i=bt(F(".money-wrap").children(".balance-message").children(".faction-balance").text());let a=0,n=0;t.each((t,e)=>{e=parseInt(F(e).find("span.money").attr("data-value"));0<e?a+=e:n+=e});var o=parseInt(i)+parseInt(e),r=Math.max(Math.abs(e),Math.abs(i),Math.abs(a),Math.abs(n),Math.abs(o));F("#money").children(".balance-message").after(`
                    <div id="faction_balance_li" 
                    style="width:290px; border:4px solid gray; 
                    padding:5px 2px; margin:0px 0px 5px 5px; 
                    background-color:#fff; background-image: linear-gradient(rgba(209,73,78,0.2),rgba(209,73,78,0.1));">
                </div>`),l("帮派余额",o,r),l("所有存款总和",e,r),l("帮派公共资金",i,r),l("正存款总和",a,r),l("负存款总和",n,r),l("准备金率",parseFloat(o/a),r)}}()});t.observe(document.getElementById("faction-controls"),{childList:!0,subtree:!0});setInterval(function(){if(0<F("#money-user").length){const t=F("#money-user").parent().parent().siblings(".select-wrap").children(".result");0<=F("#money-user").val().indexOf("]")&&F("#money-user").val()!=t.attr("userid")&&(t.attr("userid",F("#money-user").val()),t.css("display","block"),s(t,F("#money-user").val()))}},500)}if(jailView&&0<=window.location.href.indexOf("jailview.php")){setInterval(function(){const t=F("ul.user-info-list-wrap").children("li");0<t.length&&(t.each(function(t,e){if("1"!=F(this).attr("hasDone")){var a=(function(t){t=t.find("span.time").text().match(/\d+/g),t=t||[0];return t[1]?60*parseInt(t[0])+parseInt(t[1]):parseInt(t[0])}(F(this))+180)*function(t){t=t.find("span.level").text().match(/\d+/g);return t?parseInt(t[0]):0}(F(this)),n=f(F(this))in Bt?1:a;F(this).find("span.reason").append(`&nbsp;&nbsp;<b class="bustscore t-red" sortscore=${n}>${a}</b>`);const i=F(this).children("a.bust").attr("href");null!=i&&i.indexOf("breakout1")<0&&F(this).children("a.bust").attr("href",i+"1"),F(this).removeClass("gray"),1==n?F(this).css("background-color","#5d9525"):2e4<n&&o&&F(this).addClass("hide"),F(this).attr("hasDone","1")}}),t.sort(function(t,e){return g(t)-g(e)}),t.detach().appendTo("ul.user-info-list-wrap"));F("#show_more").length<1&&o&&(F(".userlist-wrapper").after("<div><div id='show_more' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;color:#ccc;background-color:#c0542f;text-align:center;'>点击显示全部</div></div>"),F("#show_more").click(function(){o=!1,F(this).parent().remove(),F("ul.user-info-list-wrap").children("li").removeClass("hide")}))},1e3);let o=!0;function f(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function g(t){return F(t).find("b.bustscore").attr("sortscore")}}if(gym_show_ratio&&0<=window.location.href.indexOf("gym.php")){const Ht={0:{name:"balanced",description:"平衡比例",str:100,def:100,spd:100,dex:100},1:{name:"hank-str",description:"Hank比例-Str最高",str:100,def:80,spd:28,dex:80},2:{name:"hank-def",description:"Hank比例-Def最高",str:80,def:100,spd:80,dex:28},3:{name:"hank-spd",description:"Hank比例-Spd最高",str:28,def:80,spd:100,dex:80},4:{name:"hank-dex",description:"Hank比例-Dex最高",str:80,def:28,spd:80,dex:100},5:{name:"baldr-str",description:"Baldr比例-Str最高",str:100,def:72,spd:80,dex:72},6:{name:"baldr-def",description:"Baldr比例-Def最高",str:72,def:100,spd:72,dex:80},7:{name:"baldr-spd",description:"Baldr比例-Spd最高",str:80,def:72,spd:100,dex:72},8:{name:"baldr-dex",description:"Baldr比例-Dex最高",str:72,def:80,spd:72,dex:100}};function m(t,e,a,n){const i=F("[class^='gymContent___']").children("[class^='properties___']").children("li");var o=F("#strength-val").text().split(",").join(""),r=F("#defense-val").text().split(",").join(""),s=F("#speed-val").text().split(",").join(""),l=F("#dexterity-val").text().split(",").join(""),d=Math.max(o/t,r/e,s/a,l/n),t=Math.abs(d*t-o)<=1?o:parseInt(d*t),e=Math.abs(d*e-r)<=1?r:parseInt(d*e),a=Math.abs(d*a-s)<=1?s:parseInt(d*a),n=Math.abs(d*n-l)<=1?l:parseInt(d*n);const c=[t,e,a,n],p=[t-o,e-r,a-s,n-l];let h=0;F(".gym-goal").remove(),i.each(function(){const t=F(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first");0==t.children(".gym-perks").length?t.html(`<span class="t-red gym-goal" title="目标:${bt(c[h])}">还差:${yt(p[h])} </span>`):t.prepend(`<span class="t-red gym-goal" title="目标:${bt(c[h])}">还差:${yt(p[h])} </span>`),h++})}function b(){var t=`https://api.torn.com/user/?selections=perks&key=${y}`;fetch(t).then(t=>t.json()).then(t=>{console.log("perks API fetched");let a=[{total:0},{total:0},{total:0},{total:0}];if(9==Object.keys(t).length)for(var e in t){const d=t[e];var n,i,o,r=e.split("_")[0];for(let t=0;t<d.length;t++)0<=d[t].search(/strength gym gains/i)?(n=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[0][r]=a[0].hasOwnProperty(r)?a[0][r]+n:n,a[0].total+=n):0<=d[t].search(/defense gym gains/i)?(i=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[1][r]=a[1].hasOwnProperty(r)?a[1][r]+i:i,a[1].total+=i):0<=d[t].search(/speed gym gains/i)?(i=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[2][r]=a[2].hasOwnProperty(r)?a[2][r]+i:i,a[2].total+=i):0<=d[t].search(/dexterity gym gains/i)?(o=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[3][r]=a[3].hasOwnProperty(r)?a[3][r]+o:o,a[3].total+=o):0<=d[t].search(/gym gains/i)&&(o=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[0][r]=a[0].hasOwnProperty(r)?a[0][r]+o:o,a[0].total+=o,a[1][r]=a[1].hasOwnProperty(r)?a[1][r]+o:o,a[1].total+=o,a[2][r]=a[2].hasOwnProperty(r)?a[2][r]+o:o,a[2].total+=o,a[3][r]=a[3].hasOwnProperty(r)?a[3][r]+o:o,a[3].total+=o)}const s=F("[class^='gymContent___']").children("[class^='properties___']").children("li");let l=0;s.each(function(){let t="<b>总加成:</b> +"+a[l].total+"%";for(var e in a[l])"total"!=e&&(t+="<br><b>"+e+":</b> +"+a[l][e]+"%");F(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first").append(`<span class="t-green gym-perks" title="${t}">锻炼加成:+${a[l].total}% </span>`),l++})}).catch(t=>console.log("fetch error",t))}for(var u in F("#gymroot").children().append(`
        <div>
            <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">锻炼比例推荐
            </div>
            <div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                <div class="select-wrap" style="margin:5px; float:left">
                    <select id="gym-ratio" style="height:24px">
                    </select>
                </div>
                <div class="select-wrap" style="margin:5px 1px; float:left">
                    <p id="gym-ratio-info" style="height:12px; padding:6px 1px;">
                    </p>
                </div>
            </div>
        </div>
    `),Ht)F("#gym-ratio").append(`<option value="${u}">${Ht[u].description}</option>`);const Gt=$t("gym-ratio","ratio_number");if(null!==Gt&&void 0!==Gt){F("#gym-ratio").children("[value="+Gt+"]").attr("selected","true"),F("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ht[Gt].str} : ${Ht[Gt].def} : ${Ht[Gt].spd} : ${Ht[Gt].dex}`);const qt=setInterval(()=>{console.log("interval started"),0<F("[class^='gymContent___']").length&&(console.log("interval ended"),clearInterval(qt),m(Ht[Gt].str,Ht[Gt].def,Ht[Gt].spd,Ht[Gt].dex),b())},500)}if(F("#gym-ratio").change(function(){console.log("ratio changed");var t=F("#gym-ratio").val();It("gym-ratio","ratio_number",t),F("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ht[t].str} : ${Ht[t].def} : ${Ht[t].spd} : ${Ht[t].dex}`),m(Ht[t].str,Ht[t].def,Ht[t].spd,Ht[t].dex)}),0<F(".gym___3sIk3").length){let t=new MutationObserver(function(t,e){console.log("observer");const a=F("[class^='gymDetails___']").find("[class^='progressBar___']");a.each(function(){let t=F(this).attr("aria-label").split(" ")[2];"not"==t&&(t=0),F(this).find("[class^='exerciseName___']").text(t+"/10")}),null!==Gt&&void 0!==Gt&&(m(Ht[Gt].str,Ht[Gt].def,Ht[Gt].spd,Ht[Gt].dex),b())});t.observe(document.getElementsByClassName("gym___3sIk3")[0],{childList:!0})}}if(0<=window.location.href.indexOf("index.php")){const Jt=F("#personal-perks");0<Jt.length&&(e=Jt.children("ul").children("li:last"),Jt.children("ul").prepend(e),Jt.children("ul").children("li:first").removeAttr("class"),Jt.children("ul").children("li:last").attr("class","last"),Jt.children("ul").children("li:first").append('<span id="pp-btn" class="border-round" style="cursor:pointer;color:white;background-color:darkseagreen;padding:2px;margin-left:60px;">展开</span>'),F("#pp-btn").click(function(){"展开"==F(this).text()?(F(this).parent().parent().css("height","auto"),F(this).text("折叠"),F(this).css("background-color","orange")):(F(this).parent().parent().css("height","168px"),F(this).text("展开"),F(this).css("background-color","darkseagreen"))}))}if(noAssisting&&0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let e=Math.floor(30*Math.random()+1),a=300;const Xt=setInterval(function(){const t=F("[class^='btn_']");t.text().includes("Start fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(e/10).toFixed(1)+")s To Start fight"),0==e&&(clearInterval(Xt),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),e--)},100),Ut=setInterval(function(){const t=F("[class^='btn_']");t.text().includes("Join fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(a/10).toFixed(1)+")s To Join fight 已有其他人进入此战斗"),0==a&&(clearInterval(Ut),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),a--)},100)}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let i=100;setInterval(function(){{var t,e,a,n;0<F("[class^=level]").length&&0<F("#log-header").length&&(n=F("[class^=level]").attr("style").replace("height: ","").replace("%",""),(t=parseFloat(n))>i||(e=66<=(i=t)?"green":"red",a=66<=t?"高":"低",F("#stealth-value").remove(),n=F("#log-header").children(":first").attr("class"),F("#log-header").children(":first").after(`
                <span id="stealth-value" class="${n}">隐身几率:&nbsp;
                    <span class="t-${e}">${a}</span>
                    &nbsp;Stealth:&nbsp;
                    <span class="t-${e}">${t}%</span>
                </span>`)))}},500)}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){setInterval(function(){0<F("[class^=labelsContainer]").length&&F("[class^=titleContainer]").empty()},500);const Kt=window.location.href.substr(51);F("[class^=titleContainer]").empty(),F("[class^=titleContainer]").append(`<span id="online-status" class="border-round" style="color:white;background-color:${Lt.red};padding:5px;font-size:18px;" title="在线状态"></span>`),F("[class^=titleContainer]").append(`<span id="last-action" class="border-round" style="color:white;background-color:${Lt.red};padding:5px;font-size:18px;" title="离线时间"></span>`),F("[class^=titleContainer]").append(`<span id="refresh-btn" class="border-round" style="cursor:pointer;color:white;background-color:${Lt.blue};padding:5px;font-size:18px;">刷新</span>`),F("#refresh-btn").click(()=>{location.reload()}),At(Kt,function(t){var e;null!=t&&"last_action"in t&&("Online"==(e=t.last_action.status)?F("#online-status").css("background-color",Lt.green):"Idle"==e?F("#online-status").css("background-color",Lt.yellow):F("#online-status").css("background-color",Lt.gray),F("#online-status").text(e),F("#last-action").text(t.last_action_details))},function(t){F("#online-status").text("蛙蛙探测 "+Kt+" 失败 "+t)})}if(nurse_suggestion&&0<=window.location.href.indexOf("item.php")&&Et(".tutorial-cont"),0<=window.location.href.indexOf("factions.php?step=your")){let t=new MutationObserver(function(t,e){console.log("changed"),Et("#faction-armoury-tabs")});t.observe(document.getElementById("faction-armoury"),{childList:!0,subtree:!0})}if(taking_off_reminder&&0<=window.location.href.indexOf("travelagency.php")&&(0<F("#icon86-sidebar").length&&(F("#tab-menu4").after(`<div><div id='oc-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:NavajoWhite;text-align:center;'>OC准备就绪 点击前往执行</div></div>`),F("#oc-btn").click(function(){F(this).text("蛙蛙正在前往……"),window.location.href="https://www.torn.com/factions.php?step=your#/tab=crimes"})),0<F("#icon49-sidebar").length?F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#c0542f;text-align:center;'>DRUG CD 小于10分钟 先不要飞了哦</div></div>`):0<F("#icon50-sidebar").length?F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#DAA520;text-align:center;'>DRUG CD 不足1小时 先不要飞了哦</div></div>`):0<F("#icon51-sidebar").length?F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为1-2小时之间 可尽情飞翔</div></div>`):0<F("#icon52-sidebar").length?F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为2-5小时之间 可尽情飞翔</div></div>`):0<F("#icon53-sidebar").length?F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 大于5小时 可尽情飞翔</div></div>`):F("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为零 是不是忘吃药了</div></div>`)),0<=window.location.href.indexOf("factions.php?step=your")&&setInterval(function(){F("div.title").children("div.id").text("BS");const t=F("li.enemy").children("div.id");0<t.length&&t.each(function(t,e){const a=F(this).siblings("span").children("div.member").children("a.user.name"),n=a?a.attr("href"):void 0;var i=n?n.substr(18):void 0;i&&((i=$t("battlestats",i))?F(this).text(Rt(i)):F(this).text("nil"))});const e=F("li[class^='enemy enemy___']").parent(),a=F("li[class^='enemy enemy___']").children("div.attack").children();0<a.length&&a.each(function(){if("1"!=F(this).attr("detected")){const e=F(this).parent().siblings("div.member").children().children("[class^=userWrap___]").children(),a=e?e.attr("href"):void 0;var t=a?a.substr(18):void 0;console.log(t),t&&((t=$t("battlestats",t))?(F(this).text(Rt(t)),F(this).attr("bs",t)):F(this).attr("bs",0))}F(this).attr("detected","1")});0<e.length&&"1"!=e.attr("hasdone")&&(e.attr("hasdone","1"),function(t,a){const e=t.parent().siblings(),n=t.parent().siblings().children();t.click(function(){"decend"==F(this).attr("sort")?(n.sort(function(t,e){return a(t)-a(e)}),n.detach().appendTo(e),F(this).attr("sort","ascend")):(n.sort(function(t,e){return a(e)-a(t)}),n.detach().appendTo(e),F(this).attr("sort","decend"))})}(e.siblings().children("div[class^='attack left attack___']"),jt))},3e3),0<=window.location.href.indexOf("preferences.php"))setInterval(function(){var t=F("[class^=api___]"),e=F("#name").attr("aria-expanded"),a=F("#name").attr("aria-hidden");if(0<t.length&&"false"==e&&"false"==a){F("#bingwa-apikey-setting").length<1&&F(".content-title").after(`
                    <div id="bingwa-apikey-setting">
                        <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">冰蛙APIKey设置</div>
                        <div id="bingwa-apikey-setting-wrapper" class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                            <div style="margin:5px;padding:5px;">你拥有的APIKey个数为 <span id="apikey-number" style="padding:3px;color:${Lt.yellowgreen};font-size:18px;"></span> 个</div>
                            <div style="margin:5px;padding:5px;">冰蛙当前使用的APIKey为 <span id="apikey-current" style="padding:3px;color:${Lt.red};font-size:18px;"></span></div>
                            <div id= "apikey-wrapper"style="margin:5px;padding:5px;"></div>
                        </div>
                    </div>`);const n=F("[class^=keyRow]");F("#apikey-number").text(`${n.length}`),F("#apikey-current").text(`${window.localStorage.getItem("APIKey")}`),F("#apikey-wrapper").empty(),0<n.length&&n.each(function(){var t=F(this).children("[class^=key]").val(),e=F(this).children("[class^=blockTablet]").children("[class^=type]").val();F("#"+t).length<1&&(t==window.localStorage.getItem("APIKey")?F("#apikey-wrapper").append(`
                                    <div id="${t}" style="">
                                        <button class="torn-btn" style="margin:5px;" disabled>已使用</button>
                                        <span style="padding:3px;color:white;background-color:${Lt.purple};font-size:12px;">${e}</span>
                                        <span style="padding:3px;color:white;background-color:${Lt.purple};font-size:16px;">${t}</span>
                                    </div>`):(F("#apikey-wrapper").append(`
                                    <div id="${t}" style="">
                                        <button class="torn-btn" style="margin:5px;">未使用</button>
                                        <span style="padding:3px;color:white;background-color:${Lt.gray};font-size:12px;">${e}</span>
                                        <span style="padding:3px;color:white;background-color:${Lt.gray};font-size:16px;">${t}</span>
                                    </div>`),F(".torn-btn").click(function(){window.localStorage.setItem("APIKey",F(this).parent().attr("id"))})))})}else F("#bingwa-apikey-setting").remove()},500);else if(null==y||""==y)alert("宝鉴需要一个有效的APIKey，将前往设置页面，待载入后选择你的APIKey。"),window.location.href="https://www.torn.com/preferences.php#tab=api";else{const Vt=F("#sidebarroot").find("[class^='status-icons___']"),Yt=F("#top-page-links-list").children("a");if(0<Yt.length||0<Vt.length){console.log("当前页面有按钮，可以宝鉴");let i={user:["ammo","attacks","attacksfull","bars","basic","battlestats","bazaar","cooldowns","crimes","discord","display","education","events","gym","hof","honors","icons","inventory","jobpoints","log","medals","merits","messages","missions","money","networth","newevents","newmessages","notifications","perks","personalstats","profile","properties","receivedevents","refills","reports","revives","revivesfull","skills","stocks","timestamp","travel","weaponexp","workstats"],property:["property","timestamp"],faction:["applications","armor","armorynews","attacknews","attacks","attacksfull","basic","boosters","cesium","chain","chainreport","chains","contributors","crimenews","crimes","currency","donations","drugs","fundsnews","mainnews","medical","membershipnews","positions","reports","revives","revivesfull","stats","temporary","territory","territorynews","timestamp","upgrades","weapons"],company:["applications","companies","detailed","employees","news","newsfull","profile","stock","timestamp"],market:["bazaar","itemmarket","pointsmarket","timestamp"],torn:["bank","cards","chainreport","companies","competition","education","factiontree","gyms","honors","items","logcategories","logtypes","medals","organisedcrimes","pawnshop","pokertables","properties","rackets","raids","rankedwarreport","rankedwars","stats","stocks","territory","territorywars","timestamp"],key:["info"]},l="",d="",c="";Vt.prepend('<li class="a_click_view_api_info icon6___XChW2" title="冰蛙宝鉴 呱" style="cursor: pointer; background-image:url(/images/v2/editor/emoticons.svg); background-position: -470px -42px;"></li>');Yt.last().after('<a role="button" style="cursor: pointer" aria-labelledby="events" class="a_click_view_api_info events t-clear h c-pointer  m-icon line-h24 right last"><span class="icon-wrap svg-icon-wrap"><span class="link-icon-svg events "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><defs><style>.cls-1{opacity:0.35;}.cls-2{fill:#fff;}.cls-3{fill:#777;}</style></defs><g id="Ð¡Ð»Ð¾Ð¹_2" data-name="Ð¡Ð»Ð¾Ð¹ 2"><g id="icons"><g class="cls-1"><path class="cls-2" d="M8,1a8,8,0,1,0,8,8A8,8,0,0,0,8,1ZM6.47,3.87H9.53l-.77,7.18H7.24ZM8,14.55A1.15,1.15,0,1,1,9.15,13.4,1.14,1.14,0,0,1,8,14.55Z"></path></g><path class="cls-3" d="M8,0a8,8,0,1,0,8,8A8,8,0,0,0,8,0ZM6.47,2.87H9.53l-.77,7.18H7.24ZM8,13.55A1.15,1.15,0,1,1,9.15,12.4,1.14,1.14,0,0,1,8,13.55Z"></path></g></g></svg></span></span><span id="a_click_view_api_info_text">宝鉴</span></a>'),F(".a_click_view_api_info").click(function(){if(F("#bwm").length<1){F("#mainContainer").prepend(`
                    <div id="bwm">
                        <div id="bwm-nav">
                            <ul style="list-style-type: none;margin: 10px 0px;padding: 0;overflow: hidden;background-color: #333;">
                                <li style="float: left">
                                    <a id="bwm-version" role="button" style="cursor: pointer;display: block;color: black;background-color: #4CAF50;text-align: center;padding: 14px 16px;text-decoration: none;" >版本记录</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-api" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >查看API</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-company" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >我的公司</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-faction" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >帮派详情</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-mug" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >抢劫历史</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-warroom" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >世界局势</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-revive" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >复活助手</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-rankedwar" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >近期RW</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-settings" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >设置</a>
                                </li>
                                <li style="float: right">
                                    <a id="bwm-return" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >返回</a>
                                </li>
                            </ul>
                        </div>
                    </div>`);const n="cursor: pointer; display: block; color: black; background-color: #4CAF50; text-align: center; padding: 14px 16px; text-decoration: none;",s="cursor: pointer; display: block; color: white; text-align: center; padding: 14px 16px; text-decoration: none;";function t(){var t=function(){var e={"2.9.3":{date:"2022.01.08",notes:["新功能：近期RW显示服务器近期RW的记录"]},"2.9.2":{date:"2022.01.04",notes:["新功能：帮派取钱现在在更加明显的位置提示余额，并且新增加了全取按钮","新功能：侧边栏现在有冰蛙图标了","修复：修复了飞行时读取不到自己id导致的公司页面无法显示问题","修复：帮派详情页面增加了显示内容（帮派图标和rank等级）"]},"2.9.1":{date:"2021.12.30",notes:["修复：修正了某些API的匹配格式，使得小护士可以正常运行","修复：更新了profile页面的攻击链接，现在玩家在医院可以读取完整的战斗页面了","修复：为一部分表格增加横向拖动条，使其在超出手机屏幕宽度时也可以显示完整内容（感谢Woohoo）","修复：微调了profile页面BS显示相关内容"]},"2.9.0":{date:"2021.12.28",notes:["新功能：小护士现在可以分别按照【出院模式】和【满血模式】提供建议","新功能：profile页面新增估算WS","新功能：针对公司老板新增显示公司货物库存","修复：修复了mini profile上估算bs重复显示的问题","修复：修复了小护士有时获取不到住院时间的问题","修复：修复了帮派余额和准备金率显示错误的问题","修复：profile连续活跃天数重新修改为冰蛙活跃天数","修复：修改了某些配色以解决深色模式下看不清的问题","修复：现在飞行无云功能不再显示飞机图片了","修复：针对非东8区用户修改了唠嗑时间显示不正确的问题","修复：更新了key->info和rankedwarreport等API条目"]},"2.8.9":{date:"2021.12.09",notes:["新功能：自己帮派的Ranked War界面会显示敌人bs(需提前对该帮派阅兵)，并且可以按bs排序","修复：小护士读取不到API时的报错","修复：faction和company重绘读取不到API时的报错"]},"2.8.8":{date:"2021.11.24",notes:["修复：使用API重绘faction和company页面时匹配不同url","修复：一个神奇的bug"]},"2.8.7":{date:"2021.11.23",notes:["新功能：在个人profile页面显示上次聊天时间和上次mug时间金额","新功能：在高级搜索页面显示上次聊天时间"]},"2.8.6":{date:"2021.11.19",notes:["新功能：mini profile显示冰蛙估算战力","新功能：帮派仓库增加快捷取钱按钮","修改：使用帮派药品出院时也可以获得小护士建议了"]},"2.8.5":{date:"2021.11.08",notes:["新功能：战斗页面增加显示目标在线状态","修改：冰蛙APIKey读取页面UI","修改：阅兵可以按bazaar金额筛选目标，增加bazaar链接","修改：在飞行入院或入狱时也可以在company.php页面查看效率表格了"]},"2.8.4":{date:"2021.11.01",notes:["新功能：战斗页面增加量化显示stealth隐身概率","新功能：item页面增加小护士智能出院建议","新功能：在自己帮派的战斗中，会显示墙上敌人的bs(需提前对该帮派阅兵)","修复PDA会重复载入冰蛙的bug(感谢Woohoo-)"]},"2.8.3.1":{date:"2021.10.25",notes:["公司管理中增加显示本周销售额（实时数据）和近一周利润（缓存数据）","公司管理表格改为显示到公司页面的下方"]},"2.8.3":{date:"2021.10.23",notes:["起飞页面增加吃药cd和oc提醒功能","bounty页面增加自动阅兵功能，默认关闭需在设置中手动开启","个人页面的冰蛙检测增加显示活跃天数，删除ECS数量","在个人页面enemy数量右侧增加显示坏比指数","points市场目标提示现在可以显示新人和衣服店了"]},"2.8.2":{date:"2021.10.08",notes:["启用更精确的计算监狱分数公式并且显示分数提高到25000","修复阅兵bug"]},"2.8.1":{date:"2021.09.30",notes:["取消大乱斗功能","取消oc提醒功能"]},"2.8.0":{date:"2021.09.11",notes:["新增大乱斗阅兵","优化了大乱斗界面"]},"2.7.9":{date:"2021.09.09",notes:["新增了API条目","更新了顶部快捷链接","阅兵可以显示大乱斗所在队伍","在海外也可以查看大乱斗"]},"2.7.8":{date:"2021.08.18",notes:["阅兵可以显示目标bazaar内全部物品价值总和"]},"2.7.7":{date:"2021.06.20",notes:["公司排行页面可以进行公司阅兵了","增加新的快捷打劫链接","不再显示已售空的额外的bazaar","buymug时加入自己人防误伤提醒","OC即将开始时进入飞行界面将获得更加明显的提示","隐藏laptop边框","飞行时不显示云和飞机"]},"2.7.6":{date:"2021.05.29",notes:["不是老板也能查看我的公司表格了","新增帮派取钱助手"]},"2.7.5.2":{date:"2021.05.29",notes:["聊天框时间戳不显示秒","Jail界面增加显示更多按钮","海外库存界面增加显示更多按钮"]},"2.7.5.1":{date:"2021.05.27",notes:["修复聊天框时间戳"]},"2.7.5":{date:"2021.04.12",notes:["顶部链接、健身房、赛车界面UI微调"]},"2.7.4":{date:"2021.04.01",notes:["飞行时查看的公司页面增加TV和油厂的单价估算"]},"2.7.3":{date:"2021.03.30",notes:["我的公司页面UI微调"]},"2.7.2":{date:"2021.03.23",notes:["添加顶部链接和健身房的开关","在股票交易市场页面显示股票缩写"]},"2.7.1":{date:"2021.03.10",notes:["我的公司页面新增显示各员工工资和当前公司实时数据，修复保存31天显示32天的bug","飞行中的帮派信息页区分显示正在被突击和主动突击别人"]},"2.7.0":{date:"2021.02.14",notes:["修改imarket search页面，增加显示目标bazaar内全部物品价值总和","新增功能复活助手"]},"2.6.9":{date:"2021.02.11",notes:["帮派对比功能重做以显示更多数据","加入更多设置选项","index页面加入一键显示全部perks"]},"2.6.8":{date:"2021.02.02",notes:["新增世界局势功能，显示所有正在进行的地盘战，按战况激烈程度染色"]},"2.6.7":{date:"2021.01.24",notes:["在飞行/医院/监狱中也可以查看自己/他人Bazaar中物品"]},"2.6.6.3":{date:"2021.01.22",notes:["解决gym页面与torntools兼容问题"]},"2.6.6.2":{date:"2021.01.19",notes:["修改一些可能存在的bug","Gym页面提供Hank和Baldr属性比例参考","监视列表可以自由添加玩家ID，被监视的目标在海外被高亮（橙色）显示"]},"2.6.6.1":{date:"2021.01.19",notes:["查看个人profile页面的Last action显示为x天x时x分x秒"]},"2.6.6":{date:"2021.01.14",notes:["我的公司及飞行中看帮派、公司功能汉化。","飞行中看帮派信息增加chain、地盘战、raid战的信息。","产量数据支持多种库存的公司。"]},"2.6.5.1":{date:"2021.01.13",notes:["对使用过【我的公司】功能的，每天进游戏时自动检查抓取昨晚的公司运营数据。"]},"2.6.5":{date:"2021.01.11",notes:["公司效率表格微调：增加inactivy，调整列顺序","新增公司历史数据表格","飞行时也能看帮派和公司页面"]},"2.6.4.1":{date:"2021.01.05",notes:["优化公司效率表格显示，并且海外可查看"]},"2.6.4":{date:"2021.01.04",notes:["公司页面显示效率表格","聊天框显示时间戳"]},"2.6.3":{date:"2020.12.28",notes:["顶部增加简易导航条，从api.torn.com更新了API条目","优化阅兵功能，增加暂停和继续按钮","优化帮派对比功能，增加历史记录和高亮显示leader","增加抢劫历史功能，可以从历史记录中选择目标加入监视列表"]},"2.6.2":{date:"2020.11.11",notes:["修复顶部链接导致页面排版错乱的问题","payday功能只向leader和coleader提供"]},"2.6.1":{date:"2020.10.22",notes:["美化排版：pmarket、imarket(search)、imarket页面在显示bs时不再影响原始布局","市场显示超过3个bazaar：imarket(search)页面显示bazaar数量不再局限于3个","bazaar页面简易计算器：可以通过点击选中物品，页面顶部显示选中物品的总价值"]},"2.6.0":{date:"2020.09.28",notes:["itemmarket/pointmarket/bazaar界面增加3个mug相关脚本（感谢Mirror），使用mugoo=true开启","revivehelper重命名为facPageEnhanced，显示内容优化，使用foo=true开启","阅兵模块优化，增加阅兵内容选项，所有阅兵相关功能都使用foo=true开启","监狱置顶标记友帮成员，无视分数","海外people界面用颜色标记友帮和敌帮成员"]},"2.5.9":{date:"2020.09.16",notes:["修复飞花增强功能失效的bug"]},"2.5.8":{date:"2020.11.11",notes:["回滚上版本第一条，因为networth会变化，持续7天才触发rank","蛙蛙探测显示更多页面里的锻炼总能量换成Booster数量"]},"2.5.7":{date:"2020.08.14",notes:["当rank反推的bs上限低于估算值时，忽略估算值，使用rank反推的上下限区间","修复蛙蛙探测显示更多页面排版问题","帮派页面Revive增强功能默认关闭，需要时请将代码头部 reviveHelper 设为 true 手动开启"]},"2.5.6":{date:"2020.08.01",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.5.5.1":{date:"2020.07.30",notes:["修复一些取款小bug，给自己取款时，输入.或者?(英文标点)可自动替换为本人名字，减少输入时间"]},"2.5.5":{date:"2020.07.30",notes:["屏蔽全取按钮，选择取款目标时显示目标额度"]},"2.5.4":{date:"2020.07.27",notes:["增加帮派成员界面一系列功能：阅兵，显示bs、上次登录时间、旅行状态和住院时间，高亮标记住院成员，排序等"]},"2.5.3":{date:"2020.07.07",notes:["增加防打重功能，开关noAssisting = true"]},"2.5.2":{date:"2020.06.17",notes:["修复顶部链接导致页面排版错乱的问题"]},"2.5.1":{date:"2020.06.15",notes:["修复阅兵转换为csv有时丢失某些列的问题"]},"2.5.0":{date:"2020.06.05",notes:["搜索及海外用户列表阅兵功能优化：过滤5b以下，显示mugged, rehabcost, rank, job"]},"2.4.9":{date:"2020.06.05",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.4.8":{date:"2020.06.04",notes:["jailview 按 jailscore 排序，并优化体验","更新看库存的链接","用户搜索页面增加阅兵功能"]},"2.4.7":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：市场","jailview页面增强：显示各目标的 分钟数*级别；过滤大于1万的；bust不需要二次确认（类似DN的quick bust功能）"]},"2.4.6":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：赛车/啤酒/飞行/库存"]}};let a="",n=0,i="";for(var o in e){i+=e[o].date+" --v"+o+"\n";for(let t=0;t<e[o].notes.length;t++)i+="    "+e[o].notes[t]+"\n";i+="\n";let t=o.split(".");t.splice(1,0,"."),t.join(""),parseFloat(t)>n&&(n=t,a=o)}return[a,i]}();return`
                        <div id="version_container" style="width: inherit">
                            <div style="text-align:center; margin-bottom: 10px;">
                                <a role="button" style="cursor: pointer; font-size: large; color: #777;">冰蛙当前版本为 ${t[0]}</a>
                            </div>
                            <div style="text-align:center;">
                                <textarea  style="height:800px;width:100%;background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly">${t[1]}</textarea>
                            </div>
                        </div>`}F("#bwm").append(t()),F("#bwm-version").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(t()),F("#bwm-version").attr("style",n),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s)}),F("#bwm-api").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(function(){let t="";for(var e in i)t+='<a role="button" style="cursor: pointer; font-size: large; color: #777;" class="a_click_api_type">'+e+"</a>&nbsp;&nbsp;";t+='<br /><br /><input type="text" id="api_input_id" name="api_input_id" placeholder="ID (当前用户不用填)" size="25" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_from_time" name="api_input_from_time" placeholder="From (Eg: 2019/10/25 23:00:00)" size="29" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_to_time" name="api_input_to_time" placeholder="To (Eg: 2019/10/26 08:00:00)" size="28" style="font-size: larger; padding: 3px;" />';let a='<div id="api_container"><div id="api_types_container" style="text-align:center; margin-bottom: 10px;">'+t+'</div><div id="api_fields_container" style="text-align:center; margin-bottom: 10px;"></div><div id="api_result_header" style="text-align:center; margin-bottom: 3px; font-size: large;"></div><div style="text-align:center;"><textarea id="api_result_container" rows="40" style="width:100%; background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly" /><br /><a id="api_result_download_csv" role="button" style="cursor: pointer; font-size: large; color: #777;">导出为CSV文件</a>';return foo?a+='&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_parade" role="button" style="cursor: pointer; font-size: large; color: #777;">帮派大阅兵</a><a id="a_faction_parade_download" role="button" style="display:none">帮派大阅兵下载</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_attacks" role="button" style="cursor: pointer; font-size: large; color: #777;">帮战统计</a><a id="a_faction_attacks_download" role="button" style="display:none">帮战统计下载</a></div></div>':a+="</div></div>",a}()),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",n),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s),F(".a_click_api_type").click(function(){F("#api_fields_container").empty(),l=F(this).text(),console.log("click: "+l);var t,e=i[l].sort();for(t in e){var a=e[t];F("#api_fields_container").append('<a role="button" style="cursor: pointer; font-size: large; color: #777;" class="a_click_api_field">'+a+"</a>&nbsp;&nbsp;"),t%10==8&&F("#api_fields_container").append("<br />")}F(".a_click_api_field").click(function(){F("#api_result_container").val("");var t=F(this).text(),e=F("#api_input_id").val(),a=F("#api_input_from_time").val(),n=new Date(a).getTime()/1e3,i=F("#api_input_to_time").val(),o=new Date(i).getTime()/1e3;let r=`https://api.torn.com/${l}/${e}?selections=${t}&key=${y}&from=${n}&to=${o}`;(isNaN(n)||isNaN(o))&&(r=`https://api.torn.com/${l}/${e}?selections=${t}&key=${y}`),console.log(`Request: ${r}`),c=l+" - "+e+" - "+t+" - "+a+" - "+i,F("#api_result_header").text(`探测中: ${c}`),F("#api_result_download_csv").removeAttr("href"),F("#api_result_download_csv").removeAttr("download"),d="",fetch(r).then(t=>t.ok?t.json():void F("#api_result_header").text(`探测失败: ${c}`),t=>{F("#api_result_header").text(`网络异常: ${c}`)}).then(t=>{console.log(`Response: ${r}`),console.log(t),void 0!==t&&(F("#api_result_header").text(`探测完成: ${c}`),d=t,F("#api_result_container").val(JSON.stringify(t,null,4)))})})}),F("#api_result_download_csv").click(function(){var t;null==d||""==d||null==c||""==c||"object"!=typeof d||d.length<1?alert("没有可导出的数据"):null!=(t=xt(d))?(t=_t(t),F(this).attr("href","data:text/csv;charset=utf-8,\ufeff"+t),F(this).attr("download",c+".csv")):alert("没找到有效的数据集")}),F("#a_faction_parade").click(function(){F("#api_result_container").val("");const l=F("#api_input_id").val();Ot("开始帮派大阅兵，将拉取帮派成员列表，然后逐个查询该成员的详细信息，再使用蛙蛙探测器增加分析结果，最后导出为csv文件。"),Ot("请注意："),Ot("1、此功能会调用很多次API接口，所以不要太频繁使用。"),Ot("2、为了避免太频繁被封接口，每次查询做了延时，所以运行时间较久，请耐心等待。"),Ot("3、如果想中途放弃，请直接关掉本网页窗口。");let a=`https://api.torn.com/faction/${l}?selections=basic&key=${y}`;F("#api_result_header").text(`帮派大阅兵 ${l}`),console.log(`Request: ${a}`),Ot("\n开始获取帮派成员列表"),fetch(a).then(t=>t.ok?t.json():void Ot("阅兵失败"),t=>{Ot("阅兵失败，网络异常")}).then(t=>{console.log(`Response: ${a}`),console.log(t);const n=Object.keys(t.members),e=n.length;Ot(`获取帮派成员列表完成，共有 ${e} 个成员`);let i=new Array,o=0;function r(){const e=n[o];let a=t.members[e];a.userId=e,i.push(a),At(e,function(t){Ot(`蛙蛙探测 userId: ${e} 成功`),Object.assign(a,t),s()},function(t){Ot(`蛙蛙探测 userId: ${e} 失败`),s()})}function s(){if(o<e-1)++o,setTimeout(r,1e3);else{Ot("蛙蛙探测完成"),Ot("\n开始转换为csv格式...");var a=_t(i);const n=F("#a_faction_parade_download");n.attr("href","data:text/csv;charset=utf-8,\ufeff"+a);let t=new Date;n.attr("download",`FactionParade_${l}_${t.format("yyyyMMdd_hhmm")}.csv`),Ot("转换为csv格式完成"),Ot("\n开始下载");let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),document.getElementById("a_faction_parade_download").dispatchEvent(e)}}Ot("\n开始启动蛙蛙探测..."),r()})}),F("#a_faction_attacks").click(function(){var t=F("#api_input_from_time").val();const d=new Date(t);let c=d.getTime()/1e3;var e=F("#api_input_to_time").val();const p=new Date(e),h=p.getTime()/1e3;if(isNaN(c)||isNaN(c))alert("此功能必须输入起止时间（你的电脑本地时间，不要转为TCT）");else{F("#api_result_container").val(""),Ot("开始帮战统计，将自动切分时间段，拉取帮派attacks记录（每次最多100条），然后拼接，最后导出为csv文件。"),Ot("请注意："),Ot("1、此功能需要帮派API权限。"),Ot("2、此功能会调用很多次API接口，所以不要太频繁使用。"),Ot("3、每30秒才访问一次（因为测试发现数据有缓存），所以运行时间较久，请耐心等待。"),Ot("4、如果想中途放弃，请直接关掉本网页窗口。"),Ot(`\n开始时间：${t} 时间戳 ${c} ，结束时间：${e} 时间戳 ${h} \n`);let l=new Object;!function r(){const s=`https://api.torn.com/faction/?selections=attacks&key=${y}&from=${c}&to=${h}`;console.log(`Request: ${s}`),F("#api_result_header").text("帮战统计"),fetch(s).then(t=>t.ok?t.json():(Ot("抓取失败，将1秒后重试"),void setTimeout(r,1e3)),t=>{Ot("抓取失败，将1秒后重试"),setTimeout(r,1e3)}).then(t=>{function e(){Ot("\n攻击记录抓取完成，开始转换为csv格式...");var t=_t(vt(l));const e=F("#a_faction_attacks_download");e.attr("href","data:text/csv;charset=utf-8,\ufeff"+t),e.attr("download",`FactionAttacks_${d.format("yyyyMMddhhmmss")}_${p.format("yyyyMMddhhmmss")}.csv`),Ot("转换为csv格式完成"),Ot("\n开始下载");let a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),document.getElementById("a_faction_attacks_download").dispatchEvent(a)}console.log(`Response: ${s}`),console.log(t),Object.assign(l,t.attacks);var a=vt(t.attacks);if(0<a.length){var n=a[0].timestamp_started;const i=new Date(1e3*n);t=a[a.length-1].timestamp_started;const o=new Date(1e3*t);Ot(`抓取 ${c} - ${h} 有 ${a.length} 条，第一条 ${n} ${i.format("yyyy/MM/dd hh:mm:ss")}，最后一条 ${t} ${o.format("yyyy/MM/dd hh:mm:ss")}，累计 ${Object.keys(l).length} 条`),t<c||t>h?1<a.length?(Ot("抓取的数据没有更新，准备重试"),setTimeout(r,1e4)):(Ot("系统会莫名其妙的卡在最后一条，直接完成"),e()):(c=t+2,setTimeout(r,30500))}else e()})}()}})}),F("#bwm-company").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="mycompany_container" style="width: inherit">
                            <div id="mycompany-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <span id="companyname" role="button" style="font-size: large; color:#777;" >我的公司</span>
                            </div>
                            <div id="tips-view-company" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="mycompany-content" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",n),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s);var t=Mt();console.log("userId "+t),nt(t).then(function(t){console.log(t);t=t[3];"Employee"==t?R(F("#mycompany-content")):"Director"==t&&W(F("#mycompany-content"))}).catch(t=>console.log("userId2otherIds "+t))}),F("#bwm-faction").click(function(){function r(){var t=window.localStorage.getItem("faction_compare_history");if(null!=t){var e,a=JSON.parse(t);for(e in a)F("#bwm_faction_history").append(`
                                    <div class="wrapper-history" style="width:135px;float:left;border:1px solid darkgray;margin:5px 10px;">
                                        <div class="head-history" style="background-color:black;color:white;padding:5px;overflow:hidden;">
                                            <div class="id-history" style="width:30%;float:left;margin-left:50%;position:relative;left:-15%;">${e}</div>
                                            <div style="float:right;cursor:pointer;background-color:white;color:black;padding:0px 2px;">
                                                <a class="delete-history" role="button" >X</a>
                                            </div>
                                        </div>
                                        <div class="content-history" style="background-color:white;padding:5px;">
                                            <a style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" class="user faction" href="/factions.php?step=profile&amp;ID=${e}" target="_blank">${a[e]}</a>
                                        </div>
                                    </div>`);F(".delete-history").click(function(){var t=F(this).parent().parent().children(".id-history").text();Dt("faction_compare_history",t),F(this).parent().parent().parent().remove(),console.log("删除成功: "+t)}),F(".head-history").click(function(){const t=F(this).siblings(".content-history");var e;"selected"==t.attr("selected")?(t.css("background-color","white"),t.removeAttr("selected"),F("#faction-input-id").val("")):(F(".content-history").css("background-color","white"),F(".content-history").removeAttr("selected"),t.css("background-color","navajowhite"),t.attr("selected","selected"),e=F(this).children(".id-history").text(),F("#faction-input-id").val(e))})}}function t(i,t){t.empty(),t.append(`
                            <div id="name-faction" style="font-size: 20px; margin: 4px;"><img id="tag-faction" style="margin-right: 4px;"><span></span></div>
                            <div id="rank-faction" style="margin: 2px;"></div>
                            <div id="detail-faction" style="margin: 2px;"></div>
                            <div id="table-faction">
                                <table class="table-faction-table" style="margin:auto;background-color:white;font-size:12px;">
                                    <tr class="head">
                                        <th class="table-online">Online</th>
                                        <th>Name</th>
                                        <th class="table-last">Last</th>
                                        <th class="table-status">Status</th>
                                        <th class="table-position">Position</th>
                                        <th class="table-days">Days</th>
                                        <th>Attack</th>
                                        <th class="table-bs">BS</th>
                                        <th class="table-networth">Networth</th>
                                        <th>Description</th>
                                    </tr>
                                </table>
                            </div>`),F("#table-faction").find(".table-faction-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;");t=`https://api.torn.com/faction/${i}?selections=basic&key=${y}`;const o=F("#bmw_faction_tips");o.text("---探测中 "+i+"---"),fetch(t).then(t=>t.ok?t.json():void o.text("---探测失败 "+i+"---"),t=>{o.text("---网络异常 "+i+"---")}).then(t=>{console.log("API fetched: "+i),null!=t&&o.text("---探测完成 "+i+"---"),F("#name-faction").children("span").text(`${t.name} - ${i}`),F("#tag-faction").attr("src",`https://factiontags.torn.com/${t.tag_image}`),F("#rank-faction").text(`Rank: ${t.rank.name} - ${t.rank.division}`),It("faction_compare_history",i,t.name),F("#bwm_faction_history").empty(),r(),F(".id-history").each(function(){F(this).text()==i&&F(this).parent().parent().children(".content-history").css("background-color","NavajoWhite")});var e=Object.keys(t.members).length;const a=t.respect;var n=a.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","});F("#detail-faction").text(`Members: ${e} | Resp: ${n} | Best Chain: ${t.best_chain}`),F.each(t.members,function(t,e){var a=t,n=z(a),i=T(e.last_action.timestamp),o=e.status.state,r=e.status.description,s=e.status.until,t=e.status.color,o=N(r,o,s),s=function(t){let e=$t("networths",t),a="";null!=e&&null!=e?a=yt(e):e=0;return[e,a]}(a);let l="white";"Leader"!=e.position&&"Co-leader"!=e.position||(l="NavajoWhite");let d="grey",c=1;"Online"==e.last_action.status?(d="DarkSeaGreen",c=3):"Idle"==e.last_action.status&&(d="Orange",c=2);e=`
                                        <tr class="content">
                                            <td class="table-online" code="${c}" style="border: 1px solid darkgray;padding:5px;color:white;background-color:${d}">${e.last_action.status}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;"><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${e.name}</a></td>
                                            <td class="table-last" style="border: 1px solid darkgray;padding:5px;" last-action-minutes="${i[0]}">${i[1]}</td>
                                            <td class="table-status t-${t}" style="border: 1px solid darkgray;padding:5px;" hospital-minutes="${o[1]}">${o[0]}</td>
                                            <td class="table-position" style="border:1px solid darkgray;padding:5px;background-color:${l}">${e.position}</td>
                                            <td class="table-days" style="border: 1px solid darkgray;padding:5px;">${e.days_in_faction}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;"><a style="color:#006699;text-decoration:none;" href="/loader.php?sid=attack&user2ID=${a}" target="_blank">Attack</a></td>
                                            <td class="table-bs" style="border: 1px solid darkgray;padding:5px;" estimate-bs="${n[0]}">${n[2]}</td>
                                            <td class="table-networth" style="border: 1px solid darkgray;padding:5px;" networth="${s[0]}">${s[1]}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;">${e.status.details}</td>
                                        </tr>`;F("#table-faction").children(".table-faction-table").children().append(e)})}).catch(t=>console.log("fetch error",t))}F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="bwm_faction_container" style="width: inherit">
                            <div id="bwm_faction_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <input type="text" id="faction-input-id" name="faction-input-id" placeholder="帮派 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
                                <button id="faction-load-btn" class="torn-btn" style="margin:5px;">读取帮派</button>
                                <button id="faction-parade-start-btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
                                <button id="faction-parade-stop-btn" class="torn-btn" style="margin:5px;" disabled>停止阅兵</button>
                            </div>
                            <div id="bmw_faction_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="bwm_faction_history" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
                            <div id="bmw_faction_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",n),F("#bwm-mug").attr("style",s),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s),r();let e=window.localStorage.getItem("MY_FACTION_ID");void 0!==e&&null!==e||(e="20465"),F("#faction-load-btn").click(function(){F("#faction-input-id").val()||F("#faction-input-id").val(e),t(F("#faction-input-id").val(),F("#bmw_faction_wrapper")),St(F("th.table-bs"),M),St(F("th.table-last"),C),St(F("th.table-status"),O),St(F("th.table-online"),I),St(F("th.table-position"),S),St(F("th.table-days"),A),St(F("th.table-networth"),D)});let i=!0;F("#faction-parade-start-btn").click(function(){i=!0,F("#faction-load-btn").prop("disabled",!0),F("#faction-parade-start-btn").prop("disabled",!0),F("#faction-parade-stop-btn").removeAttr("disabled"),F("tr.head").attr("style","pointer-events: none;");const t=F(".table-faction-table").children().children("tr.content").first();t.length<=0?(F("#bmw_faction_tips").text("未找到用户列表"),F("#faction-load-btn").removeAttr("disabled"),F("#faction-parade-start-btn").removeAttr("disabled"),F("#faction-parade-stop-btn").prop("disabled",!0),F("tr.head").removeAttr("style")):(F("#bmw_faction_tips").text("阅兵开始"),setTimeout(()=>{!function e(a){if("1"==a.attr("detected"))F("#bmw_faction_tips").text("用户已完成"),setTimeout(()=>{e(a.next())},0);else if(a.length<=0||0==i)F("#bmw_faction_tips").text("阅兵已结束"),F("#faction-load-btn").removeAttr("disabled"),F("#faction-parade-start-btn").removeAttr("disabled"),F("#faction-parade-stop-btn").prop("disabled",!0),F("tr.head").removeAttr("style");else{a.attr("detected","1");const n=a.find("a.user.name").attr("href").replace(/[^0-9|-]/gi,"");F("#bmw_faction_tips").text("正在阅兵: "+n),At(n,function(t){a.children("td.table-bs").text(yt(t.estimate_bs)),a.children("td.table-bs").attr("estimate-bs",t.estimate_bs),It("battlestats",n,t.estimate_bs),a.children("td.table-networth").attr("networth",t.personalstats.networth),a.children("td.table-networth").text(yt(t.personalstats.networth)),It("networths",n,t.personalstats.networth),setTimeout(()=>{e(a.next())},1e3)},function(t){F("#bmw_faction_tips").text("蛙蛙探测 "+n+" 失败 "+t),setTimeout(()=>{e(a.next())},1e3)})}}(t)},1e3))}),F("#faction-parade-stop-btn").click(function(){i=!1})}),F("#bwm-settings").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(function(){let e="";return Wt.forEach(t=>{e+=`
                            <tr style="height: 32px;">
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.title}</td>
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.desc}</td>
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">
                                    <select id="bwm_settings_${t.name}">
                                        <option value="false">关闭</option>
                                        <option value="true">打开</option>
                                    </select>
                                </td>
                            </tr>
                        `}),`
                        <div id="bwm_settings_container" style="width: inherit">
                            <div id="bwm_settings_header" style="text-align:center; margin-bottom: 10px;">
                                <table style="margin: auto">
                                    <tr>
                                        <td style="padding: 10px;">
                                            <span class="border-round" style="font-size: large; color: #333; background-color:#ccc; padding:5px;border:3px solid #333;">设置</span>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="bwm_settings_table" style="text-align:center; margin-bottom: 10px;">
                                <table style="border:1px solid darkgray; padding: 5px; margin: auto">
                                    <tr style="height: 32px;">
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能名称</th>
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能描述</th>
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能状态</th>
                                    </tr>
                                    ${e}
                                </table>
                            </div>
                        </div>
                    `}()),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-settings").attr("style",n),F("#bwm-warroom").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s),Wt.forEach(t=>{F(`#bwm_settings_${t.name}`).val($t("BWM_SETTINGS",t.name)),F(`#bwm_settings_${t.name}`).change(function(){It("BWM_SETTINGS",t.name,F(this).val())}),window[t.name]="true"==$t("BWM_SETTINGS",t.name)})}),F("#bwm-mug").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="mug_container" style="width: inherit">
                            <div id="mug-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <input type="text" id="mug-watchlist-id-input" placeholder="肥羊 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
                                <button id="mug-watchlist-add-input" class="torn-btn" style="margin: 5px;">加入监视</button>
                            </div>
                            <div id="mug-watchlist" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
                            <div id="mug-loglist" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",n),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s);let o={};function a(){var t=window.localStorage.getItem("muglog-watchlist");if(null!=t){var a,n=JSON.parse(t);let e=`
                            <table id="mug-watchlist-table" style=" background-color: white; font-size:12px; margin:auto;"><tr class="mug-watchlist-table-head"><th>Victim ID</th><th>Victim Name</th><th>Total Mugged</th><th>删除</th></tr>`;for(a in n){let t="$0";a in o&&(t=ut(o[a].amount)),e+=`
                                    <tr class="mug-watchlist-table-content">
                                        <td class="mug-watchlsit-victimid">${a}</td>
                                        <td><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${n[a].name}</a></td>
                                        <td>${t}</td>
                                        <td><a class="mug-watchlist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
                                    </tr>`}e+="</table>",F("#mug-watchlist").append(e),F("#mug-watchlist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),F("#mug-watchlist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}F(".mug-watchlist-delete").click(function(){var t=F(this).parent().parent().children(".mug-watchlsit-victimid").text();Dt("muglog-watchlist",t),F(this).parent().parent().remove(),console.log("删除成功 "+t)})}!function(){var e=window.localStorage.getItem("muglog");if(null!=e){var a,n=JSON.parse(e);let t="</table>";for(a in n){var i=n[a].victim_id;i in o?o[i].amount+=ut(n[a].money_mugged):o[i]={name:n[a].victim_name,amount:ut(n[a].money_mugged)},t=`
                                    <tr class="mug-loglist-table-content">
                                        <td class="mug-loglist-ts">${a}</td>
                                        <td class="mug-loglist-time">${n[a].timestring}</td>
                                        <td class="mug-loglist-victimid">${n[a].victim_id}</td>
                                        <td class="mug-loglist-victimname"><a class="user name" href="/profiles.php?XID=${n[a].victim_id}" target="_blank">${n[a].victim_name}</a></td>
                                        <td class="mug-loglist-amount" title="${n[a].timestring}">${n[a].money_mugged}</td>
                                        <td><a class="mug-loglist-watch" role="button" style="cursor: pointer; color: darkblue;">监视</a></td>
                                        <td><a class="mug-loglist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
                                    </tr>`+t}t=`
                                <table id="mug-loglist-table" style=" background-color: white; font-size:12px; margin: auto;">
                                    <tr class="mug-loglist-table-head">
                                        <th class="mug-loglist-ts">Timestamp</th>
                                        <th class="mug-loglist-time">Time</th>
                                        <th class="mug-loglist-victimid">Victim ID</th>
                                        <th class="mug-loglist-victimname">Victim Name</th>
                                        <th class="mug-loglist-amount">Money Mugged</th>
                                        <th>监视</th><th>删除</th>
                                    </tr>`+t,F("#mug-loglist").append(t)}F("#mug-loglist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),F("#mug-loglist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),F("#mug_container")[0].clientWidth<400&&(F(".mug-loglist-ts").hide(),F(".mug-loglist-victimid").hide(),F(".mug-loglist-time").hide())}(),a(),F(".mug-loglist-delete").click(function(){var t=F(this).parent().parent().children(".mug-loglist-ts").text();Dt("muglog",t),F(this).parent().parent().remove(),console.log("删除成功 "+t)}),F(".mug-loglist-watch").click(function(){var t=F(this).parent().parent().children(".mug-loglist-victimid").text();It("muglog-watchlist",t,{name:F(this).parent().parent().children(".mug-loglist-victimname").text()}),F("#mug-watchlist-table").remove(),a(),console.log("监视成功 "+t)}),F("#mug-watchlist-add-input").click(function(){const e=F("#mug-watchlist-id-input").val();var t;isNaN(e)||0==e||""==e?alert("无效ID"):(t=`https://api.torn.com/user/${e}?selections=profile&key=${y}`,fetch(t).then(t=>t.json()).then(t=>{if(console.log("API fetched"),null!=t.error&&6==t.error.code)throw alert("无效ID "+e),new Error("Incorrect ID");It("muglog-watchlist",e,{name:t.name}),F("#mug-watchlist-table").remove(),a(),alert("监视成功 "+t.name+"["+e+"]"),console.log("监视成功 "+t.name+"["+e+"]")}).catch(t=>console.log("fetch error: ",t.message)))})}),F("#bwm-return").click(function(){F("#bwm").slideUp("slow",function(){F("#bwm").remove()})}),F("#bwm-warroom").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="bwm_warroom_container" style="width:inherit;">
                            <div id="bwm_warroom_header" style="margin:10px 0px; border:1px solid darkgray;text-align:center;">
                                <span id="bwm_warroom_counter" style="margin:5px;padding:5px;"></span>
                                <span style="font-size: large;">WAR ROOM</span>
                                <button class="torn-btn" id="warroom-btn" style="margin:5px;padding:5px;">更多详情</button>
                            </div>
                            <div id="bwm_warroom_filter" style="margin:10px 0px; border:1px solid darkgray; padding: 5px; text-align:center;">
                            </div>
                            <div id="bwm_warroom_wrapper" style="margin:10px 0px; overflow:hidden;">
                            </div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-warroom").attr("style",n),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",s);let e=[];function r(t,e){return`
                                <div style="position:relative; top:0; width:100%; height:12px; color:${e}; padding:2px 0px; text-align:center;">${t}%</div>
                                <div style="position:relative; top:-16px; width:100%; left:${t-100}%; height:12px; padding:2px 0px; z-index:2; overflow:hidden;">
                                    <div style="position:absolute; top:0; width:100%; left:${100-t}%; height:12px; color:#fff; background-color:${e}; padding:2px 0px; text-align:center;">${t}%</div>
                                </div>`}!function(){const t=`https://api.torn.com/torn/?selections=territorywars&key=${y}`,e=F("#bwm_warroom_filter");e.text("---探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---探测失败---"),t=>{e.text("---网络异常---")}).then(t=>{null!=t&&e.text("---探测完成---"),F("#bwm_warroom_counter").text("(当前存在 "+Object.keys(t.territorywars).length+" 场战斗)"),F.each(t.territorywars,function(t,e){var a=function(t,e){let a=Math.abs(parseInt((new Date).getTime()/1e3)-t);e=parseInt(100*a/e);let n="";86400<=a&&(n+=parseInt(a/86400)+"天",a%=86400);3600<=a&&(n+=parseInt(a/3600)+"时",a%=3600);60<=a&&(n+=parseInt(a/60)+"分",a%=60);return n+=a+"秒",[n,e]}(e.started,259200);F("#bwm_warroom_wrapper").append(`
                                        <div class="ttwar" style="width:279px; float:left; border:1px solid darkgray; padding: 5px 2px;margin:5px 2px;background-color:white;background-image: linear-gradient(rgba(192,84,47,0.8),rgba(192,84,47,0.5));">
                                            <div class="ttwar-title" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><button class="torn-btn">${t}</button></div>
                                                <div style="width:100px; float:left; text-align:center; margin:11px 3px;"><b>进攻方</b></div>
                                                <div style="width:100px; float:left; text-align:center; margin:11px 3px;"><b>防守方</b></div>
                                            </div>
                                            <div class="ttwar-faction" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派ID</b></div>
                                                <div class="factionid" style="width:100px; float:left; text-align:center; margin:5px 3px;"><a href="/factions.php?step=profile&ID=${e.assaulting_faction}">${e.assaulting_faction}</a></div>
                                                <div class="factionid" style="width:100px; float:left; text-align:center; margin:5px 3px;"><a href="/factions.php?step=profile&ID=${e.defending_faction}">${e.defending_faction}</a></div>
                                            </div>
                                            <div class="ttwar-factionname" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派名称</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px; overflow:hidden; text-overflow:ellipsis;     white-space:nowrap;"></div> 
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px; overflow:hidden; text-overflow:ellipsis;  white-space:nowrap;"></div>  
                                            </div>
                                            <div class="ttwar-factiontag" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派缩写</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-factionresp" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派声望</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-hospitalcount" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>医院人数</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-score" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>当前分数</b></div>
                                                <div class="territory-${t}" style="width:206px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-score-pbar" style="overflow:hidden; display:none;">
                                                <div class="faction-${e.assaulting_faction}" style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>分数进度</b></div>
                                                <div class="territory-${t}" style="width:212px; height:16px; margin:3px; float:left; text-align:center; overflow:hidden; background-color:#ddd;"></div>
                                            </div>
                                            <div class="ttwar-time" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>时间已过</b></div>
                                                <div style="width:206px; float:left; text-align:center; margin:5px 3px;">${a[0]}</div>
                                            </div>
                                            <div class="ttwar-time-pbar" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>时间进度</b></div>
                                                <div style="width:212px; height:16px; margin:3px; float:left; text-align:center; overflow:hidden; background-color:#ddd;">${r(a[1],"#5580a0")}</div>
                                            </div>
                                        </div>`)})}).catch(t=>console.log("fetch error: ",t.message))}(),F("#warroom-btn").click(function(){F(".factionid").each(function(){var t=F(this).text();-1==e.indexOf(t)&&e.push(t)}),90<e.length&&(e=e.slice(0,90)),F.each(e,function(t,e){!function(t,e){const a=`https://api.torn.com/faction/${t}?selections=basic&key=${y}`,n=F("#bwm_warroom_filter");n.text("---探测中---"),fetch(a).then(t=>t.ok?t.json():void n.text("---探测失败---"),t=>{n.text("---网络异常---")}).then(t=>{null!=t&&n.text("---探测完成---");let a=0;F.each(t.members,function(t,e){"Hospital"==e.status.state&&(a+=1)}),t.hospital_count=a,e(t)}).catch(t=>console.log("fetch error: ",t.message))}(e,function(o){console.log("api fetched"),F.each(o.territory_wars,function(t,e){var a=e.territory,n=e.score+" / "+e.required_score;F(".ttwar-score").children(".territory-"+a).text(n);n=r(parseInt(100*e.score/e.required_score),"#499360");F(".ttwar-score-pbar").children(".territory-"+a).html(n);e=(o.hospital_count/500).toFixed(2);const i=F(".territory-"+a).parent().parent().css("background-image");n=i.split(",")[3].replace(")",""),e=Number(n)+Number(e);F(".territory-"+a).parent().parent().css("background-image","linear-gradient(rgba(192,84,47,"+e+"),rgba(192,84,47,0.5))")}),F(".ttwar-factionname").children(".faction-"+e).text(o.name),F(".ttwar-factiontag").children(".faction-"+e).text(o.tag),F(".ttwar-factionresp").children(".faction-"+e).text(bt(o.respect)),F(".ttwar-hospitalcount").children(".faction-"+e).text(o.hospital_count)})}),F("[class*='ttwar'][style*='none']").attr("style","overflow:hidden"),F(this).attr("disabled","true")})}),F("#bwm-revive").click(function(){F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="bwm_revive_container" style="width: inherit">
                            <div id="bwm_revive_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                    <input type="text" id="faction-input-id" name="faction-input-id" placeholder="多个帮派ID可以使用逗号分隔" size="30" style="font-size: larger; padding: 5px; margin: 5px;" />
                                    <button id="revive-start-btn" class="torn-btn" style="margin:5px;">开始复活</button>
                                    <button id="revive-stop-btn" class="torn-btn" style="margin:5px;" disabled>停止复活</button>
                            </div>
                            <div id="bwm_revive_filter" style="margin:10px 0px; border:1px solid darkgray; text-align:center; overflow: hidden;">
                                <div style="display: inline; margin:0px 15px;">
                                    <span>每次刷新间隔</span>
                                    <select id="bwm_revive_delay" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="1" selected>1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                    </select>
                                    <span>秒</span>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示Online</span>
                                    <select id="bwm_revive_online_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false" selected>否</option>
                                        <option value="true">是</option>
                                    </select>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示Hospitalized</span>
                                    <select id="bwm_revive_hosp_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false" selected>否</option>
                                        <option value="true">是</option>
                                    </select>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示在城内</span>
                                    <select id="bwm_revive_town_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false">否</option>
                                        <option value="true" selected>是</option>
                                    </select>
                                </div>
                            </div>
                            <div id="bmw_revive_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="bmw_revive_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;">
                            </div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",n),F("#bwm-rankedwar").attr("style",s);let d=!0,c=0,u=1;F("#revive-start-btn").click(function(){F("#bmw_revive_wrapper").empty(),F("#revive-start-btn").prop("disabled",!0),F("#revive-stop-btn").removeAttr("disabled"),F("#faction-input-id").prop("disabled",!0),F("#bwm_revive_delay").prop("disabled",!0),F("#bwm_revive_online_only").prop("disabled",!0),F("#bwm_revive_hosp_only").prop("disabled",!0),F("#bwm_revive_town_only").prop("disabled",!0),F("#bmw_revive_tips").text("即将开始刷新......"),d=!0,u=1;const t=F("#faction-input-id").val().trim().split(/,|，/).map(function(t,e,a){return t.trim()}),s=t.length||1;let e=new Array(s).fill(null);const l=1e3*F("#bwm_revive_delay").val();let g="";"true"==F("#bwm_revive_online_only").val()&&(g="Online");let m="";"true"==F("#bwm_revive_hosp_only").val()&&(m="Hospitalized");let b="";"true"==F("#bwm_revive_town_only").val()&&(b="town"),c=setTimeout(()=>{!function e(a,n,i){if(0==d||0==F("#bmw_revive_wrapper").length)F("#bmw_revive_wrapper").children(":last").remove(),F("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:200px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.purple}; color: white;">刷新结束 本次共完成了 ${u-1} 次刷新</div></div>`);else{const h=a[i];let t=0;i<a.length-1&&(t=i+1);const f=n[i];var o=`https://api.torn.com/faction/${h}?selections=basic&key=${y}`;const r=F("#bmw_revive_tips");r.text("---探测中 "+h+"---"),fetch(o).then(t=>t.ok?t.json():void r.text("---探测失败 "+h+"---"),t=>{r.text("---网络异常 "+h+"---")}).then(p=>{console.log(`faction: ${h} | delay: ${l/1e3}s | online: ${F("#bwm_revive_online_only").val()} | hosp: ${F("#bwm_revive_hosp_only").val()} | town: ${F("#bwm_revive_town_only").val()}`),n[i]=p,F("#bmw_revive_wrapper").children(":last").remove(),F.each(p.members,function(t,e){const a=e.last_action.status;let n=Lt.yellow;"Online"==a?n=Lt.green:"Offline"==a&&(n=Lt.gray);var i=T(e.last_action.timestamp),o=e.status.description;const r=e.status.details,s=e.status.state;var l=e.status.until,d=e.status.color;const c=N(o,s,l);var i=`
                                                <div style="overflow: hidden;">
                                                    <div class="border-round" style="float: left; width:80px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.purple}; color: white;">第${u}次刷新</div>
                                                    <div class="border-round" style="float: left; width:35px; padding: 2px 4px; margin: 2px 4px; background-color: ${n}; color: white;">${a}</div>
                                                    <div class="border-round" style="float: left; width:35px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.pink};">
                                                        <a href="/factions.php?step=profile&ID=${h}" style="text-decoration: none; color: white;" target="_blank">${p.tag}</a>
                                                    </div>                       
                                                    <div class="border-round" style="float: left; width:90px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.blue};">
                                                        <a href="/profiles.php?XID=${t}" style="text-decoration: none; color: white;" target="_blank">${e.name}</a>
                                                    </div>                        
                                                    <div class="border-round" style="float: left; width:100px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.green}; color: white;">上次在线 ${i[1]}</div>                     
                                                    <div class="border-round" style="float: left; width:100px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.red}; color: white;">入院时间 ${c[0]}</div>                     
                                                    <div class="border-round" style="float: left; width:300px; padding: 2px 4px; margin: 2px 4px; color:#ccc;background-color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${r}</div>
                                                </div>`;0==s.indexOf("Hospital")&&(0!=a.indexOf(g)||0!=r.indexOf(m)||0!=c[2].indexOf(b)||null!=f&&f.members[t].status.until==l||F("#bmw_revive_wrapper").append(i))}),u+=1,F("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:80px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.purple}; color: white;">第${u}次刷新</div></div>`),c=setTimeout(()=>{e(a,n,t)},l*s)}).catch(t=>console.log("fetch error",t))}}(t,e,0)},l*s)}),F("#revive-stop-btn").click(function(){d=!1,clearTimeout(c),F("#revive-stop-btn").prop("disabled",!0),setTimeout(()=>{F("#revive-start-btn").removeAttr("disabled"),F("#faction-input-id").removeAttr("disabled"),F("#bwm_revive_delay").removeAttr("disabled"),F("#bwm_revive_online_only").removeAttr("disabled"),F("#bwm_revive_hosp_only").removeAttr("disabled"),F("#bwm_revive_town_only").removeAttr("disabled"),F("#bmw_revive_wrapper").children(":last").remove(),F("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:200px; padding: 2px 4px; margin: 2px 4px; background-color: ${Lt.purple}; color: white;">刷新结束 本次共完成了 ${u-1} 次刷新</div></div>`)},1e3)})}),F("#bwm-rankedwar").click(function(){function h(t){t=Math.abs(parseInt((new Date).getTime()/1e3)-t);let e="";return e=86400<=t?parseInt(t/86400)+"天"+parseInt(t%86400/3600)+"小时":3600<=t?parseInt(t/3600)+"小时":60<=t?parseInt(t/60)+"分钟":t+"秒",e}F("#bwm").children(":last").remove(),F("#bwm").append(`
                        <div id="bwm_rw_container" style="width:inherit;">
                            <div id="bwm_rw_header" style="margin: 10px 0px; border: 1px solid darkgray; text-align: center;">
                                <span style="font-size: large;">RANKED WAR</span>
                            </div>
                            <div id="bwm_rw_filter" style="margin:10px 0px; padding: 5px; text-align: center;">
                            </div>
                            <div id="bwm_rw_wrapper" style="margin:10px 0px; text-align: center; overflow: hidden; overflow-x: auto;">
                            </div>
                        </div>`),F("#bwm-version").attr("style",s),F("#bwm-api").attr("style",s),F("#bwm-company").attr("style",s),F("#bwm-faction").attr("style",s),F("#bwm-mug").attr("style",s),F("#bwm-warroom").attr("style",s),F("#bwm-settings").attr("style",s),F("#bwm-revive").attr("style",s),F("#bwm-rankedwar").attr("style",n),function(){const t=`https://api.torn.com/torn/?selections=rankedwars&key=${y}`,e=F("#bwm_rw_filter");e.text("---探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---探测失败---"),t=>{e.text("---网络异常---")}).then(t=>{null!=t&&("error"in t?e.text(`--- API错误 --- code: ${t.error.code} error: ${t.error.error}`):"rankedwars"in t&&(e.text("---探测成功---"),F("#bwm_rw_wrapper").append(`
                                        <table class="rankedwar-records" style="width: 100%; margin: auto;">
                                            <tr class="head">
                                                <th class="war">ID</th>
                                                <th class="team">获胜 / 领先方</th>
                                                <th class="team">分数</th>
                                                <th class="team">分数</th>
                                                <th class="team">失败 / 落后方</th>
                                                <th class="war">分差 / 目标</th>
                                                <th class="war">进度</th>
                                                <th class="war">状态</th>
                                                <th class="war">描述</th>
                                            </tr>
                                        </table>`),F(".rankedwar-records").find("th.war").attr("style","border: 1px solid #333;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),F(".rankedwar-records").find("th.team").attr("style","border: 1px solid #333;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),F.each(t.rankedwars,function(t,e){var a=parseInt((new Date).getTime()/1e3);const n=Object.keys(e.factions),i=e.war.winner;let o=0,r=0,s="",l="",d="";var c=e.factions[n[0]].score,p=e.factions[n[1]].score;r=0<=n.indexOf(i.toString())?(s="已结束",l=`结束于 ${h(e.war.end)}前`,d="over",n[0]==i.toString()?(o=n[0],n[1]):(o=n[1],n[0])):a>=e.war.start?(s="战斗中",l=`战斗已持续${h(e.war.start)}`,d="warring",p<=c?(o=n[0],n[1]):(o=n[1],n[0])):(s="未开始",l=`即将开始于${h(e.war.start)}后`,d="notyet",o=n[0],n[1]);c=Math.abs(c-p),p=parseInt(100*c/e.war.target);F(".rankedwar-records").children().append(`
                                            <tr class="content">
                                                <td class="${d}"><a class="war-id" href="/war.php?step=rankreport&rankID=${t}" target="_blank">${t}</a></td>
                                                <td><a class="faction winning" href="/factions.php?step=profile&ID=${o}" target="_blank">${e.factions[o].name}</a></td>
                                                <td class="${d} score">${bt(e.factions[o].score)}</td>
                                                <td class="${d} score">${bt(e.factions[r].score)}</td>
                                                <td><a class="faction losing" href="/factions.php?step=profile&ID=${r}" target="_blank">${e.factions[r].name}</a></td>
                                                <td class="${d} score">${bt(c)} / ${bt(e.war.target)}</td>
                                                <td class="${d}">${p}%</td>
                                                <td class="${d}">${s}</td>
                                                <td class="${d}">${l}</td>
                                            </tr>
                                            `)}),F(".rankedwar-records").find("td").attr("style","border: 1px solid #333; padding: 5px; text-align: center; color: white; text-decoration: none;"),F(".rankedwar-records").find("a.faction").attr("style","color: white; text-decoration: none;"),F(".rankedwar-records").find("a.war-id").attr("style","color: #333; text-decoration: none;"),F(".rankedwar-records").find("td.over").css("background-color","#FFF5F7").css("color","#333"),F(".rankedwar-records").find("td.warring").css("background-color",Lt.yellow),F(".rankedwar-records").find("td.notyet").css("background-color",Lt.blue),F(".rankedwar-records").find("a.winning").parent().css("background-color",Lt.green),F(".rankedwar-records").find("a.losing").parent().css("background-color",Lt.red),F(".rankedwar-records").find("td.score").css("font-size","large")))})}()})}})}{function v(){const s=F("div.profile-buttons div.profile-container div.empty-block");if(0<s.length){s.hasClass("profile-container-description")||s.addClass("profile-container-description"),clearInterval(c),s.css({height:"75","padding-top":"5px","overflow-x":"auto"}),s.siblings(".buttons-wrap").css("padding","0px"),s.html("蛙蛙探测器工作中...");const t=F(".basic-information").find(".info-table").children(":first").children(".user-info-value").children().text();console.log(`user: ${t}`);const e=t?t.split("[")[0].trim():"",a=t?t.split("[")[1].replace("]","").trim():"",n=`/loader.php?sid=attack&user2ID=${a}`;F(".profile-status").children().children(".title-black").empty().append(`
                        <span class="border-round" style="color:white;background-color:#DAA520;padding:3px;text-shadow:none;">
                            <a href="${n}" style="color: white; text-decoration: none;">攻击</a></span>`);const i=Ct(e);i?F(".profile-status").children().children(".title-black").append(`
                        <span class="border-round" style="color:white;background-color:${i[0]};padding:3px;margin-left:5px;">上次唠嗑: ${i[1]}</span>`):console.log("没唠过");const o=Ft(a);if(console.log("mug_display_arr "+o),o){const r=o.split(",")[0],l=o.split(",")[1],d=o.split(",")[2];F(".profile-status").children().children(".title-black").append(`
                        <span class="border-round" style="color:white;background-color:${r};padding:3px;margin-left:5px;">上次mug: ${d} - ${l}</span>`)}else console.log("没mug过");At(a,function(t){s.html(`
                            <table style="width:100%; background-color: #FFF5F7;">
                                <tr>
                                    <td class="bw-bs">战力</td>
                                    <td colspan="3">${t.estimate_bs_display}</td>
                                    <td class="bw-stat">XAN</td>
                                    <td>${t.personalstats.xantaken||0}</td>
                                    <td class="bw-other">活跃天数</td>
                                    <td>${parseInt(t.estimate_active_days)||0}</td>
                                </tr>
                                <tr>
                                    <td class="bw-nw">资产</td>
                                    <td>${yt(t.personalstats.networth)}</td>
                                    <td class="bw-stat">Refill</td>
                                    <td>${t.personalstats.refills||0}</td>
                                    <td class="bw-stat">LSD</td>
                                    <td>${t.personalstats.lsdtaken||0}</td>
                                    <td class="bw-other">估算WS</td>
                                    <td>${yt(t.estimate_ws)||0}</td>
                                </tr>
                                <tr>
                                    <td class="bw-nw">NNB</td>
                                    <td>${t.estimate_nnb||10}</td>
                                    <td class="bw-stat">DefWon</td>
                                    <td>${t.personalstats.defendswon||0}</td>
                                    <td class="bw-stat">SE</td>
                                    <td>${t.personalstats.statenhancersused||0}</td>
                                    <td colspan="2"><a class="t-blue" role="button" id="a_click_start_wawa" style="cursor: pointer">更多&gt;&gt;</a></td>
                                </tr>
                            </table>
                        `),s.find("td").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;"),s.find(".bw-bs").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #033649;color: white;font-weight: bold;"),s.find(".bw-nw").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #757947;color: white;font-weight: bold;"),s.find(".bw-other").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #725334;color: white;font-weight: bold;"),s.find(".bw-stat").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #458994;color: white;font-weight: bold;"),F("div.user-information-section:contains('Last action')").next().children("span").text(t.last_action_details);const e=F("div.profile-buttons.profile-action").html(),a=`
                    <div>
                        <div class="title-black top-round">蛙蛙探测器&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <a class="t-white" role="button" id="a_click_start_wawa_back" style="cursor: pointer">返回</a>
                        </div>
                        <div class="cont bottom-round ">
                            <div class="profile-container basic-info bottom-round">
                                <table style="width:100%; min-height: 320px;">
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">估算战力</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_bs_display}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">Xanax数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.xantaken||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">SE数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.statenhancersused||0}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">攻击胜率</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.attackWinRatio)||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">防守胜率</td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.defendWinRatio)||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">防守胜场</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.defendswon||0}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">能量续满</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.refills||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">LSD数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.lsdtaken||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">DP占比</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.donator_percent)}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">活跃天数</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_active_days}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">日均嗑药</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.average_drugs}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">Booster</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.personalstats.boostersused)}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">估算ACE</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_ace}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">估算NNB</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_nnb}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">总资产</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.personalstats.networth)}</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>`,n=function(){F("div.profile-buttons.profile-action").html(a),F("div.profile-status").hide(),F("#a_click_start_wawa_back").click(function(){F("div.profile-buttons.profile-action").html(e),F("div.profile-status").show(),F("#a_click_start_wawa").click(n)})};F("#a_click_start_wawa").click(n);let i=0;i+=t.enemies/10,i-=t.friends/20,i+=t.personalstats.moneymugged/2e8,i+=t.personalstats.bountiesreceived/50,i=parseInt(i);let o="",r="";r=i<=0?(o="大善人",Lt.yellowgreen):i<=10?(o="好人",Lt.blue):i<=100?(o="坏人",Lt.yellow):(o="大恶人",Lt.red),F("div.basic-information").find("ul.info-table").children("li:eq(9)").children("div.user-info-value").append(`
                    &nbsp;<span class="border-round" style="padding:2px;background-color:${r};color:white;" title="0分及以下：大善人<br>1-10分：好人<br>11-100分：坏人<br>100分以上：大恶人">${o}</span>
                    &nbsp;<span title="每有10个敌人加1分<br>每有20个朋友减1分<br>每mug200m加1分<br>每收到50次悬赏加1分"><b>坏比指数: ${i}</b></span>
                    `)},function(t){s.html(t)})}}0<=window.location.href.indexOf("profiles.php")&&(c=setInterval(v,500))}function x(n,t){let i=!0;if(F("#parade_filter").length<=0){F(n).before('<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">阅兵</div><div id="parade_filter" class="cont-gray bottom-rounded content" style="overflow:hidden"><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Level" checked="checked">Level</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="BS" checked="checked">BS</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Mugged" checked="checked">Mugged</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rehab" checked="checked">Rehab</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rank" checked="checked">Rank</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Job" checked="checked">Job</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Networth" checked="checked">Networth</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Bazaar">Bazaar</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Defendslost">Defendslost</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Property">Property</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Elimination">Elimination</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Signup">Signup</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Last" checked="checked">Last</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Status" checked="checked">Status</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Life">Life</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="input-wrap" style="margin:5px 10px;"><label for="nw">Bazaar价值 大于 </label><input id="parade_bazaar_value" type="text" style="margin:1px 5px; width:50px" value="10">M</div><div class="btn-wrap" style="margin:5px 10px;"><span class="btn"><button id="parade_start" class="torn-btn" style="margin:1px 5px;">开始阅兵</button></span><span class="btn"><button id="parade_stop" class="torn-btn" style="margin:1px 5px;">暂停阅兵</button></span></div></div></div>'),F("#parade_stop").prop("disabled",!0);const a=$t("parade_option","checkbox_vals");var e=$t("parade_option","text_vals");null!=a&&null!=a&&(F("#parade_bazaar_value").val(e),F("#parade_filter input:checkbox").removeAttr("checked"),F("#parade_filter input:checkbox").each(function(t,e){0<=a.indexOf(F(this).val())&&F(this).attr("checked","checked")}))}F("#parade_start").click(function(){i=!0;let e=F(t).children("li").first();if(e.length<=0)alert("未找到用户列表");else{const h=F("#parade_bazaar_value").val().replace(/[^\d]/g,"");let c=[];F("#parade_filter input:checkbox:checked").each(function(t,e){c.push(F(this).val())}),console.log(c),F("#parade_filter input[type='checkbox']").prop("disabled",!0),F("#parade_filter input[type='text']").prop("disabled",!0),F(this).prop("disabled",!0),F("#parade_stop").removeAttr("disabled"),F("#parade_filter").css("background-color",Lt.blue);let t={};if(t.checkbox_vals=c,t.text_vals=h,window.localStorage.setItem("parade_option",JSON.stringify(t)),F("#search_parade_table").length<1){let e='<p id="search_parade_progress">阅兵进度</p><table id="search_parade_table" style="width:100%;background-color: white;font-size:12px;"><tr><th>Name</th>';for(let t=0;t<c.length;t++)e+=`<th>${c[t]}</th>`;e+="<th>Attack</th></tr></table>",F(n).before(e),F("#search_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")}function a(){if("1"==e.attr("detected"))console.log("user detected"),p(0);else{e.attr("detected","1");const d=e.find("a.user.name").attr("href").replace(/[^0-9|-]/gi,"");F("#search_parade_progress").text(`正在阅兵：${d}`),At(d,function(t){let n="Closed",i=0,o=0;if(t.basicicons.icon35){n="Opened";const e=t.bazaar;null!=e&&e.map(function(t,e,a){i+=t.quantity*t.market_price,o+=t.quantity*t.price})}if("Federal"==t.status.state||"Fallen"==t.status.state)console.log("被封/去世，跳过"),F("#search_parade_progress").text(`阅兵：${d} 被封/去世，跳过`),p(1e3);else if(h&&i<1e6*h)console.log("太穷，跳过"),F("#search_parade_progress").text(`阅兵：${d} 太穷，跳过`),It("battlestats",d,t.estimate_bs),p(1e3);else{let e={};e.Level=t.level,e.BS=yt(t.estimate_bs),e.Mugged=yt(t.personalstats.moneymugged),e.Rehab=yt(t.personalstats.rehabcost||0),e.Rank=t.rank_title,e.Networth=yt(t.personalstats.networth),e.Defendslost=t.personalstats.defendslost,e.Property=t.property,e.Signup=t.signup,e.Last=t.last_action_brief,e.Status=t.status.state,e.Elimination=null==t.competition?"":t.competition.team;const l=t.job.company_type;var r,s=t.job.position;0==l?e.Job=s:null!=(r=$t("APICache_companies","companies"))&&null!=r?(e.Job=r[l.toString()].name,e.Job+="Director"==s?"(D)":"(E)"):e.Job=l,e.Life=parseInt(t.life.current/t.life.maximum*100)+"%",e.Bazaar='<span class="t-red">Closed</span>',"Opened"==n&&(e.Bazaar=`<a href="/bazaar.php?userId=${d}"><span class="t-green">${yt(i)}</span><span class="t-red">/${yt(o)}</span></a>`);let a=`<tr><td><a class="user name" href="/profiles.php?XID=${d}" target="_blank">${t.name}</a></td>`;for(let t=0;t<c.length;t++)a+=`<td>${e[c[t]]}</td>`;a+=`<td><a class="t-blue c-pointer h attack-act" href="/loader2.php?sid=getInAttack&user2ID=${d}" target="_blank">Attack</a></td></tr>`,console.log(`蛙蛙探测 userId ${d} 成功: ${a}`),F("#search_parade_table").append(a),F("#search_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),It("battlestats",d,t.estimate_bs),p(1e3)}},function(t){console.log(`蛙蛙探测 userId: ${d} 失败`),p(1e3)})}}function p(t){e=e.next(),0<e.length&&1==i?(console.log(i),setTimeout(a,t)):(console.log("阅兵完成"),F("#search_parade_progress").text("阅兵完成"),F("#parade_filter input[type='checkbox']").removeAttr("disabled"),F("#parade_filter input[type='text']").removeAttr("disabled"),F("#parade_start").removeAttr("disabled"),F("#parade_stop").prop("disabled",!0),F("#parade_start").text("继续阅兵"),F("#parade_filter").css("background-color","#f2f2f2"))}console.log("阅兵开始"),a()}}),F("#parade_stop").click(function(){i=!1,console.log("阅兵暂停"),F("#search_parade_progress").text("阅兵暂停"),F("#parade_filter input[type='checkbox']").removeAttr("disabled"),F("#parade_filter input[type='text']").removeAttr("disabled"),F("#parade_start").removeAttr("disabled"),F("#parade_filter").css("background-color","#f2f2f2")})}foo&&0<=window.location.href.indexOf("page.php?sid=UserList")&&(x("div.userlist-wrapper","ul.user-info-list-wrap"),setInterval(function(){const t=F(".user-info-list-wrap").find(".user-icons");0<t.length&&t.each(function(){if("1"!=F(this).attr("hasdone")){F(this).attr("hasdone","1");const e=F(this).parent().siblings().children("a.user.name").children().attr("title");if(e){var t=Ct(e.split("[")[0].trim());if(t){const a=F(this).children(".icons-wrap");a.width(a.width()-70),F(this).children(".icons-wrap").after(`
                                        <span class= "border-round" title="<strong>上次唠嗑: </strong>${t[1]}" style="float:left;width:54px;height:18px;padding:2px;margin:0px 3px;background-color:${t[0]};text-align:center;">
                                            <span style="font-size:12px;display:inline-block;vertical-align:middle;color:white;padding:2px;">${t[1]}</span>
                                        </span>`)}}}})},500));{function f(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function v(){const t=F("ul.users-list").children("li");0<t.length&&t.each(function(t,e){if("1"!=F(this).attr("oversea")){const a=f(F(this)),n=F(this).find("a.name").attr("href").substring(18).trim();a in o&&F(this).css("background-color","NavajoWhite"),a in Bt&&F(this).css("background-color","DarkSeaGreen"),n in i&&F(this).css("background-color",Lt.purple),F(this).attr("oversea","1")}})}foo&&0<=window.location.href.indexOf("index.php?page=people")&&(x("div.travel-people","ul.users-list"),i={},null!=(e=window.localStorage.getItem("muglog-watchlist"))&&(i=JSON.parse(e)),setInterval(v,1e3))}const Zt={Mexico:{name:"墨西",time:18},Cayman:{name:"开曼",time:25},Canada:{name:"加拿",time:29},Hawaii:{name:"夏威",time:94},Argentina:{name:"阿根",time:117},United:{name:"英国",time:111},Switzerland:{name:"瑞士",time:123},Japan:{name:"日本",time:158},China:{name:"中国",time:169},UAE:{name:"迪拜",time:190},South:{name:"南非",time:208}};function w(t){return F(t).find("div.days").attr("last-action-minutes")}function _(t){return F(t).find("div.status").attr("sort_score")}function k(t){return F(t).find("div.position").attr("estimate-bs")}function $(t){return F(t).find("div.lvl").text()}function I(t){return F(t).find("td.table-online").attr("code")}function D(t){return F(t).find("td.table-networth").attr("networth")}function S(t){return F(t).find("td.table-position").text()}function A(t){return F(t).find("td.table-days").text()}function C(t){return F(t).find("td.table-last").attr("last-action-minutes")}function O(t){return F(t).find("td.table-status").attr("hospital-minutes")}function M(t){return F(t).find("td.table-bs").attr("estimate-bs")}function z(t){let e=$t("battlestats",t),a="",n="";return null!=e&&null!=e?(a=bt(e),n=yt(e)):e=0,[e,a,n]}function T(t){const e=new Date;t=parseInt(parseInt(e.getTime()/1e3)-t);let a="";return a=60<=t&&t<3600?parseInt(t/60)+"m":3600<=t&&t<86400?parseInt(t/3600)+"h":86400<=t?parseInt(t/86400)+"d":t+"s",[t,a]}function N(a,n,i){let o=0,r="town";const s=new Date;a=a.split(" ");if("Abroad"==n)n="="+Zt[a[1]].name,o=0-Zt[a[1]].time;else if("Traveling"==n)1<a.length&&("Traveling"==a[0]?(n=">"+Zt[a[2]].name,o=0-Zt[a[2]].time):"Returning"==a[0]&&(n="<"+Zt[a[4]].name,o=0-Zt[a[4]].time));else if("Hospital"==n){i=parseInt((i-parseInt(s.getTime()/1e3))/60);let t=parseInt(i/60);t=t<10?"0"+t:t;let e=i%60;e=e<10?"0"+e:e,"hospital"==a[1]?n=t+":"+e:(n="海"+t+":"+e,r="oversea"),o=i}return[n,o,r]}function P(t){F("li.days").text("Last"),F("li.position").text("BattleStats");let o=200;0<F("li.position").length&&(o=window.getComputedStyle(F("li.position")[0]).width.replace(/px$/g,""),console.log(o));var e=`https://api.torn.com/faction/${t}?selections=basic&key=${y}`;fetch(e).then(t=>t.json()).then(i=>{console.log("API fetched: "+t),F("li.table-row").each(function(){var t=F(F(this).find("span.m-hide")).children().attr("href").substring(18),e=z(t);100<Number(o)?F(F(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[1]):F(F(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[2]);var a=T(i.members[t].last_action.timestamp);F(F(this).find("div.days")).attr("last-action-minutes",a[0]).text(a[1]);var n=i.members[t].status.state,e=i.members[t].status.description,a=i.members[t].status.until,t=i.members[t].status.color,a=N(e,n,a);F(F(this).find("div.status")).attr("sort_score",a[1]).html(`<span class="t-${t}">${a[0]}</span>`)})}).catch(t=>console.log("fetch error",t))}function E(t,e,a){let n=[0,0,0];var i=$t("APICache_companies","companies");function o(t){return t[0]+t[1]<t[2]?2:t[0]>t[1]?0:1}function r(t){return 0<(t[0]-t[1])*(t[1]-t[2])?1:0<(t[0]-t[2])*(t[2]-t[1])?2:0}function s(t,e){return e/t<=1?e/t:1+(e-t)/t*.5}function l(t,e){return 0==t?"":e/t<1?"eff-red":e/t<2?"eff-yellow":"eff-green"}"unassigned"!=e&&null!=i&&null!=i&&(c=i[t].positions[e].man_required,p=i[t].positions[e].int_required,h=i[t].positions[e].end_required,n=[c,p,h]);var d,e=n[o(n)],c=a[o(n)],p=n[r(n)],h=a[r(n)];const f=.67*s(e,c)+.33*s(p,h),g=(d=f)<1?"eff-red":d<1.5?"eff-yellow":"eff-green",m=l(n[0],a[0]),b=l(n[1],a[1]),u=l(n[2],a[2]);return[f,g,m,b,u].concat(n)}function j(t){let e=0;t=$t("EMPLOYEE_RANK",t);return null!=t&&null!=t&&(e=t),e}function R(t){var e=`https://api.torn.com/company/?selections=profile,employees&key=${y}`;const a=F("#tips-view-company");a.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void a.text("---探测失败---"),t=>{a.text("---网络异常---")}).then(c=>{if(a.text("---探测完成---"),"error"in c)a.text(`---错误代码：${c.error.code} 错误：${c.error.error}---`);else if("company_employees"in c){F("#companyname").text(c.company.name),t.prepend(`
                        <table class="company-effectiveness" style="background-color: #FFF5F7;font-size:12px;margin:auto;">
                            <tr class="head">
                                <th class="employee-basic table-position">岗位</th>
                                <th class="employee-basic table-days">天</th>
                                <th class="employee-ws table-man">MAN</th>
                                <th class="employee-ws table-int">INT</th>
                                <th class="employee-ws table-end">END</th>
                                <th class="employee-effectiveness table-ws" title="Working Stats">属</th>
                                <th class="employee-basic table-last">登</th>
                                <th class="employee-basic table-username">名字</th>
                                <th class="employee-effectiveness table-settled" title="Settled In">天</th>
                                <th class="employee-effectiveness table-merits" title="Merits">点</th>
                                <th class="employee-effectiveness table-education" title="Director Education">课</th>
                                <th class="employee-effectiveness table-management" title="Management">理</th>
                                <th class="employee-effectiveness table-addiction" title="Addiction">药</th>
                                <th class="employee-effectiveness table-total" title="Total">总</th>
                                <th class="employee-status table-tornstats">参</th>
                            </tr>
                        </table>`);const p=t.children(".company-effectiveness");p.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;");let a=[];F.each(c.company_employees,function(t,e){e.userid=t,e.position_rank=j(t),a.push(e)}),a.sort(function(t,e){return t.position_rank-e.position_rank});const h={0:"",1:"eff-yellow",3:"eff-red"};F.each(a,function(t,e){var a=T(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,i=e.effectiveness.addiction||0,o=i<=-10?3:i<=-5?1:0,r=e.effectiveness.merits||0,s=r<=2?3:r<=4?1:0,l=n+o+s,d=3<=l?3:1<=l?1:0,l=E(c.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]);p.children().append(`
                            <tr class="content">
                                <td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
                                <td class="table-days">${e.days_in_company}</td>
                                <td class="table-man tright ${l[2]}" man="${e.manual_labor}" title="MAN Required: ${bt(l[5])}">${at(e.manual_labor)}</td>
                                <td class="table-int tright ${l[3]}" int="${e.intelligence}" title="INT Required: ${bt(l[6])}">${at(e.intelligence)}</td>
                                <td class="table-end tright ${l[4]}" end="${e.endurance}" title="END Required: ${bt(l[7])}">${at(e.endurance)}</td>
                                <td class="table-ws">${e.effectiveness.working_stats||0}</td>
                                <td class="table-last ${h[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
                                <td class="table-username ${h[d]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
                                <td class="table-settled">${e.effectiveness.settled_in||0}</td>
                                <td class="table-merits ${h[s]}">${r}</td>
                                <td class="table-education">${e.effectiveness.director_education||0}</td>
                                <td class="table-management">${e.effectiveness.management||0}</td>
                                <td class="table-addiction ${h[o]}">${i}</td>
                                <td class="table-total"><b>${e.effectiveness.total||0}</b></td>
                                <td class="table-tornstats tright ${l[1]}" effectiveness="${l[0]}"><span>${(100*l[0]).toFixed(0)}%</span></td>
                            </tr>`)}),p.find("th").css("cursor","pointer"),p.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),p.find("td.tright").css("text-align","right"),p.find("td.tleft").css("text-align","left"),p.find("td.eff-green").css("background-color","#D0E9C6"),p.find("td.eff-yellow").css("background-color","#FAF2CC"),p.find("td.eff-red").css("background-color","#EBCCCC"),St(p.find("th.table-position"),B),St(p.find("th.table-days"),L),St(p.find("th.table-man"),H),St(p.find("th.table-int"),G),St(p.find("th.table-end"),q),St(p.find("th.table-ws"),J),St(p.find("th.table-settled"),X),St(p.find("th.table-merits"),U),St(p.find("th.table-education"),K),St(p.find("th.table-management"),V),St(p.find("th.table-addiction"),Y),St(p.find("th.table-total"),Q),St(p.find("th.table-last"),C),St(p.find("th.table-tornstats"),et)}}).catch(t=>console.log("fetch error",t))}function W(k){let $=kt("company-history-items"),I=0;$&&(I=Object.keys($).length);const t=new Date,D=new Date(new Date(t.setDate(t.getDate()-1)).setHours(t.getHours()-2)).format("yyyy-MM-dd"),S=$t("company-history-items",D);const A=$t("company-history-items",new Date(t.setDate(t.getDate()-1)).format("yyyy-MM-dd"));if(null===k){if(I<=0)return void console.log("没有历史数据，跳过自动获取公司产量数据");if(S)return void console.log("本次产量数据已存过，跳过自动获取公司产量数据");console.log("本次产量数据还没存过，将自动获取公司产量数据")}var e=`https://api.torn.com/company/?selections=profile,employees,stock,detailed&key=${y}`;const O=F("#tips-view-company");O.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void O.text("---探测失败---"),t=>{O.text("---网络异常---")}).then(f=>{if(console.log(f),k){if(null!=f.error&&7==f.error.code)throw O.text("---员工无权限查看---"),new Error("not a director");null!=f&&O.text("---探测完成---"),F("#companyname").text(f.company.name),k.append(`
                        <table class="company-effectiveness" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                            <tr class="head">
                                <th class="employee-basic table-position">岗位</th>
                                <th class="employee-basic table-days">天</th>
                                <th class="employee-ws table-man">MAN</th>
                                <th class="employee-ws table-int">INT</th>
                                <th class="employee-ws table-end">END</th>
                                <th class="employee-effectiveness table-ws" title="Working Stats">属</th>
                                <th class="employee-basic table-last">登</th>
                                <th class="employee-basic table-username">名字</th>
                                <th class="employee-effectiveness table-settled" title="Settled In">天</th>
                                <th class="employee-effectiveness table-merits" title="Merits">点</th>
                                <th class="employee-effectiveness table-education" title="Director Education">课</th>
                                <th class="employee-effectiveness table-management" title="Management">理</th>
                                <th class="employee-effectiveness table-addiction" title="Addiction">药</th>
                                <th class="employee-effectiveness table-inactivity" title="Inactivity">离</th>
                                <th class="employee-effectiveness table-total" title="Total">总</th>
                                <th class="employee-effectiveness table-wage" title="Wage">薪</th>
                                <th class="employee-status table-tornstats">参</th>
                            </tr>
                        </table><br /><br />
                        <table class="company-history" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                            <tr class="head">
                                <th colspan=2>生产日期</th>
                                <th>收入</th>
                                <th>工资</th>
                                <th>广告费</th>
                                <th>利润</th>
                                <th>总效率</th>
                                <th>产量</th>
                                <th>销量</th>
                                <th>库存</th>
                                <th>单价</th>
                                <th>成本</th>
                                <th>记录时间</th>
                            </tr>
                        </table>`);const u=k.find(".company-effectiveness");u.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;")}let a='<br /><table class="company-stock" style="width:100%;background-color: #FFF5F7;font-size:12px;"><tr class="head"><th>库存种类</th>';F.each(f.company_stock,function(t,e){a+=`<th>${t}</th>`}),a+='</tr><tr class="content"><td class="stock-title">SOLD WORTH</td>',F.each(f.company_stock,function(t,e){a+=`<td class="stock-content">${bt(e.sold_worth)}</td>`}),a+='</tr><tr class="content"><td class="stock-title">SOLD AMOUNT</td>',F.each(f.company_stock,function(t,e){a+=`<td class="stock-content">${bt(e.sold_amount)}</td>`}),a+="</tr></table>",F(".company-effectiveness").after(a),F(".company-stock").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),F(".company-stock").find("td.stock-content").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),F(".company-stock").find("td.stock-title").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;");let n=[];F.each(f.company_employees,function(t,e){e.userid=t,e.position_rank=j(t),n.push(e)}),n.sort(function(t,e){return t.position_rank-e.position_rank});const g={0:"",1:"eff-yellow",3:"eff-red"};let m=0,b=0;F.each(n,function(t,e){if(m+=e.wage||0,b+=e.effectiveness.total||0,null===k)return!0;var a=T(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,i=e.effectiveness.addiction||0,o=i<=-10?3:i<=-5?1:0,r=e.effectiveness.inactivity||0,s=r<0?3:0,l=e.effectiveness.merits||0,d=l<=2?3:l<=4?1:0,c=n+o+d,p=3<=c?3:1<=c?1:0,c=E(f.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]),c=`
                        <tr class="content">
                            <td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
                            <td class="table-days">${e.days_in_company}</td>
                            <td class="table-man tright ${c[2]}" man="${e.manual_labor}" title="MAN Required: ${bt(c[5])}">${at(e.manual_labor)}</td>
                            <td class="table-int tright ${c[3]}" int="${e.intelligence}" title="INT Required: ${bt(c[6])}">${at(e.intelligence)}</td>
                            <td class="table-end tright ${c[4]}" end="${e.endurance}" title="END Required: ${bt(c[7])}">${at(e.endurance)}</td>
                            <td class="table-ws">${e.effectiveness.working_stats||0}</td>
                            <td class="table-last ${g[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
                            <td class="table-username ${g[p]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
                            <td class="table-settled">${e.effectiveness.settled_in||0}</td>
                            <td class="table-merits ${g[d]}">${l}</td>
                            <td class="table-education">${e.effectiveness.director_education||0}</td>
                            <td class="table-management">${e.effectiveness.management||0}</td>
                            <td class="table-addiction ${g[o]}">${i}</td>
                            <td class="table-inactivity ${g[s]}">${r}</td>
                            <td class="table-total"><b>${e.effectiveness.total||0}</b></td>
                            <td class="table-wage" wage="${e.wage}"><b>$${bt(e.wage||0)}</b></td>
                            <td class="table-tornstats tright ${c[1]}" effectiveness="${c[0]}"><span>${(100*c[0]).toFixed(0)}%</span></td>
                        </tr>`;const h=k.find(".company-effectiveness");h.children().append(c)});var t=parseInt(f.company.daily_income||0),e=parseInt(f.company_detailed.advertising_budget||0);let i=0,o=0,r=0,s=0,l=0,d="";F.each(f.company_stock,function(t,e){i+=e.sold_amount*e.cost,o+=e.sold_amount,r+=e.in_stock,s+=e.sold_worth,d+=`${t} $${e.price} `}),0<o&&(l=parseInt(s/o));let c=r;A?(console.log("有上一次的产量数据"),console.log(A),c=A.Stock||r):console.log("没有上一次的产量数据，本次的产量将设置为与销量相等");var p=r+o-c,h=t-m-e-i,p={Date:D,Income:t,Wages:m,Ad:e,Profit:h,Effectiveness:b,Produced:p,Sold:o,Stock:r,Price:l,Cost:i,RecordTime:(new Date).format("MM-dd hh:mm:ss")};if(console.log(p),S?console.log("本次产量数据已存过，不再覆盖"):(console.log("本次产量数据未保存，现在保存"),It("company-history-items",D,p),$=kt("company-history-items")),console.log($),null===k)return!0;const u=k.find(".company-effectiveness");u.find("th").css("cursor","pointer"),u.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),u.find("td.tright").css("text-align","right"),u.find("td.tleft").css("text-align","left"),u.find("td.eff-green").css("background-color","#D0E9C6"),u.find("td.eff-yellow").css("background-color","#FAF2CC"),u.find("td.eff-red").css("background-color","#EBCCCC"),St(u.find("th.table-position"),B),St(u.find("th.table-days"),L),St(u.find("th.table-man"),H),St(u.find("th.table-int"),G),St(u.find("th.table-end"),q),St(u.find("th.table-ws"),J),St(u.find("th.table-si"),X),St(u.find("th.table-me"),U),St(u.find("th.table-de"),K),St(u.find("th.table-ma"),V),St(u.find("th.table-ad"),Y),St(u.find("th.table-ia"),Z),St(u.find("th.table-to"),Q),St(u.find("th.table-wg"),tt),St(u.find("th.table-last"),C),St(u.find("th.table-tornstats"),et),u.after(`<br /><b>实时人数：${Object.keys(f.company_employees).length}，总工资：$${bt(p.Wages)}，广告费：$${bt(p.Ad)}，周销售：$${bt(f.company.weekly_income)}，单价：${d}</b><br />`);let y={Income:0,Wages:0,Ad:0,Profit:0,Effectiveness:0,Produced:0,Sold:0,Stock:0,Price:0,Cost:0};const v=k.find(".company-history");let x=0,w=0,_=0;F.each($,function(t,e){var a=parseInt(((new Date).getTime()-new Date(t).getTime())/864e5);if(31<a)return console.log(`删除过期数据：${t}`),Dt("company-history-items",t),delete $[t],!0;_++;t=`
                        <tr class="content">
                            <td>${_}</td>
                            <td>${t}</td>
                            <td>$${bt(e.Income)}</td>
                            <td>$${bt(e.Wages)}</td>
                            <td>$${bt(e.Ad)}</td>
                            <td>$${bt(e.Profit)}</td>
                            <td>${bt(e.Effectiveness)}</td>
                            <td>${bt(e.Produced)}</td>
                            <td>${bt(e.Sold)}</td>
                            <td>${bt(e.Stock)}</td>
                            <td>$${bt(e.Price)}</td>
                            <td>$${bt(e.Cost)}</td>
                            <td>${e.RecordTime||"-"}</td>
                        </tr>`;v.children().append(t),y.Income+=parseInt(e.Income),y.Wages+=parseInt(e.Wages),y.Ad+=parseInt(e.Ad),y.Profit+=parseInt(e.Profit),y.Effectiveness+=parseInt(e.Effectiveness),y.Produced+=parseInt(e.Produced),y.Sold+=parseInt(e.Sold),y.Stock+=parseInt(e.Stock),y.Price+=parseInt(e.Price),y.Cost+=parseInt(e.Cost||0),a<=7&&(x+=parseInt(e.Profit),w++)}),I=Object.keys($).length;p=`
                    <tr class="content">
                        <td colspan=2><b>平均值</b></td>
                        <td>$${bt((y.Income/I).toFixed(0))}</td>
                        <td>$${bt((y.Wages/I).toFixed(0))}</td>
                        <td>$${bt((y.Ad/I).toFixed(0))}</td>
                        <td>$${bt((y.Profit/I).toFixed(0))}</td>
                        <td>${bt((y.Effectiveness/I).toFixed(0))}</td>
                        <td>${bt((y.Produced/I).toFixed(0))}</td>
                        <td>${bt((y.Sold/I).toFixed(0))}</td>
                        <td>${bt((y.Stock/I).toFixed(0))}</td>
                        <td>$${bt((y.Price/I).toFixed(0))}</td>
                        <td>$${bt((y.Cost/I).toFixed(0))}</td>
                        <td>${(new Date).format("MM-dd hh:mm:ss")}</td>
                    </tr>`;v.children().append(p),v.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),v.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),v.after(`<br /><b>共 ${I} 天数据，总利润：$${bt(y.Profit)}，近一周(${w}天)利润：$${bt(x)}</b>`)}).catch(t=>console.log("fetch error: ",t.message))}function B(t){return F(t).find("td.table-position").attr("position-value")}function L(t){return F(t).find("td.table-days").text()}function H(t){return F(t).find("td.table-man").attr("man")}function G(t){return F(t).find("td.table-int").attr("int")}function q(t){return F(t).find("td.table-end").attr("end")}function J(t){return F(t).find("td.table-ws").text()}function X(t){return F(t).find("td.table-settled").text()}function U(t){return F(t).find("td.table-merits").text()}function K(t){return F(t).find("td.table-education").text()}function V(t){return F(t).find("td.table-management").text()}function Y(t){return F(t).find("td.table-addiction").text()}function Z(t){return F(t).find("td.table-inactivity").text()}function Q(t){return F(t).find("td.table-total").text()}function tt(t){return F(t).find("td.table-wage").attr("wage")}function et(t){return F(t).find("td.table-tornstats").attr("effectiveness")}function at(t){return t<1e4?t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}):parseInt(t/1e3)+"k"}function nt(n){return new Promise((e,a)=>{var t=`https://api.torn.com/user/${n}?selections=profile&key=${y}`;fetch(t).then(t=>t.ok?t.json():void console.log("---探测失败 "+n+"---"),t=>{console.log("---网络异常 "+n+"---")}).then(t=>{null!=t?"error"in t?a(t.error):(console.log(`userId2otherIds: ${n} => (${t.faction.faction_id} - ${t.faction.position}) (${t.job.company_id} - ${t.job.position})`),e([t.faction.faction_id,t.faction.position,t.job.company_id,t.job.position])):a()}).catch(t=>a(t))})}function it(o){return new Promise((e,n)=>{const i=F("#mainContainer").find("div:contains('unavailable')").last();i.text("蛙蛙探测器工作中...");var t=`https://api.torn.com/faction/${o}?selections=basic,chain&key=${y}`;fetch(t).then(t=>t.ok?t.json():void i.text("---探测失败 "+o+"---"),t=>{i.text("---网络异常 "+o+"---")}).then(t=>{if(null!=t)if("error"in t)n(t.error);else{F("#skip-to-content").text(`帮派: ${t.name}`),i.html(`<b>声望:</b> ${bt(t.respect)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${bt(t.age)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最大连击:</b> ${bt(t.best_chain)}&nbsp;&nbsp;&nbsp;&nbsp;<b>成员数:</b> ${Object.keys(t.members).length}`),0<t.chain.current&&i.append(`</br /></br /><b>正在连击:</b> ${bt(t.chain.current)}/${bt(t.chain.max)}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*t.chain.start).format("yyyy-MM-dd hh:mm:ss")}&nbsp;&nbsp;&nbsp;&nbsp;<b>连击超时:</b> ${t.chain.timeout}(秒)&nbsp;&nbsp;&nbsp;&nbsp;<b>声望系数:</b> ${t.chain.modifier}&nbsp;&nbsp;&nbsp;&nbsp;<b>冷却时间:</b> ${t.chain.cooldown}`),t.territory_wars&&0<Object.keys(t.territory_wars).length&&(i.append("</br />"),F.each(t.territory_wars,function(t,e){e.assaulting_faction==o?i.append(`</br /><b>正在进攻地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>防守方:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):i.append(`</br /><b>正在防守地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>进攻方:</b> <a href='/factions.php?step=profile&ID=${e.assaulting_faction}' target='_blank'>${e.assaulting_faction}</a>`),i.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>推墙进度:</b> ${bt(e.score)}/${bt(e.required_score)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最迟结束时间:</b> ${new Date(1e3*e.end_time).format("yyyy-MM-dd hh:mm:ss")}`)})),t.peace&&0<Object.keys(t.peace).length&&(i.append("</br />"),F.each(t.peace,function(t,e){i.append(`</br /><b>和平条约:</b> <a href='/factions.php?step=profile&ID=${t}' target='_blank'>${t}</a>&nbsp;&nbsp;&nbsp;&nbsp;<b>到期时间:</b> ${new Date(1e3*e).format("yyyy-MM-dd hh:mm:ss")}`)})),t.raid_wars&&0<Object.keys(t.raid_wars).length&&(i.append("</br />"),F.each(t.raid_wars,function(t,e){e.raiding_faction==o?i.append(`</br /><b>正在突击:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):i.append(`</br /><b>正在被</b> <a href='/factions.php?step=profile&ID=${e.raiding_faction}' target='_blank'>${e.raiding_faction}</a> 突击`),i.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>突击进度(攻/守):</b> ${e.raider_score}/${e.defender_score}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*e.start_time).format("yyyy-MM-dd hh:mm:ss")}`)})),F(".content-wrapper").last().append(`
                            <table id="faction-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                                <tr class="head">
                                    <th>名字</th>
                                    <th>天数</th>
                                    <th>上次活动</th>
                                    <th>状态</th>
                                    <th>角色</th>
                                </tr>
                            </table>`);const a=F("#faction-members");F.each(t.members,function(t,e){e=`
                                <tr class="content">
                                    <td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
                                    <td>${e.days_in_faction}</td>
                                    <td>${e.last_action.relative}</td>
                                    <td>${e.status.description}</td>
                                    <td>${e.position}</td>
                                </tr>`;a.children().append(e)}),a.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),a.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),e()}else n()}).catch(t=>i.text(t))})}function ot(a){return new Promise((t,i)=>{const o=F("#mainContainer").find("div:contains('unavailable')").last();o.text("蛙蛙探测器工作中...");var e=`https://api.torn.com/company/${a}?selections=profile&key=${y}`;fetch(e).then(t=>t.ok?t.json():void o.text("---探测失败 "+a+"---"),t=>{o.text("---网络异常 "+a+"---")}).then(e=>{if(null!=e)if("error"in e)i(e.error);else{var a,t={1:"Hair Salon",2:"Law Firm",3:"Flower Shop",4:"Car Dealership",5:"Clothing Store",6:"Gun Shop",7:"Game Shop",8:"Candle Shop",9:"Toy Shop",10:"Adult Novelties",11:"Cyber Cafe",12:"Grocery Store",13:"Theater",14:"Sweet Shop",15:"Cruise Line",16:"Television Network",18:"Zoo",19:"Firework Stand",20:"Property Broker",21:"Furniture Store",22:"Gas Station",23:"Music Store",24:"Nightclub",25:"Pub",26:"Gents Strip Club",27:"Restaurant",28:"Oil Rig",29:"Fitness Center",30:"Mechanic Shop",31:"Amusement Park",32:"Lingerie Store",33:"Meat Warehouse",34:"Farm",35:"Software Corporation",36:"Ladies Strip Club",37:"Private Security Firm",38:"Mining Corporation",39:"Detective Agency",40:"Logistics Management"};if(F("#skip-to-content").html(`公司: ${e.company.name}`),o.html(`<b>类型:</b> ${t[e.company.company_type]}&nbsp;&nbsp;&nbsp;&nbsp;<b>星级:</b> ${e.company.rating}&nbsp;&nbsp;&nbsp;&nbsp;<b>员工数:</b> ${e.company.employees_hired}/${e.company.employees_capacity}&nbsp;&nbsp;&nbsp;&nbsp;<b>日销售:</b> $${bt(e.company.daily_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>周销售:</b> $${bt(e.company.weekly_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${bt(e.company.days_old)}`),28==e.company.company_type){o.append("&nbsp;&nbsp;&nbsp;&nbsp;<b>估算单价x销量:</b>");for(let t=200;120<=t;--t)e.company.daily_income%t==0&&(a=parseInt(e.company.daily_income/t),o.append(` ${t}x${bt(a)}`))}else 16==e.company.company_type&&(t=parseInt(e.company.daily_income/e.company.daily_customers),o.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>单价x销量:</b> ${bt(t)}x${bt(e.company.daily_customers)}`));F(".content-wrapper").last().append(`
                                <table id="company-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                                    <tr class="head">
                                        <th>名字</th>
                                        <th>天数</th>
                                        <th>上次活动</th>
                                        <th>状态</th>
                                        <th>职位</th>
                                    </tr>
                            </table>`);const n=F("#company-members");F.each(e.company.employees,function(t,e){e=`
                                <tr class="content">
                                    <td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
                                    <td>${e.days_in_company}</td>
                                    <td>${e.last_action.relative}</td>
                                    <td>${e.status.description}</td>
                                    <td>${e.position}</td>
                                </tr>`;n.children().append(e)}),n.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),n.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}else i()}).catch(t=>o.text(t))})}if(0<=window.location.href.indexOf("factions.php?step=your")){const Qt=F("[href^='/forums.php#!p=forums&f=999&b=1&a=']").attr("href");let a=0;if(null!=Qt&&(a=Qt.substring(34),window.localStorage.setItem("MY_FACTION_ID",a)),foo){let t=new MutationObserver(function(t,e){x("div.f-war-list","ul.table-body"),P(a),St(F("li.days"),w),St(F("li.status"),_),St(F("li.position"),k),St(F("li.lvl"),$)});t.observe(document.getElementById("faction-info"),{childList:!0})}}if(0<=window.location.href.indexOf("factions.php?step=profile&"))if(0<F("#mainContainer").find("div:contains('unavailable')").last().length)if(0<=window.location.href.indexOf("profile&ID=")){const fID=/profile&ID=(\d+)/.exec(window.location.href)[1];console.log("fID "+fID),it(fID).catch(t=>console.log("factionPageRedraw "+t))}else 0<=window.location.href.indexOf("profile&userID=")&&(a=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+a),nt(a).then(function(t){console.log(t),it(t[0]).catch(t=>console.log("factionPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));else if(foo){x("div.f-war-list","ul.table-body");const fID=F("div[data-faction]").attr("data-faction");P(fID),St(F("li.days"),w),St(F("li.status"),_),St(F("li.position"),k),St(F("li.lvl"),$)}if(0<=window.location.href.indexOf("p=corpinfo&"))if(0<F("#mainContainer").find("div:contains('unavailable')").last().length)if(0<=window.location.href.indexOf("corpinfo&ID=")){const te=/corpinfo&ID=(\d+)/.exec(window.location.href)[1];console.log("companyID "+te),new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t()},2e3)}).then(function(){ot(te).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("companyPageRedraw "+t))}else 0<=window.location.href.indexOf("corpinfo&userID=")&&(a=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+a),nt(a).then(function(a){return new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t(a)},2e3)})}).then(function(t){console.log(t),ot(t[2]).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));else{var rt=setInterval(v,500);function v(){if(0<=F("div.company-details").children("div.title-black").text().indexOf("Oil Rig")){clearInterval(rt);const e=F("div.company-details").find("li:contains('Daily income')").text().replace(/[^\d]/g,"");for(let t=250;120<=t;--t)if(e%t==0){const a=parseInt(e/t);F("div.company-details").children("div.title-black").append(`<span class="m-hide"> - 估算单价: ${t}，估算销量: ${bt(a)} </span>`)}}}}if(bounty_parade&&window.location.href.indexOf("bounties.php#!p=main")&&setInterval(function(){const t=F("ul.bounties-list").children(),e=t.first();e.length<=0?F("div.bounties-total").text("未找到用户列表"):"1"==e.attr("detected")||(F("div.bounties-total").text("阅兵开始"),setTimeout(()=>{!function e(a){a.attr("detected","1");const n=a.find("div.status");if(0<n.children(".t-red").length)F("div.bounties-total").text("本条已阅兵完毕"),setTimeout(()=>{e(a.next())},0);else if(null==a.attr("data-id"))F("div.bounties-total").text("本页阅兵结束");else{const i=a.find("div.target").children("a"),o=i.attr("href").replace(/[^0-9]/gi,"");var t=i.text();F("div.bounties-total").text("正在阅兵: "+o+" "+t),At(o,function(t){n.children(".t-green").text(yt(t.estimate_bs)),It("battlestats",o,t.estimate_bs),setTimeout(()=>{e(a.next())},0)},function(t){F("div.bounties-total").text("蛙蛙探测 "+o+" 失败 "+t),setTimeout(()=>{e(a.next())},0)})}}(e)},0))},2e3),mugoo&&0<=window.location.href.indexOf("imarket.php")){let d=window.location.href,c=setInterval(v,500),g=0;var st=["Donator Pack","Xanax","Erotic DVD","Drug Pack","Feathery Hotel Coupon","Anti Tank","Large Suitcase","Wind Proof Lighter","Six Pack of Energy Drink","Sierra Cosworth"],lt=["Tribulus Omanense","Peony","African Violet","Cherry Blossom","Heather","Ceibo Flower","Edelweiss"],dt=["Camel Plushie","Lion Plushie","Panda Plushie","Monkey Plushie","Chamois Plushie","Red Fox Plushie","Nessie Plushie"],ct=["Can of X-MASS","Can of Taurine Elite","Can of Rockstar Rudolph","Can of Red Cow","Can of Munster","Can of Santa Shooters"];function v(){const t=F(".guns-list.cont-gray");if(t&&0<t.length){clearInterval(c),clearInterval(g),d=window.location.href,g=setInterval(pt,500);const a=F(".msg.right-round");a.html(`
                    <div id="important" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${Lt.gray}; color:white;">重要</div></div>
                    <div id="flower" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${Lt.gray}; color:white;">花花</div></div>
                    <div id="plushie" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${Lt.gray}; color:white;">玩偶</div></div>
                    <div id="can" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${Lt.gray}; color:white;">能饮</div></div>
                `);for(let t=0;t<st.length;t++){const o=st[t].split(" ")[0];F("#important").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${Lt.yellowgreen}; color:white;" name="${st[t]}">${o}</div>`)}for(let t=0;t<lt.length;t++){const r=lt[t].split(" ")[0];F("#flower").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${Lt.pink}; color:white;" name="${lt[t]}">${r}</div>`)}for(let t=0;t<dt.length;t++){const s=dt[t].replace(/ Plushie/g,"");F("#plushie").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${Lt.blue}; color:white;" name="${dt[t]}">${s}</div>`)}for(let t=0;t<ct.length;t++){const l=ct[t].replace(/Can of /g,"");F("#can").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${Lt.yellow}; color:white;" name="${ct[t]}">${l}</div>`)}F(".header-link").click(function(){const t=F(this).attr("name"),e="/imarket.php#/p=shop&step=shop&type=&searchname="+t.replace(/ /g,"+");console.log(e),window.location.href=e});const I=F(".items").children(":first").find("[itemid]").attr("itemid"),n=t.children(":first").find(".name.t-gray-6").text();if(0<=st.indexOf(n)||0<=lt.indexOf(n)||0<=dt.indexOf(n)||0<=ct.indexOf(n)){let d={};const p=$t("bazaar_cache",n);let c=0;const h=F(".desc.t-blue-cont.t-overflow");if(h.each(function(t,e){const a=F(this).find(".price.t-gray-6"),n=F(this).find(".user.t-overflow").children("a"),i=n.attr("href"),o=i?i.replace(/[^\d]/g,""):0,r=a.text().split("(")[0].trim(),s=ut(r),l=a.text().split("(")[1].replace(/\)/g,"").trim();d[o]={price:s,price_formal:r,amount:l},s>c&&(c=s)}),!F.isEmptyObject(p))for(var e in p)if(null==d[e]&&p[e].price>=c){const f=`
                                    <li>
                                        <span class="item-desc">
                                            <span class="item">
                                                <img class="img___3jDmV" src="/images/items/${I}/large.png?v=1528808940574" alt="${n}">
                                                <a class="item-hover" href="/bazaar.php?userID=${e}"></a>
                                            </span>
                                            <span class="desc t-blue-cont t-overflow">
                                                <span class="user t-overflow">
                                                    <a href="/bazaar.php?userID=${e}">Pampa's bazaar</a>
                                                </span>
                                                <span class="name t-gray-6">${n}</span>
                                                <span class="price t-gray-6"> ${p[e].price_formal}
                                                    <span class="stock t-gray-9">(${p[e].amount})</span>
                                                </span>
                                            </span>
                                        </span>
                                    </li>`;t.children(":last").before(f)}ht(I,n,d,p)}const i=F(".desc.t-blue-cont.t-overflow");i.each(function(t,e){const x=F(this).find(".price.t-gray-6"),w=F(this).find(".user.t-overflow").children("a"),a=w.attr("href"),_=a?a.replace(/[^\d]/g,""):0;x.prev().remove();const n=x.text().split("(")[0].trim(),k=ut(n),$=x.text().split("(")[1].replace(/\)/g,"").trim();At(_,function(t){const e=T(t.last_action.timestamp),a=t.status.color,n=N(t.status.description,t.status.state,t.status.until),i=t.job.company_type,o=t.basicicons.icon72,r=t.last_action.status,s=t.bazaar,l=t.faction.faction_id;let d={};if(s.map(function(t,e,a){d[t.ID]={name:t.name,quantity:t.quantity,price:t.price}}),!(I in d))return x.parent().parent().parent().remove(),1;{const y=d[I].quantity,v=d[I].price;y==$&&v==k||x.html(`${ut(v)} <span class="stock t-gray-9">(${y})</span>`)}l in Bt&&w.parent().parent().css("background-color",Lt.green);let c="";c="Online"==r?'<span title="<b>Online</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:0px 0; background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':"Offline"==r?'<span title="<b>Offline</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-18px 0;   background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':'<span title="<b>Idle</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-1098px 0;  background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>';let p="打",h=Lt.purple;5==i&&(p="衣",h=Lt.gray),null!=o&&(p="新",h=Lt.gray),w.text("");const f=`${c}<a href="/profiles.php?XID=${_}">${t.name}</a>`,g=`<a class= "border-round" style="padding:1px 2px;background-color:${h};color:white;" href="/loader.php?sid=attack&user2ID=${_}">${p}</a>`;w.before(g),w.after(f);let m=0;null!=s&&s.map(function(t,e,a){m+=t.quantity*t.market_price}),x.parent().siblings(".item").css("margin","2px 10px"),x.parent().siblings(".item").append(`<div style="font-size: 13px; line-height: 17px; text-align: center;"><span class="border-round" style="background-color: ${Lt.purple}; color: white; padding: 1px 3px;">全店 ${yt(m)}</span></div>`);let b="";"blue"==a&&(b=Lt.blue),"green"==a&&(b=Lt.green),"red"==a&&(b=Lt.red);let u=`
                            <span class="left" style="">
                                <span class= "border-round" style="padding: 1px 3px; background-color: ${b}; color: white;" title="Status: ${t.status.description}">${n[0]}</span>
                                <span style="padding: 1px 3px;" title="Last Action: ${t.last_action.relative}">${e[1]}</span>
                                <span style="padding: 1px 3px;" title="BattleStats: ${yt(t.estimate_bs)}">${yt(t.estimate_bs)}</span>
                            </span>`;x.after(u)})})}}function pt(){d!=window.location.href&&(clearInterval(c),clearInterval(g),d=window.location.href,c=setInterval(v,500))}function ht(o,r,s,l){var t=`https://api.torn.com/market/${o}?selections=bazaar&key=${y}`;fetch(t).then(t=>t.json()).then(t=>{console.log(o+" bazaar API fetched");var e=t.bazaar;let a={};for(let t=0;t<e.length;t++){if(!F.isEmptyObject(l))for(var n in l)l[n].apiid==e[t].ID&&(a[n]={apiid:e[t].ID,price:e[t].cost,price_formal:ut(e[t].cost),amount:e[t].quantity});if(!F.isEmptyObject(s))for(var i in s)s[i].price==e[t].cost&&s[i].amount==e[t].quantity&&(a[i]={apiid:e[t].ID,price:e[t].cost,price_formal:ut(e[t].cost),amount:e[t].quantity})}It("bazaar_cache",r,a)}).catch(t=>console.log("fetch error",t))}}{function v(){const t=F(".users-point-sell").children("li");if(t&&0<t.length){clearInterval(n);let r=[];F("li.total-price").attr("id","total-price");const e=document.getElementById("total-price"),s=window.getComputedStyle(e).width.replace(/px$/g,"");t.each(function(t,e){const c=F(this).find(".total-price"),a=F(this).find(".user.name").attr("href"),n=a?a.replace(/[^\d]/g,""):0,i=F(this).find(".user.faction").attr("href"),o=i?i.replace(/[^\d]/g,""):0;o in Bt&&F(this).css("background-color",Lt.green),-1==r.indexOf(n)&&(r.push(n),Number(s)<200&&c.text(""),At(n,function(t){const e=T(t.last_action.timestamp),a=t.status.color,n=N(t.status.description,t.status.state,t.status.until),i=t.job.company_type,o=t.basicicons.icon72;let r="打",s=Lt.purple;5==i&&(r="衣",s=Lt.gray),null!=o&&(r="新",s=Lt.gray);let l="";"blue"==a&&(l=Lt.blue),"green"==a&&(l=Lt.green),"red"==a&&(l=Lt.red);let d="<span class='left'>";d+=`<span style="padding:1px;margin:1px;background-color:${s};color:white;">${r}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${l};color:white;" title="Status: ${t.status.description}">${n[0]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${Lt.gray};color:white;" title="Last Action: ${t.last_action.relative}">${e[1]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${Lt.blue};color:white;" title="BattleStats: ${yt(t.estimate_bs)}">${yt(t.estimate_bs)}</span></span>`,c.prepend(d)}))})}}mugoo&&0<=window.location.href.indexOf("pmarket.php")&&(n=setInterval(v,500))}if(mugoo&&0<=window.location.href.indexOf("bazaar.php")){var ft={};const ee=F("#mainContainer").find("div:contains('unavailable')").last();function gt(){var t=`https://api.torn.com/torn/?selections=items&key=${y}`;fetch(t).then(t=>t.json()).then(t=>{console.log("API fetched");let e={};const a=new Date;for(var n in e["last-updated"]=a.toString(),t.items)e[n]=t.items[n].market_value;window.localStorage.setItem("ITEMS",JSON.stringify(e))}).catch(t=>console.log("fetch error",t))}function v(){const f=F("[class*='messageContent___']");if("1"!=f.attr("hasdone")){f.attr("hasdone","1"),F("#sum").remove();let t='<div id="sum">',e=0;for(var a in ft)t+=" (<span class='t-green'> "+ft[a].name+" "+ft[a].total_formal+" </span>) ",e+=ft[a].total;t+="<span class='t-red'><b> Total Selected: "+yt(e)+" </b></span></div>",f.append(t)}const t=$t("ITEMS","last-updated"),e=F("[class^='rowItems___']").children();t&&e&&0<e.length&&e.each(function(t,e){const a=F(this).find("[class^='name___']").text(),n=F(this).find("[class^='price___']");let i=0;""!=n.text()&&(i=n.text().replace(/[^\d]/g,""));const o=F(this).find("img").attr("src");let r=0,s=0;null!=o&&(s=o.split("/")[3],0<s&&(r=$t("ITEMS",s)));const l=F(this).find("[class^='amount___']");let d=0;if(""!=l.text()&&(d=l.text().replace(/[^\d]/g,"")),0<r&&0<i&&0<d&&"1"!=F(this).attr("hasdone")){F(this).attr("hasdone","1");const c=((i-r)/r*100).toFixed(1),p=yt(i*d);l.append(`&nbsp;&nbsp;<span><span class="t-blue">${p}</span></span>`),0<=c?n.append(`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${c}%</span></span>`):n.append(`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${c}%</span></span>`);const h=F(this).find("[class^='description___']");null!=ft[s]&&h.css("background-color","NavajoWhite"),h.click(function(){F(this).attr("selected")?(delete ft[s],F(this).removeAttr("selected"),f.removeAttr("hasdone"),F(this).css("background-color","")):(ft[s]={name:a,price:i,amount:d,total:i*d,total_formal:yt(i*d)},F(this).attr("selected","selected"),f.removeAttr("hasdone"),F(this).css("background-color","NavajoWhite"))})}})}0<ee.length?(mt=window.location.href.replace(/[^\d]/g,""),ee.text("蛙蛙探测器工作中..."),mt=`https://api.torn.com/user/${mt}?selections=basic,bazaar&key=${y}`,fetch(mt).then(t=>t.ok?t.json():void ee.text("---探测失败 "+fID+"---"),t=>{ee.text("---网络异常 "+fID+"---")}).then(a=>{if(ee.html(`蛙蛙探测成功^_^ [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),null==a.bazaar)ee.html(`货物卖光了:( [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),console.log("no item in bazaar");else{F(".content-wrapper").last().append('<div class="bazaar-wrapper" style="margin-top:10px;"><div class="bazaar-content" style="width:inherit; overflow:hidden; background-color:white;"></div></div>');for(let e=0;e<a.bazaar.length;e++){var n=((a.bazaar[e].price-a.bazaar[e].market_price)/a.bazaar[e].market_price*100).toFixed(2);let t="";t=0<n?`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${n}%</span></span>`:`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${n}%</span></span>`,F(".bazaar-content").append(`
                                <div class="item-wrapper" style="width:288px; float:left; overflow:hidden;">
                                    <div style="width:100px; height:50px; margin:7px; padding:3px; float:left; border:1px solid darkgray;">
                                        <img src="/images/items/${a.bazaar[e].ID}/large.png">
                                    </div>
                                    <div class="item-description" style="width:150px; margin:7px; float:left; border:1px solid darkgray;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                        <p class="item-name" style="margin:5px">${a.bazaar[e].name}</p>
                                        <p class="item-price" style="margin:5px">${ut(a.bazaar[e].price)}${t}</p>
                                        <p class="item-quantity" style="margin:5px">(${a.bazaar[e].quantity} in stock)
                                            <span class="t-blue">&nbsp;&nbsp;${yt(a.bazaar[e].price*a.bazaar[e].quantity)}</span>
                                        </p>
                                    </div>
                                </div>`)}}}).catch(t=>ee.text(t))):(function(){var e=$t("ITEMS","last-updated");if(null!=e&&null!=e){var a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&gt()}else gt()}(),setInterval(v,500))}{function v(){const i=F(".buy-item-info").find(".private-bazaar");0<i.length&&i.each(function(t,e){if("1"!=F(this).attr("hasdone")){F(this).attr("hasdone","1");const a=F(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),n=F(this);At(a,function(t){n.attr("user_id",a),n.attr("user_name",t.name),n.attr("user_level",t.level),n.attr("user_bs",yt(t.estimate_bs)),n.attr("user_last",t.last_action.relative),n.attr("user_stat",t.status.description),n.attr("user_job_type",t.job.company_type),n.attr("newbie",t.basicicons.icon72)})}});const t=F(".buy-item-info-wrap").find(".private-bazaar");0<t.length&&t.each(function(t,e){if("1"!=F(this).attr("hasdone")){const c=F(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),a=F(this).find(".user.faction").attr("href"),n=a?a.replace(/[^\d]/g,""):0;n in Bt&&F(this).css("background-color",Lt.green);const p=F(this);i.each(function(t,e){if(F(this).attr("user_id")==c){console.log(F(this).attr("user_name"));const a=F(this).attr("user_name"),n=F(this).attr("user_level"),i=F(this).attr("user_bs"),o=F(this).attr("user_last"),r=F(this).attr("user_stat"),s=F(this).attr("user_job_type"),l=F(this).attr("newbie");let t="打";5==s?t="衣":null!=l&&(t="新");const d=`
                                    <li class="private-bazaar wawa-bazaar" hasdone="1">
                                        <ul class="item t-blue-cont h">
                                            <li class="item-name">
                                                <div class="item-t right t-gray-9">${r}</div>
                                                <div class="name-t icons left">
                                                    <span class="t-gray-9">Lv:${n}</span>
                                                <a class="user name" href="/profiles.php?XID=${c} ">
                                                    <span title="${a} [${c}]"><b>BS: ${i}</b><span></span></span>
                                                </a>
                                                </div>
                                                <div class="name-t name-mobile left">
                                                    <span class="t-gray-9 italic">sold by</span>
                                                    <a class="t-blue" href="profiles.php?XID=${c}">BS: ${i}</a>
                                                </div>
                                                <div class="clear"></div>
                                            </li>
                                            <li class="cost">
                                                <span class="t-gray-9" title="${r}">${o}</span>
                                            </li>
                                            <li class="view">
                                                <a href="/loader.php?sid=attack&user2ID=${c}"><b>${t}</b></a>
                                            </li>
                                            <li class="clear"></li>
                                        </ul>
                                    </li>`;return p.after(d),p.attr("hasdone","1"),!1}})}})}mugoo&&0<=window.location.href.indexOf("imarket.php")&&setInterval(v,500)}{function v(){const t=F("[class^='btn___']");if(0<t.length){const e=t[0];if(F(e).text().includes("CONTINUE")){const a=F(e).parent().parent().children(":first").text().split(" ");clearInterval(p),console.log(a);const n=a[2],i=a[1],o=new Date,r=parseInt(o.getTime()/1e3),s=o.format("yyyy-MM-dd hh:mm:ss");if("mugged"==i){let t=a[5];console.log(t),"wallet"==t&&(t="$0");const l={timestring:s,victim_id:d,victim_name:n,money_mugged:t};It("muglog",r,l)}}}}0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")&&(d=window.location.href.match(/loader\.php\?sid=attack\&user2ID=(\d+)/)[1],p=setInterval(v,300))}if(0<=window.location.href.indexOf("companies.php")){F(".info-msg-cont").after("<div id='effectiveness-wrap' style='margin-top:10px; overflow-x: auto;'></div>");var mt=Mt();console.log("userId "+mt),nt(mt).then(function(t){console.log(t);t=t[3];"Employee"==t?R(F("#effectiveness-wrap")):"Director"==t&&W(F("#effectiveness-wrap"))}).catch(t=>console.log("userId2otherIds "+t));const ae=setInterval(function(){const t=F(".employee-list-wrap").children("ul.employee-list").children("li");if(0<t.length){clearInterval(ae);let n={},i=0;t.each(function(t,e){var a=F(this).attr("data-user");n[a]=i,i+=1}),window.localStorage.setItem("EMPLOYEE_RANK",JSON.stringify(n))}},1e3)}else W(null);0<=window.location.href.indexOf("joblist.php")&&setInterval(function(){const t=F("ul.rank-list");if(0<t.length&&"1"!=t.attr("hasdone")){t.attr("hasdone","1");t.after(`
                    <div id="company_parade">
                        <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">公司阅兵</div>
                        <div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                            <button id="company_parade_start_btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
                            <button id="company_parade_stop_btn" class="torn-btn" style="margin:5px;">暂停阅兵</button>
                            <span id="company_parade_tip" style="margin:5px;"></span>
                        </div>
                    </div>`);let a=!0;F("#company_parade_start_btn").click(function(){a=!0,F("#company_parade_start_btn").prop("disabled",!0),F("#company_parade_stop_btn").removeAttr("disabled");const t=F("ul.company-list").children().first();t.length<=0?(F("#company_parade_tip").text("未找到公司列表"),F("#company_parade_start_btn").removeAttr("disabled"),F("#company_parade_stop_btn").prop("disabled",!0)):(F("#company_parade_tip").text("阅兵开始"),F("#company_parade_table").length<=0&&(F("#company_parade").after(`
                                <div id="company_parade_table">
                                    <table style="margin:auto;background-color:white;font-size:12px;">
                                        <tr class="head">
                                            <th>星级</th>
                                            <th>名称</th>
                                            <th>老板</th>
                                            <th>天数</th>
                                            <th>员工数</th>
                                            <th title="24h未上线">不活跃</th>
                                            <th title="入职不到10天">新员工</th>
                                            <th>日收入</th>
                                            <th>日单价</th>
                                            <th>周收入</th>
                                            <th>周单价</th>
                                        </tr>
                                    </table>
                                </div>`),F("#company_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")),setTimeout(()=>{!function d(c){if("1"==c.attr("detected"))F("#company_parade_tip").text("公司已完成"),setTimeout(()=>{d(c.next())},0);else if(c.length<=0||0==a)F("#company_parade_tip").text("阅兵已结束"),F("#company_parade_start_btn").removeAttr("disabled"),F("#company_parade_stop_btn").prop("disabled",!0);else{c.attr("detected","1");const e=c.children().children("li.view").children().attr("href"),p=e?e.replace(/[^\d]/g,""):0,h=c.children().children("li.company").text();var t=`https://api.torn.com/company/${p}?selections=profile&key=${y}`;F("#company_parade_tip").text(`正在阅兵：${p} ${h}`),fetch(t).then(t=>t.json()).then(a=>{if("company"in a){var n=a.company.director,i=a.company.employees[n].name;let t=0,e=0;var o,r=parseInt((new Date).getTime()/1e3);for(o in a.company.employees){var s=a.company.employees[o].last_action.timestamp;86400<=r-s&&(t+=1);var l=a.company.employees[o].days_in_company;l<10&&(e+=1)}F("#company_parade_table").children().append(`
                                        <tr class="content">
                                            <td>${a.company.rating}</td>
                                            <td><a href="#!p=corpinfo&ID=${p}" target="_blank">${a.company.name}</a></td>
                                            <td><a class="user name" href="/profiles.php?XID=${n}" target="_blank">${i}</a></td>
                                            <td>${a.company.days_old}</td>
                                            <td>${a.company.employees_hired}/${a.company.employees_capacity}</td>
                                            <td>${t}</td>
                                            <td>${e}</td>
                                            <td>${yt(a.company.daily_income)}</td>
                                            <td>${yt(a.company.daily_income/a.company.daily_customers)}</td>
                                            <td>${yt(a.company.weekly_income)}</td>
                                            <td>${yt(a.company.weekly_income/a.company.weekly_customers)}</td>
                                        </tr>`),F("#company_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),setTimeout(()=>{d(c.next())},1e3)}else"error"in a&&F("#company_parade_tip").text(`蛙蛙探测失败：${p} ${h} ${a.error.error}`)}).catch(t=>console.log(t))}}(t)},1e3))}),F("#company_parade_stop_btn").click(function(){a=!1})}},500)}function bt(t){return 0<=t.toString().indexOf(",")?Number(t.replace(/,/g,"")):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","})}function ut(t){return 0<=t.toString().indexOf("$")?Number(t.replace(/\$|,/g,"")):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})}function yt(t){return t<0?"-"+yt(-t):0==t?"0":t<=1?(100*t).toFixed(2)+"%":t<1e3?""+parseInt(t):1e3<=t&&t<1e6?(t/1e3).toFixed(2)+"k":1e6<=t&&t<1e9?(t/1e6).toFixed(2)+"m":1e9<=t&&t<1e12?(t/1e9).toFixed(2)+"b":1e12<=t&&t<1e15?(t/1e12).toFixed(2)+"t":1e15<=t?"MAX":void 0}function vt(t){return"[object Array]"===Object.prototype.toString.call(t)?t:"[object Object]"===Object.prototype.toString.call(t)?Object.values(t):null}function xt(t){var e=vt(t);if(null==e||e.length<=0)return null;if(t=e,"[object Array]"===Object.prototype.toString.call(t)&&(!(t.length<=1)&&("[object Object]"===Object.prototype.toString.call(t[0])&&0<Object.keys(t[0]).length)))return e;for(let t=0;t<e.length;++t){var a=xt(e[t]);if(null!=a)return console.log(`在第 ${t} 个节点发现有效数据集`),a}return null}function wt(t){for(var e in t)!function(t,e){var a=t[e];if("object"==typeof a){for(var n in a){var i=a[n];"object"==typeof i?wt(a):t[n+"_"+e]=i}delete t[e]}}(t,e)}function _t(e){var t=e[0];wt(t);let a=Object.keys(t);console.log(`item_keys: ${a}`);for(let t=1;t<e.length;++t){var n=e[t];wt(n);var i=Object.keys(n);for(let t=0;t<i.length;t++){var o=i[t];console.log(`add item_key: ${o}`),-1==a.indexOf(o)&&a.push(o)}}let r=a.sort().join(",");for(let t=0;t<e.length;++t){r+="\n";var s=e[t];wt(s);for(let e=0;e<a.length;++e){let t=s[a[e]]+"";"object"==typeof t&&(t=JSON.stringify(t)),t='"'+t.replace(/<[^>]+>/g,"").trim().replace(/\"/g,'""')+'"',0<e&&(r+=","),r+=t}}return encodeURIComponent(r)}function kt(t){if(void 0!==window.localStorage)return null===window.localStorage.getItem(t)?null:JSON.parse(window.localStorage.getItem(t))}function $t(t,e){t=kt(t);if(void 0!==t)return null===t?null:void 0!==t[e]?t[e]:void 0}function It(e,a,n){if(void 0!==window.localStorage)if(null===window.localStorage.getItem(e)){let t={};t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}else{let t=JSON.parse(window.localStorage.getItem(e));t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}}function Dt(t,e){if(void 0!==window.localStorage&&null!==window.localStorage.getItem(t)){const a=JSON.parse(window.localStorage.getItem(t));void 0===a[e]||(delete a[e],window.localStorage.setItem(t,JSON.stringify(a)))}}function St(i,o){i.click(function(){const t=F(this).siblings();t.each(function(){var t=F(this).text().replace(/[↑↓]/,"");F(this).text(t)});var e=F(this).text().replace(/[↑↓]/,"");let a="",n="";n="TH"==i[0].tagName?(a=i.parent().siblings(),i.parent().parent()):(a=i.parent().next().children(),i.parent().next()),"descend"==F(this).attr("sort")?(a.sort(function(t,e){const a=o(t);e=o(e);return isNaN(a)?a.localeCompare(e):a-e}),a.detach().appendTo(n),F(this).attr("sort","ascend").text(e+"↑")):(a.sort(function(t,e){t=o(t);const a=o(e);return isNaN(t)?a.localeCompare(t):a-t}),a.detach().appendTo(n),F(this).attr("sort","descend").text(e+"↓"))})}function At(t,mt,e){let a=`https://api.torn.com/user/${t}?selections=profile,crimes,personalstats,bazaar&key=${y}`;console.log(`Request: ${a}`),fetch(a).then(t=>t.ok?t.json():void e("蛙蛙探测失败，请刷新重试"),t=>{e("蛙蛙探测失败，网络异常，请刷新重试")}).then(h=>{if(console.log(`Response: ${a}`),console.log(h),null!=h)if(h.hasOwnProperty("error"))e(`蛙蛙探测失败：${JSON.stringify(h,null,4)}`);else{var f=h.personalstats,g=f.defendslost||0,m=f.defendsstalemated||0,b=f.defendswon||0,u=f.attackswon||0,y=f.attacksdraw||0,v=f.attackslost||0,x=f.cantaken||0,w=f.exttaken||0,_=f.kettaken||0,k=f.lsdtaken||0,$=f.opitaken||0,I=f.pcptaken||0,D=f.shrtaken||0,S=f.spetaken||0,A=f.victaken||0,O=f.xantaken||0,C=h.age||1,F=f.trainsreceived||0,M=w+k+O,z=((h.xan_lsd_ecs=M)/C).toFixed(2);h.average_drugs=z;var T=f.refills||0,N=f.statenhancersused||0,P=f.useractivity||0,E=f.traveltime||0,j=(f.logins,f.dumpsearches||0),R=f.energydrinkused||0,W=f.boostersused||0,M=f.revives||0,z=u+y+v,y=f.daysbeendonator||0,v=Math.min(C,parseInt((new Date-new Date("2011/11/22"))/864e5));const tt=Math.min(y/v,1);h.donator_percent=tt.toFixed(2);const et=480+240*tt;const at=611255/et;console.log(`统计DP时间 ${y}d，最多 ${v}d，DP比例：${yt(tt)}，一天完整能量：${et.toFixed(2)}，实现CAP需要活跃：${at.toFixed(2)}天`);v=h.last_action.timestamp||0;let t=parseInt((new Date).getTime()/1e3)-v,e="";86400<t&&(e+=parseInt(t/86400)+"天",t%=86400),3600<t&&(e+=parseInt(t/3600)+"时",t%=3600),60<t&&(e+=parseInt(t/60)+"分",t%=60),e+=t+"秒",h.last_action_details=e;const nt=h.last_action.relative;h.last_action_brief=nt.replace(" minute ago","m").replace(" minutes ago","m").replace(" hours ago","h").replace(" hour ago","h").replace(" days ago","d").replace(" day ago","d");let a=0;nt.includes("d")&&(a=parseInt(nt.replace(/[^0-9|-]/gi,"")));const it=Math.max(1,21*(C-a)/24);console.log(`年龄${C}天，上次登录${a}天前，最大活跃天数${it.toFixed(2)}`);const ot=P/86400,rt=E/86400,st=3*ot+rt;console.log(`ched_active_days: 3*${ot.toFixed(2)}(activity) + ${rt.toFixed(2)}(travel) = ${st.toFixed(2)}`);const lt=(75*x+210*w+52.5*_+425*k+215*$+430*I+209.5*D+301*S+300*A+420*O)/1440;console.log(`drug_active_days: ${lt.toFixed(2)}`);x=h.criminalrecord.other||0,w=h.criminalrecord.selling_illegal_products||0,_=h.criminalrecord.theft||0,$=h.criminalrecord.drug_deals||0,I=h.criminalrecord.computer_crimes||0,D=h.criminalrecord.murder||0,S=h.criminalrecord.fraud_crimes||0,A=h.criminalrecord.auto_theft||0;let n=.11*_+.5*I+.66*D+S+.66*A+.05*$;n<0&&(n=0),h.estimate_ace=parseInt(n),12862<n?h.estimate_nnb=60:9171<n?h.estimate_nnb=55:5950<n?h.estimate_nnb=50:4324<n?h.estimate_nnb=45:2750<n?h.estimate_nnb=40:1198<n?h.estimate_nnb=35:450<n?h.estimate_nnb=30:250<n?h.estimate_nnb=25:100<n?h.estimate_nnb=20:50<n?h.estimate_nnb=15:h.estimate_nnb=10;let i=5*(2*x+3*w+5*_+8*$/.8+9*I/.75+10*D/.75+11*S/.95+12*A/.7)/1440;i<at&&(B=Math.min(at/i,3),console.log(`新手 crime_active_days 补偿系数：${B}`),i*=B),console.log(`crime_active_days: ${i.toFixed(2)}`);var B=Math.min(it,Math.max(st,lt,i)).toFixed(2);console.log(`估算活跃天数: ${B}`),h.estimate_active_days=B;C=parseInt(75*F+30*B+70*C);console.log(`估算WS: ${C}`),h.estimate_ws=C;const dt=parseInt(et*B);console.log(`估算的自然恢复能量: ${dt}`);B=parseInt(150*T),T=250*O+50*k,R=20*R,W=150*W;const ct=B+T+R+W;console.log(`物品能量：${B}(refill) + ${T}(drug) + ${R}(can) + ${W}(FHC) = ${ct}`);W=25*z,M=25*M,j=5*j;const pt=W+M+j;console.log(`消耗能量：${W}(attack) + ${M}(revive) + ${j}(dump) = ${pt}`);let o=dt+ct-pt;o<0&&(o=0),console.log(`总锻炼能量：${dt}(自然) + ${ct}(物品) - ${pt}(消耗) = ${o}`),h.total_energy=o.toFixed(0),h.nature_energy=dt.toFixed(0),h.item_energy=ct.toFixed(0),h.expend_energy=pt.toFixed(0);let r=40;var L=[2,2.8,3.2,3.2,3.6,3.8,3.7,4,4.8,4.8,5.2,5.2,5.4,5.8,5.8,6,6.4,6.6,6.8,7,7,7,7,7.3],H=[200,500,1e3,2e3,2750,3e3,3500,4e3,6e3,7e3,8e3,11e3,12420,18e3,18100,24140,31260,36610,46640,56520,67775,84535,106305,Number.MAX_SAFE_INTEGER];let s=0,l=o,d=H[0];for(;0<l&&r<2e8;){var G=Math.min(H[s],l,d,1e3),q=L[s];const ht=1.122*1.02*q*G*((348e-9*Math.log(4750)+31e-7)*r/4+.32433-.0301431777);r+=ht,l-=G,d-=G,l<=0?console.log(`能量已用光，最近这次在系数为 ${q} 的健身房锻炼了 ${G} 能量，属性 +${ht.toFixed(2)} 变为 ${r.toFixed(2)}`):2e8<=r?console.log(`已达到CAP，最近这次在系数为 ${q} 的健身房锻炼了 ${G} 能量，属性 +${ht.toFixed(2)} 变为 ${r.toFixed(2)}，剩余 ${l} 能量`):s<L.length-1&&d<=0&&(console.log(`要换健身房了，最近这次在系数为 ${q} 的健身房锻炼了 ${G} 能量，属性 +${ht.toFixed(2)} 变为 ${r.toFixed(2)}，剩余 ${l} 能量`),++s,d=H[s])}if(0<l)if(console.log(`实现CAP消耗的能量：${o-l}`),O<k&&O<=100){const ft=3240*l;r+=ft,console.log(`LSD青年，剩余能量还能再 +${ft.toFixed(2)} 属性，变为 ${r.toFixed(2)}`)}else{const gt=2510*l;r+=gt,console.log(`普通青年，剩余能量还能再 +${gt.toFixed(2)} 属性，变为 ${r.toFixed(2)}`)}else console.log("未达CAP");0<N&&(r=.5*r+.5*r*(1+.9*(Math.pow(1.01,.5*N)-1)),console.log(`再用上 +${N} 个SE，属性变为 ${r.toFixed(2)}`)),r=parseInt(r);let c=yt(r);console.log(`估算bs为：${c}`);var J,X=[2,6,11,26,31,50,71,100],U=[100,5e3,1e4,2e4,3e4,5e4],K=[5e6,5e7,5e8,5e9,5e10],k=[2e3,2e4,2e5,2e6,2e7,2e8],O=[2500,25e3,25e4,25e5,35e6,25e7],V={"Absolute beginner":1,Beginner:2,Inexperienced:3,Rookie:4,Novice:5,"Below average":6,Average:7,Reasonable:8,"Above average":9,Competent:10,"Highly competent":11,Veteran:12,Distinguished:13,"Highly distinguished":14,Professional:15,Star:16,Master:17,Outstanding:18,Celebrity:19,Supreme:20,Idolised:21,Champion:22,Heroic:23,Legendary:24,Elite:25,Invincible:26};let p=0;for(J in V)if(0==h.rank.indexOf(J)){p=V[J],h.rank_value=p,h.rank_name=J;break}N=h.rank.split(" ");if(h.rank_title=N[N.length-1],console.log(`Rank: value = #${p}, name = ${h.rank_name}, title = ${h.rank_title}, full = ${h.rank}`),0<p&&r<Number.MAX_SAFE_INTEGER){--p;var Y=h.level||0;for(let t=0;t<X.length;++t)Y>=X[t]&&--p;console.log(`Rank 减掉 level trigger 还剩下 ${p}`);var Z=h.criminalrecord.total||0;for(let t=0;t<U.length;++t)Z>=U[t]&&--p;console.log(`Rank 减掉 crimes trigger 还剩下 ${p}`);var Q=f.networth||0;for(let t=0;t<K.length;++t)Q>=K[t]&&--p;console.log(`Rank 减掉 networth trigger 还剩下 ${p}`);let t=0,e=Number.MAX_SAFE_INTEGER;p<=0?e=O[0]:p>=k.length?t=k[k.length-1]:(t=k[p-1],e=O[p]),console.log(`根据Rank推算bs区间：[${t}, ${e})`),r<t?(c=`${c} ~ ${yt(t)}`,console.log(`估算总bs小于按Rank推算的下限值：${yt(t)}`)):r>e?(c=`${yt(e)} ~ ${c}`,console.log(`估算总bs高于按Rank推算的上限值：${yt(e)}`)):console.log("估算总bs符合按Rank推算的区间")}h.estimate_bs=r,h.estimate_bs_display=c,h.attackWinRatio=u/z,h.defendWinRatio=(b+m)/(b+m+g),mt(h)}})}function Ot(t){F("#api_result_container").val(F("#api_result_container").val()+"\n"+t)}function Ct(a){a=$t("CHAT_LAST_MESSAGE",a);if(a){a=function(t){var e=t.split("-")[0].trim();const a=t.split("-")[1].replace("TCT","");var n="20"+a.split("/")[2],i=a.split("/")[1],t=a.split("/")[0];const o=new Date(n+"/"+i+"/"+t+" "+e);return o.setHours(o.getHours()-(new Date).getTimezoneOffset()/60),parseInt(o.getTime()/1e3)}(a),a=parseInt((new Date).getTime()/1e3)-a;let t="",e="";return a<3600?(t=parseInt(a/60)+"m ago",e="#5d9525"):3600<=a&&a<86400?(t=parseInt(a/3600)+"h ago",e="#DAA520"):86400<=a&&(t=parseInt(a/86400)+"d ago",e="#c0542f"),[e,t]}}function Ft(t){var e=window.localStorage.getItem("muglog");if(e){var e=JSON.parse(e),n=Object.entries(e);for(let a=n.length-1;0<=a;a--)if(n[a][1].victim_id==t){var i=n[a][0],o="$"+yt(ut(n[a][1].money_mugged)),i=parseInt((new Date).getTime()/1e3)-i;let t="",e="";return i<3600?(t=parseInt(i/60)+"m ago",e="#5d9525"):3600<=i&&i<86400?(t=parseInt(i/3600)+"h ago",e="#DAA520"):86400<=i&&(t=parseInt(i/86400)+"d ago",e="#c0542f"),e+","+t+","+o}}}function Mt(){return F("script[uid]").attr("uid")}function zt(){var t=`https://api.torn.com/torn/?selections=companies&key=${y}`;fetch(t).then(t=>t.json()).then(e=>{const a=new Date;if("companies"in e){let t={};for(var n in t["last-updated"]=a.toString(),t.companies={},e.companies)t.companies[n]={name:e.companies[n].name,positions:e.companies[n].positions};window.localStorage.setItem("APICache_companies",JSON.stringify(t))}else"error"in e&&It("APICache_companies","last-updated",a.toString())}).catch(t=>console.log("fetch error",t))}function Tt(){const n={"中文Wiki":"<a href='https://torn.huijiwiki.com/'>",YATA:"<a href='https://yata.yt/'>",NGA:"<a href='https://bbs.nga.cn/read.php?tid=20217469&_ff=428' target='_blank'>","赛车":"<a href='/loader.php?sid=racing'>","啤酒":"<a href='/shops.php?step=bitsnbobs'>","飞行":"<a href='/travelagency.php'>","库存":"<a href='https://arsonwarehouse.com/foreign-stock' target='_blank'>","市场":"<a href='/imarket.php'>","点市":"<a href='/pmarket.php'>","股市":"<a href='/page.php?sid=stocks'>","巴扎":"<a href='/bazaar.php'>"};setInterval(function(){const t=F("ul.menu-items");if("1"!=t.attr("hasdone")){if(0<t.siblings().length)for(var e in n)t.append('<li class="menu-item-link">'+n[e]+e+"</a></li>");else for(var a in t.attr("style","width:295px; margin-top:6px; line-height:16px;"),t.children(":last").remove(),t.children(":last").remove(),t.children(":last").remove(),n)t.append('<li class="menu-item-link">'+n[a]+a+"</a></li>");t.attr("hasdone","1")}},1e3)}function Nt(){setInterval(function(){const t=F("[class*='chat-active_']"),e=new Date,r=parseInt(e.getTime()/1e3),a=t.children("[class*='chat-box-content_']").children("[class*='viewport_']").children().children("[class*='chat-last-message-label_']");a.each(function(t,e){It("CHAT_LAST_MESSAGE",F(this).parent().parent().parent().siblings("[class^='chat-box-head_']").children().attr("title"),F(this).children("span").text())});const n=t.children("[class*='chat-box-content_']").children("[class*='viewport_']").children().children("[class*='message_']");n.each(function(t,e){const a=F(this).attr("name");var n=a.split("-")[0],n=r-n;let i="",o="";n<3600?(i="["+parseInt(n/60)+"m ago]",o="#5d9525"):3600<=n&&n<86400?(i="["+parseInt(n/3600)+"h ago]",o="#DAA520"):86400<=n&&(i="["+parseInt(n/86400)+"d ago]",o="#c0542f"),F(this).children(".fac-ts").remove(),F(this).prepend('<span class="fac-ts" style="color:'+o+'">'+i+"&nbsp;</span>")})},1e3)}function Pt(){const r={THU:["Leader","Co-leader","WEIYUAN","CHANGWEI"],SVH:["Leader","Co-leader","Dalao","Julao","Leaders","Hand","SanCaiTongZi","Mirror","TirionFordring"],NOV:["Leader","Co-leader","Karajan","Haydn","Chopin"],TTT:["Leader","Co-leader","General","Marshal"]};setInterval(function(){const t=F("[class*='type-list_']");if(0<t.length){const e=t.children("li:eq(3)").attr("class");if(0<=e.indexOf("active")){const a=F("[class*='people-list_']");"1"!=a.attr("hasDone")&&(a.attr("hasDone","1"),function(i){var t=`https://api.torn.com/faction/?selections=basic&key=${y}`;fetch(t).then(t=>t.json()).then(t=>{if("members"in t){let o=[];for(const n in t.members){var e=t.members[n].position,a=t.members[n].status.state;0<=r[t.tag].indexOf(e)&&"Okay"==a&&o.push(n)}i.each(function(t,e){const a=F(this).attr("class"),n=F(this).children("a").attr("href");var i=n?n.substring(18):0;0<=o.indexOf(i)&&0<=a.indexOf("online")&&(F(this).children("a").append("<span style='color:white'><b> 可取钱 在城内</b></span>"),F(this).css("background-color","Darkseagreen"))})}else"error"in t&&console.log(t.error.error)}).catch(t=>console.log("fetch error",t))}(a.children("li")))}}},3e3)}function Et(t){0<F("#icon15-sidebar").length&&F("#nurse").length<1&&(F(t).before(`
                <div style="margin-bottom:5px;">
                    <div id='nurse' style='color:#333;width:inherit;margin:auto;padding:10px;border:5px solid gray;background-color:#ccc;text-align:center;'>
                        <div id='nurse-eff' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-cd' style='font-size:24px;padding:2px;'>小护士竭诚为你服务</div>    
                        <div id='nurse-item' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-suggestion' style='font-size:24px;padding:2px;'></div>
                        <div id='nurse-item-life' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-suggestion-life' style='font-size:24px;padding:2px;'></div>
                    </div>
                </div>`),t=`https://api.torn.com/user/?selections=profile,cooldowns,perks&key=${y}`,fetch(t).then(t=>t.ok?t.json():void F("#nurse-cd").text("--- 小护士探测失败 ---"),t=>{F("#nurse-cd").text("--- 小护士网络异常 ---")}).then(g=>{if(null!=g)if("error"in g)F("#nurse-cd").text(`--- API错误 --- code: ${g.error.code} error: ${g.error.error}`);else if("basicicons"in g&&"icon15"in g.basicicons){function m(t){let e=parseInt(t/3600);e=e<10?"0"+e:e;let a=parseInt(t/60)%60;a=a<10?"0"+a:a;let n=t%60;return n=n<10?"0"+n:n,e+":"+a+":"+n}var b=g.states.hospital_timestamp,u=b?b-parseInt((new Date).getTime()/1e3):0,y=m(u),v=parseInt(u/60),x=100-(g.life.current||0)/(g.life.maximum||7500)*100,w=m(g.cooldowns.medical||0);let a=!1,t=0,e=0,n=0;if("education_perks"in g){const O=g.education_perks;0<=O.indexOf("+ Withdraw and deliver blood")&&(a=!0),0<=O.indexOf("+ 20% Medical item effectiveness")&&(t=20),0<=O.indexOf("+ 10% Medical item effectiveness")&&(t=10)}if("faction_perks"in g){const C=g.faction_perks;C.forEach(function(t){0<=t.indexOf("medical item effectiveness")&&(e=t.replace("+ Gain","").replace("% medical item effectiveness","").trim()),0<=t.indexOf("minutes of maximum medical cooldown")&&(n=t.replace("+ Adds","").replace("minutes of maximum medical cooldown","").trim())})}let i=6+parseInt(n/60);i=i<10?"0"+i:i;let o=n%60;o=o<10?"0"+o:o;var _=i+":"+o+":00";const A=parseInt(t)+parseInt(e)+100;console.log(A);let r=0,s=0,l=0,d=0;console.log(v);var k=function t(e){return a&&e>.7*A?(r+=1,t(e-1.2*A)):e>.4*A?(s+=1,t(e-.7*A)):e>.2*A?(l+=1,t(e-.4*A)):0<e?(d+=1,t(e-.2*A)):e}(v);console.log(k);var $=0==r?"":"大血包*"+r,I=0==s?"":"吗啡*"+s,D=0==l?"":"小蓝包*"+l,S=0==d?"":"小红包*"+d,b=30*r+20*s+15*l+10*d;let c=0,p=0,h=0,f=0;u=function t(e){return a&&e>.15*A?(c+=1,t(e-.3*A)):e>.1*A?(p+=1,t(e-.15*A)):e>.05*A?(h+=1,t(e-.1*A)):0<e?(f+=1,t(e-.05*A)):e}(x);console.log(u);g=0==c?"":"大血包*"+c,v=0==p?"":"吗啡*"+p,k=0==h?"":"小蓝包*"+h,x=0==f?"":"小红包*"+f,u=30*c+20*p+15*h+10*f;F("#nurse-cd").text(`住院时间 ${y} 医疗冷却 ${w}/${_}`),F("#nurse-eff").text(`抽血: ${a} 教育加成: +${t}% 帮派加成: +${e}%`),F("#nurse-item").text(`大血包: -${1.2*A}分钟 吗啡: -${.7*A}分钟 小蓝包: -${.4*A}分钟 小红包: -${.2*A}分钟`),F("#nurse-suggestion").text(`【出院模式】 ${$} ${I} ${D} ${S} (冷却 +${b}分钟)`),F("#nurse-item-life").text(`大血包: 回血+${.3*A}% 吗啡: 回血+${.15*A}% 小蓝包: 回血+${.1*A}% 小红包: 回血+${.05*A}%`),F("#nurse-suggestion-life").text(`【满血模式】 ${g} ${v} ${k} ${x} (冷却 +${u}分钟)`)}}).catch(t=>F("#nurse-cd").text(t)))}function jt(t){return F(t).find("[bs]").attr("bs")}function Rt(t){return 1e15<=t?"max":1e13<=t?parseInt(t/1e12)+"t":1e12<=t?(t/1e12).toFixed(1)+"t":1e10<=t?parseInt(t/1e9)+"b":1e9<=t?(t/1e9).toFixed(1)+"b":1e7<=t?parseInt(t/1e6)+"m":1e6<=t?(t/1e6).toFixed(1)+"m":1e4<=t?parseInt(t/1e3)+"k":1e3<=t?(t/1e3).toFixed(1)+"k":t}}}();
