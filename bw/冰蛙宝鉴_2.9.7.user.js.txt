// ==UserScript==
// @name         冰蛙宝鉴
// @namespace    SMTH
// @version      2.9.7
// @description  随时随地通过API接口看你想看！
// @author       bingri[1523812] kaeru[1769499] htys[1545351]
// @match        https://www.torn.com/*.php*
// @grant        none
// @require      https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.5/xlsx.min.js
// ==/UserScript==


!function(){"use strict";const C=window.jQuery,t=window.unsafeWindow||window;if(!t.BINGWA){const Lt=[{name:"foo",title:"阅兵助手",desc:"在部分页面显示阅兵按钮，可以快速获取玩家信息",default:!(t.BINGWA=!0)},{name:"noAssisting",title:"防打重",desc:"如果已有其他人进入战斗则屏蔽JOIN按钮",default:!1},{name:"mugoo",title:"山贼助手",desc:"在市场列表界面显示用户状态和攻击链接",default:!0},{name:"chatTimestamp",title:"聊天时间戳",desc:"聊天频道显示每条内容已发送时间",default:!0},{name:"travelFilter",title:"飞花过滤",desc:"在海外市场页面屏蔽不重要物品",default:!0},{name:"jailView",title:"监狱助手",desc:"在监狱页面屏蔽分数大于10000的目标，本帮人员置顶高亮显示",default:!0},{name:"stockexchange_show_abbr",title:"股票助手",desc:"在股票交易市场页面的股票名称前显示缩写",default:!0},{name:"gym_show_ratio",title:"健身房助手",desc:"在健身房页面显示推荐的属性比例",default:!0},{name:"common_modify_header_links",title:"顶部快捷入口",desc:"在页面顶部添加一些常用页面的链接",default:!0},{name:"hide_cloud_while_flying",title:"飞行无云",desc:"在飞行界面隐藏飞机和云彩",default:!0},{name:"withdrawal_helper",title:"取钱助手",desc:"右下角聊天people框高亮显示帮派可取钱名单",default:!0},{name:"bigger_screen_on_laptop",title:"laptop大屏",desc:"飞行中使用笔记本电脑时可以全屏显示",default:!0},{name:"taking_off_reminder",title:"起飞吃药提醒",desc:"起飞前根据CD提醒吃药和OC",default:!0},{name:"bounty_parade",title:"悬赏阅兵",desc:"报纸-悬赏页面显示目标BS",default:!1},{name:"nurse_suggestion",title:"护士建议",desc:"智能提醒出院吃药",default:!0}];Lt.forEach(t=>{var e=It("BWM_SETTINGS",t.name);null==e&&Dt("BWM_SETTINGS",t.name,String(t.default)),window[t.name]="true"==It("BWM_SETTINGS",t.name)});let x=localStorage.getItem("APIKey");const Gt={20465:"SMTH",36134:"Silver Hand",10741:"Trisolary",16335:"November Chopin",7074:"Legends Never Die",16424:"Party Animals"};var e,d,i,a,n,r,c,p,o={8836:"Vinerri",2095:"Guerrilla Warfare",11356:"-UGK-",31312:"TORNado",8255:"Scream Silence",26312:"The Avengers",28205:"Invictus",10913:"Unbroken Warriors",8510:"Ara Pacis",5113:"ThugLife",13343:"The Defiant",39756:"Abusement Park",38761:"Shadow Healers",42125:"Octogenarian DirtyBombers",35739:"Kingsmen",14820:"Unbroken Legion",10140:"In Memory of the Fallen",9405:"Lake Of Lerna",30085:"Rampage Total Destruction"};const qt={gray:"#adadad",red:"#ff7373",green:"#8fbc8f",blue:"#65a5d1",purple:"#8d6dd7",yellow:"#f39826",yellowgreen:"#83a000",pink:"#e467b3",salmon:"#F9CDAD",orange:"#FFDEAD"};if(Date.prototype.format=function(t){var e,a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(e in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t},function(){var e=It("APICache_companies","last-updated");if(null!=e&&null!=e){var a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&zt()}else zt()}(),travelFilter&&function(){const o={186:"绵羊",187:"泰迪熊",215:"猫咪",258:"美洲豹",261:"貂熊",266:"尼斯湖水怪",268:"赤狐",269:"猴子",273:"岩羚羊",274:"大熊猫",281:"狮子",384:"骆驼",618:"黄貂鱼",260:"大丽花",263:"番红花",264:"兰花",267:"帚石楠",271:"木棉花",272:"雪绒花",276:"牡丹花",277:"樱花",282:"非洲堇",385:"蒺藜花",617:"香蕉兰",256:"催泪弹",226:"烟雾弹",222:"闪光弹",616:"鳟鱼"},t=C(".travel-agency-market ul.users-list li"),s=[260,263,264,267,271,272,276,277,282,385,617].concat([186,187,215,258,261,266,268,269,273,274,281,384,618]).concat([206,616,222,226,256]);if(0<t.length&&"filtered"!=t.attr("filtered")){let r=parseInt(C("div.delimiter div.msg:contains(You have purchased) span.bold").last().text());var e=parseInt(C(C("div.delimiter div.msg:contains(You have purchased) span.bold").get(-2)).text());r-=e,(isNaN(r)||r<=0)&&(r=1),t.each((t,e)=>{var a=parseInt(C(e).find("div.details").attr("itemid"));if(isNaN(a)||!(0<a))return!1;if(s.indexOf(a)<0)C(e).addClass("hide");else{const n=C(e).find("input#item-"+a)[0];if(n.value=r,n.dispatchEvent(new Event("blur")),o[a]){a=o[a];const i=C(e).find("span.name");i.html(i.html()+"<span style='float:right;padding-right:10px;'>"+a+"</span>")}}}),t.attr("filtered","filtered")}C("#show_more").length<1&&(C(".travel-agency-market").after("<div><div id='show_more' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;background-color:#c0542f;text-align:center;'>点击显示全部</div></div>"),C("#show_more").click(function(){C(this).parent().remove(),t.removeClass("hide")}))}(),common_modify_header_links&&Pt(),chatTimestamp&&Et(),setInterval(function(){if(0<C("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").length&&!C("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone")){C("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").attr("hasdone","1");const t=C("#profile-mini-root").children().children("[class^=profile-mini-_userImageWrapper]").children("a"),e=t?t.attr("href"):void 0,a=e?e.substr(20):void 0;a&&Ot(a,function(t){Dt("battlestats",a,t.estimate_bs),C("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").append(`
                            <div id="bingwa-estimate-bs" style="width:165px; height:16px; position: absolute; left: 1px; top: 2px; z-index: 1; color: white ;background-color: ${qt.blue}; border: 2px solid darkgray; padding-top: 3px; margin: 5px; text-align: center;">
                                <span>估算战力: ${t.estimate_bs_display}</span>
                            </div>
                        `);const e=parseInt(100*t.life.current/t.life.maximum);t="血量: "+t.life.current+"/"+t.life.maximum+" ("+e+"%)";e<=66?C("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").append(`
                            <div id="hp-bar" style="width:165px; height:16px; overflow:hidden; position: absolute; left: 1px; top: 28px; z-index: 1; color: white ;background-color: #eee; border: 2px solid darkgray; padding: 0px; margin: 5px; text-align: center;">
                                ${At(16,e,"#c0542f","#eee",t)}
                            </div>
                            `):(100<e&&(e=100),C("#profile-mini-root").children().children("[class^=profile-mini-_userProfileWrapper]").append(`
                            <div id="hp-bar" style="width:165px; height:16px; overflow:hidden; position: absolute; left: 1px; top: 28px; z-index: 1; color: white ;background-color: #eee; border: 2px solid darkgray; padding: 0px; margin: 5px; text-align: center;">
                                ${At(16,e,"#5d9525","#eee",t)}
                            </div>
                            `))})}},500),withdrawal_helper&&jt(),hide_cloud_while_flying&&0<C("#plane").length&&(C("#clouds-1").remove(),C("#clouds-2").remove(),C("#clouds-3").remove(),C("#plane").children().remove()),bigger_screen_on_laptop&&0<C(".computer-wrap").length&&(C(".computer-navigation").insertBefore(".computer-wrap"),C("#computer-content-wrapper").insertBefore(".computer-wrap"),C(".computer-wrap").css("visibility","hidden"),C(".computer-navigation").attr("style","position: unset; margin-bottom: 10px;"),C("#computer-content-wrapper").removeClass("left"),C("#computer-content-wrapper").css("margin","auto")),0<=window.location.href.indexOf("loader.php?sid=racing")&&setInterval(function(){C(".bar-tpl-wrap:not([show-value])").each(function(t,e){let a=0,n=0,i=0;i=C(e).hasClass("negative")?(a=parseFloat(C(e).find(".progress-light-gray")[0].style.width),n=parseFloat(C(e).find(".progress-red")[0].style.width),a=parseFloat(a*n/100),a-n):C(e).hasClass("positive")?(n=parseFloat(C(e).find(".progress-light-gray")[0].style.width),a=parseFloat(C(e).find(".progress-light-green")[0].style.width),n=parseFloat(a*n/100),a-n):(n=parseFloat(C(e).find(".progress-")[0].style.width),0),C(e).css("line-height","17px").css("margin-top","0px").css("width","88px").html("<span style='color: gray'>"+n.toFixed(2)+"</span>"+(0<=i?" + ":" - ")+Math.abs(i).toFixed(2)),C(e).css("color",0<=i?"green":"red"),C(e).attr("show-value","show-value")})},500),0<=window.location.href.indexOf("shops.php?step=bitsnbobs")&&C(".buy-flexslider").find(":input").val("100"),0<=window.location.href.indexOf("factions.php?step=your")){function s(){var t=JSON.parse(C("#websocketConnectionData").text());return t.playername+" ["+t.userID+"]"}function l(t,e){const a=C("ul.money-depositors").children("li.depositor").find("span[title='"+e+"']").parent().siblings("div.amount").children().children().attr("data-value");let n="$"+a;0!=a&&(n=a.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})),n.includes("-")?t.text("").append(`<span>${e}</span><span class ='t-red right'>${n}</span>`):t.text("").append(`<span>${e}</span><span class ='right'>${n}</span>`)}function g(e,a,n){let i=xt(a);if(0<=a){var r="#5d9525";let t=100*a/n;"准备金率"==e&&(t=Math.min(100*a,100),i=(100*a).toFixed(2)+"%"),C("#faction_balance_li").append(`
                    <div style="overflow:hidden; margin:7px; border:1px solid gray;">
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${At(22,0,r,"#eee",e)}</div>
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${At(22,t,r,"#eee",i)}</div>
                    </div>`)}else{r="#c0542f",n=100*a/n+100;C("#faction_balance_li").append(`
                    <div style="overflow:hidden; margin:7px; border:1px solid gray;">
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${At(22,n,"#eee",r,e)}</div>
                        <div style="width:137px; height:22px; float:left; text-align:center; overflow:hidden;">${At(22,0,r,"#eee",i)}</div>
                    </div>`)}}let t=new MutationObserver(function(t,e){console.log("changed"),function(){const t=C("div#money-user-cont").find("li.ui-custom-item");!C("input#money-user")||"."!=C("input#money-user").val()&&" "!=C("input#money-user").val()||(C("input#money-user").val(s()).addClass("chosen"),console.log(s()),l(t.children(),s())),0<t.length&&!t.children().text().includes("$")&&!t.hasClass("empty")&&t.each(function(){var t=C(this).children().text();l(C(this).children(),t)})}(),function(){const e=C(".money-wrap").children(".give-block"),t=[{button_name:"取1m","button-value":"1,000,000"},{button_name:"取5m","button-value":"5,000,000"},{button_name:"取10m","button-value":"10,000,000"},{button_name:"取25m","button-value":"25,000,000"}];C(".button-wrap").length<1&&(e.children(".info").after(`
                    <div class="button-wrap" style="margin:2px;">
                        <span id="deposit-self" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.purple};">给自己</span>
                        <span id="deposit0" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.blue};">${t[0].button_name}</span>
                        <span id="deposit1" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.blue};">${t[1].button_name}</span>
                        <span id="deposit2" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.blue};">${t[2].button_name}</span>
                        <span id="deposit3" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.blue};">${t[3].button_name}</span>
                        <span id="deposit-all" class="border-round" style="cursor:pointer; margin:2px; padding:3px; color:white; background-color:${qt.blue};">全取</span>
                    </div>`),e.children(".select-wrap").css("padding-top","1px"),C("#deposit-self").click(()=>{C("input#money-user").val(s()).addClass("chosen")}),C("#deposit0").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[0]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),C("#deposit1").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[1]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),C("#deposit2").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[2]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),C("#deposit3").click(()=>{e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t[3]["button-value"]),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled")}),C("#deposit-all").click(()=>{var t;0<=e.children(".select-wrap").children(".result").text().indexOf("]")&&(t=e.children(".select-wrap").children(".result").children(".right").text().replace("$",""),console.log(t),e.children(".inputs-wrap").children(".input-money-group").addClass("success").children("input").attr("value",t),e.children(".inputs-wrap").children(".btn-wrap").children().children().attr("disabled",!1).removeClass("disabled"))}))}(),function(){C("div.input-money-group").attr("class","input-money-group no-max-value");const t=C("ul.money-depositors").children("li.depositor");if(0<C("div.give-block").length&&C("#faction_balance_li").length<=0&&0<t.length){var e=ut(C(".money-wrap").children(".balance-message").children(".sum-of-deposit").text()),i=ut(C(".money-wrap").children(".balance-message").children(".faction-balance").text());let a=0,n=0;t.each((t,e)=>{e=parseInt(C(e).find("span.money").attr("data-value"));0<e?a+=e:n+=e});var r=parseInt(i)+parseInt(e),o=Math.max(Math.abs(e),Math.abs(i),Math.abs(a),Math.abs(n),Math.abs(r));C("#money").children(".balance-message").after(`
                    <div id="faction_balance_li" 
                    style="width:290px; border:4px solid gray; 
                    padding:5px 2px; margin:0px 0px 5px 5px; 
                    background-color:#fff; background-image: linear-gradient(rgba(209,73,78,0.2),rgba(209,73,78,0.1));">
                </div>`),g("帮派余额",r,o),g("所有存款总和",e,o),g("帮派公共资金",i,o),g("正存款总和",a,o),g("负存款总和",n,o),g("准备金率",parseFloat(r/a),o)}}()});t.observe(document.getElementById("faction-controls"),{childList:!0,subtree:!0});setInterval(function(){if(0<C("#money-user").length){const t=C("#money-user").parent().parent().siblings(".select-wrap").children(".result");0<=C("#money-user").val().indexOf("]")&&C("#money-user").val()!=t.attr("userid")&&(t.attr("userid",C("#money-user").val()),t.css("display","block"),l(t,C("#money-user").val()))}},500)}if(jailView&&0<=window.location.href.indexOf("jailview.php")){setInterval(function(){const t=C("ul.user-info-list-wrap").children("li");0<t.length&&(t.each(function(t,e){if("1"!=C(this).attr("hasDone")){var a=(function(t){t=t.find("span.time").text().match(/\d+/g),t=t||[0];return t[1]?60*parseInt(t[0])+parseInt(t[1]):parseInt(t[0])}(C(this))+180)*function(t){t=t.find("span.level").text().match(/\d+/g);return t?parseInt(t[0]):0}(C(this)),n=h(C(this))in Gt?1:a;C(this).find("span.reason").append(`&nbsp;&nbsp;<b class="bustscore t-red" sortscore=${n}>${a}</b>`);const i=C(this).children("a.bust").attr("href");null!=i&&i.indexOf("breakout1")<0&&C(this).children("a.bust").attr("href",i+"1"),C(this).removeClass("gray"),1==n?C(this).css("background-color","#5d9525"):2e4<n&&r&&C(this).addClass("hide"),C(this).attr("hasDone","1")}}),t.sort(function(t,e){return b(t)-b(e)}),t.detach().appendTo("ul.user-info-list-wrap"));C("#show_more").length<1&&r&&(C(".userlist-wrapper").after("<div><div id='show_more' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;color:#ccc;background-color:#c0542f;text-align:center;'>点击显示全部</div></div>"),C("#show_more").click(function(){r=!1,C(this).parent().remove(),C("ul.user-info-list-wrap").children("li").removeClass("hide")}))},1e3);let r=!0;function h(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function b(t){return C(t).find("b.bustscore").attr("sortscore")}}if(gym_show_ratio&&0<=window.location.href.indexOf("gym.php")){const Ht={0:{name:"balanced",description:"平衡比例",str:100,def:100,spd:100,dex:100},1:{name:"hank-str",description:"Hank比例-Str最高",str:100,def:80,spd:28,dex:80},2:{name:"hank-def",description:"Hank比例-Def最高",str:80,def:100,spd:80,dex:28},3:{name:"hank-spd",description:"Hank比例-Spd最高",str:28,def:80,spd:100,dex:80},4:{name:"hank-dex",description:"Hank比例-Dex最高",str:80,def:28,spd:80,dex:100},5:{name:"baldr-str",description:"Baldr比例-Str最高",str:100,def:72,spd:80,dex:72},6:{name:"baldr-def",description:"Baldr比例-Def最高",str:72,def:100,spd:72,dex:80},7:{name:"baldr-spd",description:"Baldr比例-Spd最高",str:80,def:72,spd:100,dex:72},8:{name:"baldr-dex",description:"Baldr比例-Dex最高",str:72,def:80,spd:72,dex:100}};function f(t,e,a,n){const i=C("[class^='gymContent___']").children("[class^='properties___']").children("li");var r=C("#strength-val").text().split(",").join(""),o=C("#defense-val").text().split(",").join(""),s=C("#speed-val").text().split(",").join(""),l=C("#dexterity-val").text().split(",").join(""),d=Math.max(r/t,o/e,s/a,l/n),t=Math.abs(d*t-r)<=1?r:parseInt(d*t),e=Math.abs(d*e-o)<=1?o:parseInt(d*e),a=Math.abs(d*a-s)<=1?s:parseInt(d*a),n=Math.abs(d*n-l)<=1?l:parseInt(d*n);const c=[t,e,a,n],p=[t-r,e-o,a-s,n-l];let g=0;C(".gym-goal").remove(),i.each(function(){const t=C(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first");0==t.children(".gym-perks").length?t.html(`<span class="t-red gym-goal" title="目标:${ut(c[g])}">还差:${yt(p[g])} </span>`):t.prepend(`<span class="t-red gym-goal" title="目标:${ut(c[g])}">还差:${yt(p[g])} </span>`),g++})}function m(){var t=`https://api.torn.com/user/?selections=perks&key=${x}`;fetch(t).then(t=>t.json()).then(t=>{console.log("perks API fetched");let a=[{total:0},{total:0},{total:0},{total:0}];if(9==Object.keys(t).length)for(var e in t){const d=t[e];var n,i,r,o=e.split("_")[0];for(let t=0;t<d.length;t++)0<=d[t].search(/strength gym gains/i)?(n=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[0][o]=a[0].hasOwnProperty(o)?a[0][o]+n:n,a[0].total+=n):0<=d[t].search(/defense gym gains/i)?(i=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[1][o]=a[1].hasOwnProperty(o)?a[1][o]+i:i,a[1].total+=i):0<=d[t].search(/speed gym gains/i)?(i=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[2][o]=a[2].hasOwnProperty(o)?a[2][o]+i:i,a[2].total+=i):0<=d[t].search(/dexterity gym gains/i)?(r=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[3][o]=a[3].hasOwnProperty(o)?a[3][o]+r:r,a[3].total+=r):0<=d[t].search(/gym gains/i)&&(r=parseInt(/\d+%/.exec(d[t])[0].replace("%","")),a[0][o]=a[0].hasOwnProperty(o)?a[0][o]+r:r,a[0].total+=r,a[1][o]=a[1].hasOwnProperty(o)?a[1][o]+r:r,a[1].total+=r,a[2][o]=a[2].hasOwnProperty(o)?a[2][o]+r:r,a[2].total+=r,a[3][o]=a[3].hasOwnProperty(o)?a[3][o]+r:r,a[3].total+=r)}const s=C("[class^='gymContent___']").children("[class^='properties___']").children("li");let l=0;s.each(function(){let t="<b>总加成:</b> +"+a[l].total+"%";for(var e in a[l])"total"!=e&&(t+="<br><b>"+e+":</b> +"+a[l][e]+"%");C(this).children("[class^='propertyContent___']").children("[class^=description___]").children("p:first").append(`<span class="t-green gym-perks" title="${t}">锻炼加成:+${a[l].total}% </span>`),l++})}).catch(t=>console.log("fetch error",t))}for(var u in C("#gymroot").children().append(`
        <div>
            <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">锻炼比例推荐
            </div>
            <div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                <div class="select-wrap" style="margin:5px; float:left">
                    <select id="gym-ratio" style="height:24px">
                    </select>
                </div>
                <div class="select-wrap" style="margin:5px 1px; float:left">
                    <p id="gym-ratio-info" style="height:12px; padding:6px 1px;">
                    </p>
                </div>
            </div>
        </div>
    `),Ht)C("#gym-ratio").append(`<option value="${u}">${Ht[u].description}</option>`);const Xt=It("gym-ratio","ratio_number");if(null!==Xt&&void 0!==Xt){C("#gym-ratio").children("[value="+Xt+"]").attr("selected","true"),C("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ht[Xt].str} : ${Ht[Xt].def} : ${Ht[Xt].spd} : ${Ht[Xt].dex}`);const Jt=setInterval(()=>{console.log("interval started"),0<C("[class^='gymContent___']").length&&(console.log("interval ended"),clearInterval(Jt),f(Ht[Xt].str,Ht[Xt].def,Ht[Xt].spd,Ht[Xt].dex),m())},500)}if(C("#gym-ratio").change(function(){console.log("ratio changed");var t=C("#gym-ratio").val();Dt("gym-ratio","ratio_number",t),C("#gym-ratio-info").text(`Str : Def : Spd : Dex = ${Ht[t].str} : ${Ht[t].def} : ${Ht[t].spd} : ${Ht[t].dex}`),f(Ht[t].str,Ht[t].def,Ht[t].spd,Ht[t].dex)}),0<C(".gym___3sIk3").length){let t=new MutationObserver(function(t,e){console.log("observer");const a=C("[class^='gymDetails___']").find("[class^='progressBar___']");a.each(function(){let t=C(this).attr("aria-label").split(" ")[2];"not"==t&&(t=0),C(this).find("[class^='exerciseName___']").text(t+"/10")}),null!==Xt&&void 0!==Xt&&(f(Ht[Xt].str,Ht[Xt].def,Ht[Xt].spd,Ht[Xt].dex),m())});t.observe(document.getElementsByClassName("gym___3sIk3")[0],{childList:!0})}}if(0<=window.location.href.indexOf("index.php")){const Ut=C("#personal-perks");0<Ut.length&&(e=Ut.children("ul").children("li:last"),Ut.children("ul").prepend(e),Ut.children("ul").children("li:first").removeAttr("class"),Ut.children("ul").children("li:last").attr("class","last"),Ut.children("ul").children("li:first").append('<span id="pp-btn" class="border-round" style="cursor:pointer;color:white;background-color:darkseagreen;padding:2px;margin-left:60px;">展开</span>'),C("#pp-btn").click(function(){"展开"==C(this).text()?(C(this).parent().parent().css("height","auto"),C(this).text("折叠"),C(this).css("background-color","orange")):(C(this).parent().parent().css("height","168px"),C(this).text("展开"),C(this).css("background-color","darkseagreen"))}))}if(noAssisting&&0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let e=Math.floor(30*Math.random()+1),a=300;const Kt=setInterval(function(){const t=C("[class^='btn_']");t.text().includes("Start fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(e/10).toFixed(1)+")s To Start fight"),0==e&&(clearInterval(Kt),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),e--)},100),Vt=setInterval(function(){const t=C("[class^='btn_']");t.text().includes("Join fight")&&(t.prop("hidden",!0),t.parent().parent().children(":first").text("Wait ("+(a/10).toFixed(1)+")s To Join fight 已有其他人进入此战斗"),0==a&&(clearInterval(Vt),t.parent().parent().children(":first").text(""),t.removeAttr("hidden")),a--)},100)}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){let i=100;setInterval(function(){{var t,e,a,n;0<C("[class^=level]").length&&0<C("#log-header").length&&(n=C("[class^=level]").attr("style").replace("height: ","").replace("%",""),(t=parseFloat(n))>i||(e=66<=(i=t)?"green":"red",a=66<=t?"高":"低",C("#stealth-value").remove(),n=C("#log-header").children(":first").attr("class"),C("#log-header").children(":first").after(`
                <span id="stealth-value" class="${n}">隐身几率:&nbsp;
                    <span class="t-${e}">${a}</span>
                    &nbsp;Stealth:&nbsp;
                    <span class="t-${e}">${t}%</span>
                </span>`)))}},500)}if(0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")){setInterval(function(){0<C("[class^=labelsContainer]").length&&C("[class^=titleContainer]").empty();0<C("[class^=modal___]").length&&C("#upper-layer").length<1?y(C("[class^=modal___]"),"upper-layer"):0<C("[class^=playerWindow___]").length&&C("#lower-layer").length<1&&y(C("[class^=playerWindow___]"),"lower-layer")},500);const Yt=window.location.href.substr(51);function y(t,i){t.last().append(`
                    <div id="${i}" style="width:200px; height:16px; position: absolute; right: 1px; top: 2px; z-index: 1; color: white ;background-color: ${qt.blue}; border: 2px solid darkgray; padding-top: 3px; margin: 5px; text-align: center;">
                        <span>当前Chain状态读取中...</span>
                    </div>
                `);t=`https://api.torn.com/faction/?selections=chain&key=${x}`;fetch(t).then(t=>t.json()).then(e=>{if("chain"in e){var a=parseInt(e.chain.timeout/60),n=e.chain.timeout%60,a="0"+a,n=9<n?n:"0"+n;let t=qt.blue;100<=e.chain.max&&e.chain.max-e.chain.current<=20&&(t=qt.red),C("#"+i).css("background-color",t).text(`当前Chain: ${e.chain.current}/${e.chain.max} 超时: ${a}:${n}`),console.log(i)}else"error"in e&&C("#"+i).text("当前Chain状态读取失败")}).catch(t=>console.log("fetch error",t))}C("[class^=titleContainer]").empty(),C("[class^=titleContainer]").append(`<span id="online-status" class="border-round" style="color:white;background-color:${qt.red};padding:5px;font-size:18px;" title="在线状态"></span>`),C("[class^=titleContainer]").append(`<span id="last-action" class="border-round" style="color:white;background-color:${qt.red};padding:5px;font-size:18px;" title="离线时间"></span>`),C("[class^=titleContainer]").append(`<span id="refresh-btn" class="border-round" style="cursor:pointer;color:white;background-color:${qt.blue};padding:5px;font-size:18px;">刷新</span>`),C("#refresh-btn").click(()=>{location.reload()}),Ot(Yt,function(t){var e;null!=t&&"last_action"in t&&("Online"==(e=t.last_action.status)?C("#online-status").css("background-color",qt.green):"Idle"==e?C("#online-status").css("background-color",qt.yellow):C("#online-status").css("background-color",qt.gray),C("#online-status").text(e),C("#last-action").text(t.last_action_details))},function(t){C("#online-status").text("蛙蛙探测 "+Yt+" 失败 "+t)})}if(nurse_suggestion&&0<=window.location.href.indexOf("item.php")&&Rt(".tutorial-cont"),0<=window.location.href.indexOf("factions.php?step=your")){let t=new MutationObserver(function(t,e){console.log("changed"),Rt("#faction-armoury-tabs")});t.observe(document.getElementById("faction-armoury"),{childList:!0,subtree:!0})}if(taking_off_reminder&&0<=window.location.href.indexOf("travelagency.php")&&(0<C("#icon86-sidebar").length&&(C("#tab-menu4").after(`<div><div id='oc-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:NavajoWhite;text-align:center;'>OC准备就绪 点击前往执行</div></div>`),C("#oc-btn").click(function(){C(this).text("蛙蛙正在前往……"),window.location.href="https://www.torn.com/factions.php?step=your#/tab=crimes"})),0<C("#icon49-sidebar").length?C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#c0542f;text-align:center;'>DRUG CD 小于10分钟 先不要飞了哦</div></div>`):0<C("#icon50-sidebar").length?C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#DAA520;text-align:center;'>DRUG CD 不足1小时 先不要飞了哦</div></div>`):0<C("#icon51-sidebar").length?C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为1-2小时之间 可尽情飞翔</div></div>`):0<C("#icon52-sidebar").length?C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为2-5小时之间 可尽情飞翔</div></div>`):0<C("#icon53-sidebar").length?C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 大于5小时 可尽情飞翔</div></div>`):C("#tab-menu4").after(`<div><div id='drug-btn' type='button' style='cursor:pointer;width:inherit;font-size:24px;margin:auto;padding:10px;border:5px solid gray;
        background-color:#5d9525;text-align:center;'>DRUG CD 为零 是不是忘吃药了</div></div>`)),0<=window.location.href.indexOf("factions.php?step=your")&&setInterval(function(){C("div.title").children("div.id").text("BS");const t=C("li.enemy").children("div.id");0<t.length&&t.each(function(t,e){const a=C(this).siblings("span").children("div.member").children("a.user.name"),n=a?a.attr("href"):void 0;var i=n?n.substr(18):void 0;i&&((i=It("battlestats",i))?C(this).text(Bt(i)):C(this).text("nil"))});const e=C("li[class^='enemy enemy___']").parent(),a=C("li[class^='enemy enemy___']").children("div.attack").children();0<a.length&&a.each(function(){if("1"!=C(this).attr("detected")){const e=C(this).parent().siblings("div.member").children().children("[class^=userWrap___]").children(),a=e?e.attr("href"):void 0;var t=a?a.substr(18):void 0;console.log(t),t&&((t=It("battlestats",t))?(C(this).text(Bt(t)),C(this).attr("bs",t)):C(this).attr("bs",0))}C(this).attr("detected","1")});0<e.length&&"1"!=e.attr("hasdone")&&(e.attr("hasdone","1"),function(t,a){const e=t.parent().siblings(),n=t.parent().siblings().children();t.click(function(){"decend"==C(this).attr("sort")?(n.sort(function(t,e){return a(t)-a(e)}),n.detach().appendTo(e),C(this).attr("sort","ascend")):(n.sort(function(t,e){return a(e)-a(t)}),n.detach().appendTo(e),C(this).attr("sort","decend"))})}(e.siblings().children("div[class^='attack left attack___']"),Wt))},3e3),0<=window.location.href.indexOf("preferences.php"))setInterval(function(){var t=C("[class^=api___]"),e=C("#name").attr("aria-expanded"),a=C("#name").attr("aria-hidden");if(0<t.length&&"false"==e&&"false"==a){C("#bingwa-apikey-setting").length<1&&C(".content-title").after(`
                    <div id="bingwa-apikey-setting">
                        <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">冰蛙APIKey设置</div>
                        <div id="bingwa-apikey-setting-wrapper" class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                            <div style="margin:5px;padding:5px;">你拥有的APIKey个数为 <span id="apikey-number" style="padding:3px;color:${qt.yellowgreen};font-size:18px;"></span> 个</div>
                            <div style="margin:5px;padding:5px;">冰蛙当前使用的APIKey为 <span id="apikey-current" style="padding:3px;color:${qt.red};font-size:18px;"></span></div>
                            <div id= "apikey-wrapper"style="margin:5px;padding:5px;"></div>
                        </div>
                    </div>`);const n=C("[class^=keyRow]");C("#apikey-number").text(`${n.length}`),C("#apikey-current").text(`${window.localStorage.getItem("APIKey")}`),C("#apikey-wrapper").empty(),0<n.length&&n.each(function(){var t=C(this).children("[class^=key]").val(),e=C(this).children("[class^=blockTablet]").children("[class^=type]").val();C("#"+t).length<1&&(t==window.localStorage.getItem("APIKey")?C("#apikey-wrapper").append(`
                                    <div id="${t}" style="">
                                        <button class="torn-btn" style="margin:5px;" disabled>已使用</button>
                                        <span style="padding:3px;color:white;background-color:${qt.purple};font-size:12px;">${e}</span>
                                        <span style="padding:3px;color:white;background-color:${qt.purple};font-size:16px;">${t}</span>
                                    </div>`):(C("#apikey-wrapper").append(`
                                    <div id="${t}" style="">
                                        <button class="torn-btn" style="margin:5px;">未使用</button>
                                        <span style="padding:3px;color:white;background-color:${qt.gray};font-size:12px;">${e}</span>
                                        <span style="padding:3px;color:white;background-color:${qt.gray};font-size:16px;">${t}</span>
                                    </div>`),C(".torn-btn").click(function(){window.localStorage.setItem("APIKey",C(this).parent().attr("id"))})))})}else C("#bingwa-apikey-setting").remove()},500);else if(null==x||""==x)alert("宝鉴需要一个有效的APIKey，将前往设置页面，待载入后选择你的APIKey。"),window.location.href="https://www.torn.com/preferences.php#tab=api";else{const Zt=C("#sidebarroot").find("[class^='status-icons___']"),Qt=C("#top-page-links-list").children("a");if(0<Qt.length||0<Zt.length){console.log("当前页面有按钮，可以宝鉴");let i={user:["ammo","attacks","attacksfull","bars","basic","battlestats","bazaar","cooldowns","crimes","discord","display","education","events","gym","hof","honors","icons","inventory","jobpoints","log","medals","merits","messages","missions","money","networth","newevents","newmessages","notifications","perks","personalstats","profile","properties","receivedevents","refills","reports","revives","revivesfull","skills","stocks","timestamp","travel","weaponexp","workstats"],property:["property","timestamp"],faction:["applications","armor","armorynews","attacknews","attacks","attacksfull","basic","boosters","cesium","chain","chainreport","chains","contributors","crimenews","crimes","currency","donations","drugs","fundsnews","mainnews","medical","membershipnews","positions","reports","revives","revivesfull","stats","temporary","territory","territorynews","timestamp","upgrades","weapons"],company:["applications","companies","detailed","employees","news","newsfull","profile","stock","timestamp"],market:["bazaar","itemmarket","pointsmarket","timestamp"],torn:["bank","cards","chainreport","companies","competition","education","factiontree","gyms","honors","items","logcategories","logtypes","medals","organisedcrimes","pawnshop","pokertables","properties","rackets","raids","rankedwarreport","rankedwars","stats","stocks","territory","territorywars","timestamp"],key:["info"]},s="",d="",c="";Zt.prepend('<li class="a_click_view_api_info icon6___XChW2" title="冰蛙宝鉴 呱" style="cursor: pointer; background-image:url(/images/v2/editor/emoticons.svg); background-position: -470px -42px;"></li>');Qt.last().after('<a role="button" style="cursor: pointer" aria-labelledby="events" class="a_click_view_api_info events t-clear h c-pointer  m-icon line-h24 right last"><span class="icon-wrap svg-icon-wrap"><span class="link-icon-svg events "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17"><defs><style>.cls-1{opacity:0.35;}.cls-2{fill:#fff;}.cls-3{fill:#777;}</style></defs><g id="Ð¡Ð»Ð¾Ð¹_2" data-name="Ð¡Ð»Ð¾Ð¹ 2"><g id="icons"><g class="cls-1"><path class="cls-2" d="M8,1a8,8,0,1,0,8,8A8,8,0,0,0,8,1ZM6.47,3.87H9.53l-.77,7.18H7.24ZM8,14.55A1.15,1.15,0,1,1,9.15,13.4,1.14,1.14,0,0,1,8,14.55Z"></path></g><path class="cls-3" d="M8,0a8,8,0,1,0,8,8A8,8,0,0,0,8,0ZM6.47,2.87H9.53l-.77,7.18H7.24ZM8,13.55A1.15,1.15,0,1,1,9.15,12.4,1.14,1.14,0,0,1,8,13.55Z"></path></g></g></svg></span></span><span id="a_click_view_api_info_text">宝鉴</span></a>'),C(".a_click_view_api_info").click(function(){if(C("#bwm").length<1){C("#mainContainer").prepend(`
                    <div id="bwm">
                        <div id="bwm-nav">
                            <ul style="list-style-type: none;margin: 10px 0px;padding: 0;overflow: hidden;background-color: #333;">
                                <li style="float: left">
                                    <a id="bwm-version" role="button" style="cursor: pointer;display: block;color: black;background-color: #4CAF50;text-align: center;padding: 14px 16px;text-decoration: none;" >版本记录</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-api" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >查看API</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-company" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >我的公司</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-faction" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >帮派详情</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-target" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >冰蛙目标</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-mug" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >抢劫历史</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-warroom" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >世界局势</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-revive" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >复活助手</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-rankedwar" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >近期RW</a>
                                </li>
                                <li style="float: left">
                                    <a id="bwm-settings" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >设置</a>
                                </li>
                                <li style="float: right">
                                    <a id="bwm-return" role="button" style="cursor: pointer;display: block;color: white;text-align: center;padding: 14px 16px;text-decoration: none;" >返回</a>
                                </li>
                            </ul>
                        </div>
                    </div>`);const n="cursor: pointer; display: block; color: black; background-color: #4CAF50; text-align: center; padding: 14px 16px; text-decoration: none;",l="cursor: pointer; display: block; color: white; text-align: center; padding: 14px 16px; text-decoration: none;";function t(){var t=function(){var e={"2.9.7":{date:"2022.02.27",notes:["新功能: attack页面 - 显示chain进度，防止bonus打偏","修改: 公司页面 - 新增效率估算","修改: 冰蛙目标页面 - 若出院时间小于10分钟，则根据出院时间逐渐降低背景色透明度","修改: 搜索页面 - 若与目标超过35天未有聊天行为，则最近唠嗑显示为灰色","修复: 无法阅兵的bug"]},"2.9.6":{date:"2022.02.22",notes:["新功能: profile页面和mini profile页面显示血条"]},"2.9.5":{date:"2022.02.15",notes:["新功能: 冰蛙目标，自动刷新的目标监视利器","新功能: 帮派详情增加level和id显示","修复: 小护士调整小数保留位数"]},"2.9.4":{date:"2022.01.24",notes:["修复: 部分顶部链接","修复: miniBS显示位置","修复: PTA取钱功能","修复: 帮派页面显示阅兵、BS、离线时间和住院时间，取消排序功能"]},"2.9.3":{date:"2022.01.08",notes:["新功能：近期RW显示服务器近期RW的记录"]},"2.9.2":{date:"2022.01.04",notes:["新功能：帮派取钱现在在更加明显的位置提示余额，并且新增加了全取按钮","新功能：侧边栏现在有冰蛙图标了","修复：修复了飞行时读取不到自己id导致的公司页面无法显示问题","修复：帮派详情页面增加了显示内容（帮派图标和rank等级）"]},"2.9.1":{date:"2021.12.30",notes:["修复：修正了某些API的匹配格式，使得小护士可以正常运行","修复：更新了profile页面的攻击链接，现在玩家在医院可以读取完整的战斗页面了","修复：为一部分表格增加横向拖动条，使其在超出手机屏幕宽度时也可以显示完整内容（感谢Woohoo）","修复：微调了profile页面BS显示相关内容"]},"2.9.0":{date:"2021.12.28",notes:["新功能：小护士现在可以分别按照【出院模式】和【满血模式】提供建议","新功能：profile页面新增估算WS","新功能：针对公司老板新增显示公司货物库存","修复：修复了mini profile上估算bs重复显示的问题","修复：修复了小护士有时获取不到住院时间的问题","修复：修复了帮派余额和准备金率显示错误的问题","修复：profile连续活跃天数重新修改为冰蛙活跃天数","修复：修改了某些配色以解决深色模式下看不清的问题","修复：现在飞行无云功能不再显示飞机图片了","修复：针对非东8区用户修改了唠嗑时间显示不正确的问题","修复：更新了key->info和rankedwarreport等API条目"]},"2.8.9":{date:"2021.12.09",notes:["新功能：自己帮派的Ranked War界面会显示敌人bs(需提前对该帮派阅兵)，并且可以按bs排序","修复：小护士读取不到API时的报错","修复：faction和company重绘读取不到API时的报错"]},"2.8.8":{date:"2021.11.24",notes:["修复：使用API重绘faction和company页面时匹配不同url","修复：一个神奇的bug"]},"2.8.7":{date:"2021.11.23",notes:["新功能：在个人profile页面显示上次聊天时间和上次mug时间金额","新功能：在高级搜索页面显示上次聊天时间"]},"2.8.6":{date:"2021.11.19",notes:["新功能：mini profile显示冰蛙估算战力","新功能：帮派仓库增加快捷取钱按钮","修改：使用帮派药品出院时也可以获得小护士建议了"]},"2.8.5":{date:"2021.11.08",notes:["新功能：战斗页面增加显示目标在线状态","修改：冰蛙APIKey读取页面UI","修改：阅兵可以按bazaar金额筛选目标，增加bazaar链接","修改：在飞行入院或入狱时也可以在company.php页面查看效率表格了"]},"2.8.4":{date:"2021.11.01",notes:["新功能：战斗页面增加量化显示stealth隐身概率","新功能：item页面增加小护士智能出院建议","新功能：在自己帮派的战斗中，会显示墙上敌人的bs(需提前对该帮派阅兵)","修复PDA会重复载入冰蛙的bug(感谢Woohoo-)"]},"2.8.3.1":{date:"2021.10.25",notes:["公司管理中增加显示本周销售额（实时数据）和近一周利润（缓存数据）","公司管理表格改为显示到公司页面的下方"]},"2.8.3":{date:"2021.10.23",notes:["起飞页面增加吃药cd和oc提醒功能","bounty页面增加自动阅兵功能，默认关闭需在设置中手动开启","个人页面的冰蛙检测增加显示活跃天数，删除ECS数量","在个人页面enemy数量右侧增加显示坏比指数","points市场目标提示现在可以显示新人和衣服店了"]},"2.8.2":{date:"2021.10.08",notes:["启用更精确的计算监狱分数公式并且显示分数提高到25000","修复阅兵bug"]},"2.8.1":{date:"2021.09.30",notes:["取消大乱斗功能","取消oc提醒功能"]},"2.8.0":{date:"2021.09.11",notes:["新增大乱斗阅兵","优化了大乱斗界面"]},"2.7.9":{date:"2021.09.09",notes:["新增了API条目","更新了顶部快捷链接","阅兵可以显示大乱斗所在队伍","在海外也可以查看大乱斗"]},"2.7.8":{date:"2021.08.18",notes:["阅兵可以显示目标bazaar内全部物品价值总和"]},"2.7.7":{date:"2021.06.20",notes:["公司排行页面可以进行公司阅兵了","增加新的快捷打劫链接","不再显示已售空的额外的bazaar","buymug时加入自己人防误伤提醒","OC即将开始时进入飞行界面将获得更加明显的提示","隐藏laptop边框","飞行时不显示云和飞机"]},"2.7.6":{date:"2021.05.29",notes:["不是老板也能查看我的公司表格了","新增帮派取钱助手"]},"2.7.5.2":{date:"2021.05.29",notes:["聊天框时间戳不显示秒","Jail界面增加显示更多按钮","海外库存界面增加显示更多按钮"]},"2.7.5.1":{date:"2021.05.27",notes:["修复聊天框时间戳"]},"2.7.5":{date:"2021.04.12",notes:["顶部链接、健身房、赛车界面UI微调"]},"2.7.4":{date:"2021.04.01",notes:["飞行时查看的公司页面增加TV和油厂的单价估算"]},"2.7.3":{date:"2021.03.30",notes:["我的公司页面UI微调"]},"2.7.2":{date:"2021.03.23",notes:["添加顶部链接和健身房的开关","在股票交易市场页面显示股票缩写"]},"2.7.1":{date:"2021.03.10",notes:["我的公司页面新增显示各员工工资和当前公司实时数据，修复保存31天显示32天的bug","飞行中的帮派信息页区分显示正在被突击和主动突击别人"]},"2.7.0":{date:"2021.02.14",notes:["修改imarket search页面，增加显示目标bazaar内全部物品价值总和","新增功能复活助手"]},"2.6.9":{date:"2021.02.11",notes:["帮派对比功能重做以显示更多数据","加入更多设置选项","index页面加入一键显示全部perks"]},"2.6.8":{date:"2021.02.02",notes:["新增世界局势功能，显示所有正在进行的地盘战，按战况激烈程度染色"]},"2.6.7":{date:"2021.01.24",notes:["在飞行/医院/监狱中也可以查看自己/他人Bazaar中物品"]},"2.6.6.3":{date:"2021.01.22",notes:["解决gym页面与torntools兼容问题"]},"2.6.6.2":{date:"2021.01.19",notes:["修改一些可能存在的bug","Gym页面提供Hank和Baldr属性比例参考","监视列表可以自由添加玩家ID，被监视的目标在海外被高亮（橙色）显示"]},"2.6.6.1":{date:"2021.01.19",notes:["查看个人profile页面的Last action显示为x天x时x分x秒"]},"2.6.6":{date:"2021.01.14",notes:["我的公司及飞行中看帮派、公司功能汉化。","飞行中看帮派信息增加chain、地盘战、raid战的信息。","产量数据支持多种库存的公司。"]},"2.6.5.1":{date:"2021.01.13",notes:["对使用过【我的公司】功能的，每天进游戏时自动检查抓取昨晚的公司运营数据。"]},"2.6.5":{date:"2021.01.11",notes:["公司效率表格微调：增加inactivy，调整列顺序","新增公司历史数据表格","飞行时也能看帮派和公司页面"]},"2.6.4.1":{date:"2021.01.05",notes:["优化公司效率表格显示，并且海外可查看"]},"2.6.4":{date:"2021.01.04",notes:["公司页面显示效率表格","聊天框显示时间戳"]},"2.6.3":{date:"2020.12.28",notes:["顶部增加简易导航条，从api.torn.com更新了API条目","优化阅兵功能，增加暂停和继续按钮","优化帮派对比功能，增加历史记录和高亮显示leader","增加抢劫历史功能，可以从历史记录中选择目标加入监视列表"]},"2.6.2":{date:"2020.11.11",notes:["修复顶部链接导致页面排版错乱的问题","payday功能只向leader和coleader提供"]},"2.6.1":{date:"2020.10.22",notes:["美化排版：pmarket、imarket(search)、imarket页面在显示bs时不再影响原始布局","市场显示超过3个bazaar：imarket(search)页面显示bazaar数量不再局限于3个","bazaar页面简易计算器：可以通过点击选中物品，页面顶部显示选中物品的总价值"]},"2.6.0":{date:"2020.09.28",notes:["itemmarket/pointmarket/bazaar界面增加3个mug相关脚本（感谢Mirror），使用mugoo=true开启","revivehelper重命名为facPageEnhanced，显示内容优化，使用foo=true开启","阅兵模块优化，增加阅兵内容选项，所有阅兵相关功能都使用foo=true开启","监狱置顶标记友帮成员，无视分数","海外people界面用颜色标记友帮和敌帮成员"]},"2.5.9":{date:"2020.09.16",notes:["修复飞花增强功能失效的bug"]},"2.5.8":{date:"2020.11.11",notes:["回滚上版本第一条，因为networth会变化，持续7天才触发rank","蛙蛙探测显示更多页面里的锻炼总能量换成Booster数量"]},"2.5.7":{date:"2020.08.14",notes:["当rank反推的bs上限低于估算值时，忽略估算值，使用rank反推的上下限区间","修复蛙蛙探测显示更多页面排版问题","帮派页面Revive增强功能默认关闭，需要时请将代码头部 reviveHelper 设为 true 手动开启"]},"2.5.6":{date:"2020.08.01",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.5.5.1":{date:"2020.07.30",notes:["修复一些取款小bug，给自己取款时，输入.或者?(英文标点)可自动替换为本人名字，减少输入时间"]},"2.5.5":{date:"2020.07.30",notes:["屏蔽全取按钮，选择取款目标时显示目标额度"]},"2.5.4":{date:"2020.07.27",notes:["增加帮派成员界面一系列功能：阅兵，显示bs、上次登录时间、旅行状态和住院时间，高亮标记住院成员，排序等"]},"2.5.3":{date:"2020.07.07",notes:["增加防打重功能，开关noAssisting = true"]},"2.5.2":{date:"2020.06.17",notes:["修复顶部链接导致页面排版错乱的问题"]},"2.5.1":{date:"2020.06.15",notes:["修复阅兵转换为csv有时丢失某些列的问题"]},"2.5.0":{date:"2020.06.05",notes:["搜索及海外用户列表阅兵功能优化：过滤5b以下，显示mugged, rehabcost, rank, job"]},"2.4.9":{date:"2020.06.05",notes:["飞行中也可以方便的查看帮派成员状态，以及支持包括自己帮在内的最多3个帮派横向对比"]},"2.4.8":{date:"2020.06.04",notes:["jailview 按 jailscore 排序，并优化体验","更新看库存的链接","用户搜索页面增加阅兵功能"]},"2.4.7":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：市场","jailview页面增强：显示各目标的 分钟数*级别；过滤大于1万的；bust不需要二次确认（类似DN的quick bust功能）"]},"2.4.6":{date:"2020.04.26",notes:["左上角菜单中新增常用链接：赛车/啤酒/飞行/库存"]}};let a="",n=0,i="";for(var r in e){i+=e[r].date+" --v"+r+"\n";for(let t=0;t<e[r].notes.length;t++)i+="    "+e[r].notes[t]+"\n";i+="\n";let t=r.split(".");t.splice(1,0,"."),t.join(""),parseFloat(t)>n&&(n=t,a=r)}return[a,i]}();return`
                        <div id="version_container" style="width: inherit">
                            <div style="text-align:center; margin-bottom: 10px;">
                                <a role="button" style="cursor: pointer; font-size: large; color: #777;">冰蛙当前版本为 ${t[0]}</a>
                            </div>
                            <div style="text-align:center;">
                                <textarea  style="height:800px;width:100%;background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly">${t[1]}</textarea>
                            </div>
                        </div>`}window.localStorage.setItem("BINGWA_TARGET_FLAG",""),C("#bwm").append(t()),C("#bwm-version").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(t()),C("#bwm-version").attr("style",n),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l)}),C("#bwm-api").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(function(){let t="";for(var e in i)t+='<a role="button" style="cursor: pointer; font-size: large; color: #777;" class="a_click_api_type">'+e+"</a>&nbsp;&nbsp;";t+='<br /><br /><input type="text" id="api_input_id" name="api_input_id" placeholder="ID (当前用户不用填)" size="25" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_from_time" name="api_input_from_time" placeholder="From (Eg: 2019/10/25 23:00:00)" size="29" style="font-size: larger; padding: 3px;" />&nbsp;&nbsp;<input type="text" id="api_input_to_time" name="api_input_to_time" placeholder="To (Eg: 2019/10/26 08:00:00)" size="28" style="font-size: larger; padding: 3px;" />';let a='<div id="api_container"><div id="api_types_container" style="text-align:center; margin-bottom: 10px;">'+t+'</div><div id="api_fields_container" style="text-align:center; margin-bottom: 10px;"></div><div id="api_result_header" style="text-align:center; margin-bottom: 3px; font-size: large;"></div><div style="text-align:center;"><textarea id="api_result_container" rows="40" style="width:100%; background-color: lightgray; font-family:\'Lucida Console\', Monaco, monospace; font-size: 0.8rem;line-height: 1.3;" readonly="readonly" /><br /><a id="api_result_download_csv" role="button" style="cursor: pointer; font-size: large; color: #777;">导出为CSV文件</a>';return foo?a+='&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_parade" role="button" style="cursor: pointer; font-size: large; color: #777;">帮派大阅兵</a><a id="a_faction_parade_download" role="button" style="display:none">帮派大阅兵下载</a>&nbsp;&nbsp;&nbsp;&nbsp;<a id="a_faction_attacks" role="button" style="cursor: pointer; font-size: large; color: #777;">帮战统计</a><a id="a_faction_attacks_download" role="button" style="display:none">帮战统计下载</a></div></div>':a+="</div></div>",a}()),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",n),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l),C(".a_click_api_type").click(function(){C("#api_fields_container").empty(),s=C(this).text(),console.log("click: "+s);var t,e=i[s].sort();for(t in e){var a=e[t];C("#api_fields_container").append('<a role="button" style="cursor: pointer; font-size: large; color: #777;" class="a_click_api_field">'+a+"</a>&nbsp;&nbsp;"),t%10==8&&C("#api_fields_container").append("<br />")}C(".a_click_api_field").click(function(){C("#api_result_container").val("");var t=C(this).text(),e=C("#api_input_id").val(),a=C("#api_input_from_time").val(),n=new Date(a).getTime()/1e3,i=C("#api_input_to_time").val(),r=new Date(i).getTime()/1e3;let o=`https://api.torn.com/${s}/${e}?selections=${t}&key=${x}&from=${n}&to=${r}`;(isNaN(n)||isNaN(r))&&(o=`https://api.torn.com/${s}/${e}?selections=${t}&key=${x}`),console.log(`Request: ${o}`),c=s+" - "+e+" - "+t+" - "+a+" - "+i,C("#api_result_header").text(`探测中: ${c}`),C("#api_result_download_csv").removeAttr("href"),C("#api_result_download_csv").removeAttr("download"),d="",fetch(o).then(t=>t.ok?t.json():void C("#api_result_header").text(`探测失败: ${c}`),t=>{C("#api_result_header").text(`网络异常: ${c}`)}).then(t=>{console.log(`Response: ${o}`),console.log(t),void 0!==t&&(C("#api_result_header").text(`探测完成: ${c}`),d=t,C("#api_result_container").val(JSON.stringify(t,null,4)))})})}),C("#api_result_download_csv").click(function(){var t;null==d||""==d||null==c||""==c||"object"!=typeof d||d.length<1?alert("没有可导出的数据"):null!=(t=wt(d))?(t=kt(t),C(this).attr("href","data:text/csv;charset=utf-8,\ufeff"+t),C(this).attr("download",c+".csv")):alert("没找到有效的数据集")}),C("#a_faction_parade").click(function(){C("#api_result_container").val("");const l=C("#api_input_id").val();Ct("开始帮派大阅兵，将拉取帮派成员列表，然后逐个查询该成员的详细信息，再使用蛙蛙探测器增加分析结果，最后导出为csv文件。"),Ct("请注意："),Ct("1、此功能会调用很多次API接口，所以不要太频繁使用。"),Ct("2、为了避免太频繁被封接口，每次查询做了延时，所以运行时间较久，请耐心等待。"),Ct("3、如果想中途放弃，请直接关掉本网页窗口。");let a=`https://api.torn.com/faction/${l}?selections=basic&key=${x}`;C("#api_result_header").text(`帮派大阅兵 ${l}`),console.log(`Request: ${a}`),Ct("\n开始获取帮派成员列表"),fetch(a).then(t=>t.ok?t.json():void Ct("阅兵失败"),t=>{Ct("阅兵失败，网络异常")}).then(t=>{console.log(`Response: ${a}`),console.log(t);const n=Object.keys(t.members),e=n.length;Ct(`获取帮派成员列表完成，共有 ${e} 个成员`);let i=new Array,r=0;function o(){const e=n[r];let a=t.members[e];a.userId=e,i.push(a),Ot(e,function(t){Ct(`蛙蛙探测 userId: ${e} 成功`),Object.assign(a,t),s()},function(t){Ct(`蛙蛙探测 userId: ${e} 失败`),s()})}function s(){if(r<e-1)++r,setTimeout(o,1e3);else{Ct("蛙蛙探测完成"),Ct("\n开始转换为csv格式...");var a=kt(i);const n=C("#a_faction_parade_download");n.attr("href","data:text/csv;charset=utf-8,\ufeff"+a);let t=new Date;n.attr("download",`FactionParade_${l}_${t.format("yyyyMMdd_hhmm")}.csv`),Ct("转换为csv格式完成"),Ct("\n开始下载");let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),document.getElementById("a_faction_parade_download").dispatchEvent(e)}}Ct("\n开始启动蛙蛙探测..."),o()})}),C("#a_faction_attacks").click(function(){var t=C("#api_input_from_time").val();const d=new Date(t);let c=d.getTime()/1e3;var e=C("#api_input_to_time").val();const p=new Date(e),g=p.getTime()/1e3;if(isNaN(c)||isNaN(c))alert("此功能必须输入起止时间（你的电脑本地时间，不要转为TCT）");else{C("#api_result_container").val(""),Ct("开始帮战统计，将自动切分时间段，拉取帮派attacks记录（每次最多100条），然后拼接，最后导出为csv文件。"),Ct("请注意："),Ct("1、此功能需要帮派API权限。"),Ct("2、此功能会调用很多次API接口，所以不要太频繁使用。"),Ct("3、每30秒才访问一次（因为测试发现数据有缓存），所以运行时间较久，请耐心等待。"),Ct("4、如果想中途放弃，请直接关掉本网页窗口。"),Ct(`\n开始时间：${t} 时间戳 ${c} ，结束时间：${e} 时间戳 ${g} \n`);let l=new Object;!function o(){const s=`https://api.torn.com/faction/?selections=attacks&key=${x}&from=${c}&to=${g}`;console.log(`Request: ${s}`),C("#api_result_header").text("帮战统计"),fetch(s).then(t=>t.ok?t.json():(Ct("抓取失败，将1秒后重试"),void setTimeout(o,1e3)),t=>{Ct("抓取失败，将1秒后重试"),setTimeout(o,1e3)}).then(t=>{function e(){Ct("\n攻击记录抓取完成，开始转换为csv格式...");var t=kt(vt(l));const e=C("#a_faction_attacks_download");e.attr("href","data:text/csv;charset=utf-8,\ufeff"+t),e.attr("download",`FactionAttacks_${d.format("yyyyMMddhhmmss")}_${p.format("yyyyMMddhhmmss")}.csv`),Ct("转换为csv格式完成"),Ct("\n开始下载");let a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),document.getElementById("a_faction_attacks_download").dispatchEvent(a)}console.log(`Response: ${s}`),console.log(t),Object.assign(l,t.attacks);var a=vt(t.attacks);if(0<a.length){var n=a[0].timestamp_started;const i=new Date(1e3*n);t=a[a.length-1].timestamp_started;const r=new Date(1e3*t);Ct(`抓取 ${c} - ${g} 有 ${a.length} 条，第一条 ${n} ${i.format("yyyy/MM/dd hh:mm:ss")}，最后一条 ${t} ${r.format("yyyy/MM/dd hh:mm:ss")}，累计 ${Object.keys(l).length} 条`),t<c||t>g?1<a.length?(Ct("抓取的数据没有更新，准备重试"),setTimeout(o,1e4)):(Ct("系统会莫名其妙的卡在最后一条，直接完成"),e()):(c=t+2,setTimeout(o,30500))}else e()})}()}})}),C("#bwm-company").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="mycompany_container" style="width: inherit">
                            <div id="mycompany-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <span id="companyname" role="button" style="font-size: large; color:#777;" >我的公司</span>
                            </div>
                            <div id="tips-view-company" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="mycompany-content" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",n),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l);var t=Nt();console.log("userId "+t),et(t).then(function(t){console.log(t);t=t[3];"Employee"==t?E(C("#mycompany-content")):"Director"==t&&j(C("#mycompany-content"))}).catch(t=>console.log("userId2otherIds "+t))}),C("#bwm-faction").click(function(){function o(){var t=window.localStorage.getItem("faction_compare_history");if(null!=t){var e,a=JSON.parse(t);for(e in a)C("#bwm_faction_history").append(`
                                    <div class="wrapper-history" style="width:135px;float:left;border:1px solid darkgray;margin:5px 10px;">
                                        <div class="head-history" style="background-color:black;color:white;padding:5px;overflow:hidden;">
                                            <div class="id-history" style="width:30%;float:left;margin-left:50%;position:relative;left:-15%;">${e}</div>
                                            <div style="float:right;cursor:pointer;background-color:white;color:black;padding:0px 2px;">
                                                <a class="delete-history" role="button" >X</a>
                                            </div>
                                        </div>
                                        <div class="content-history" style="background-color:white;padding:5px;">
                                            <a style="overflow:hidden; text-overflow:ellipsis; white-space:nowrap;" class="user faction" href="/factions.php?step=profile&amp;ID=${e}" target="_blank">${a[e]}</a>
                                        </div>
                                    </div>`);C(".delete-history").click(function(){var t=C(this).parent().parent().children(".id-history").text();St("faction_compare_history",t),C(this).parent().parent().parent().remove(),console.log("删除成功: "+t)}),C(".head-history").click(function(){const t=C(this).siblings(".content-history");var e;"selected"==t.attr("selected")?(t.css("background-color","white"),t.removeAttr("selected"),C("#faction-input-id").val("")):(C(".content-history").css("background-color","white"),C(".content-history").removeAttr("selected"),t.css("background-color","navajowhite"),t.attr("selected","selected"),e=C(this).children(".id-history").text(),C("#faction-input-id").val(e))})}}function t(i,t){t.empty(),t.append(`
                            <div id="name-faction" style="font-size: 20px; margin: 4px;"><img id="tag-faction" style="margin-right: 4px;"><span></span></div>
                            <div id="rank-faction" style="margin: 2px;"></div>
                            <div id="detail-faction" style="margin: 2px;"></div>
                            <div id="table-faction">
                                <table class="table-faction-table" style="margin:auto;background-color:white;font-size:12px;">
                                    <tr class="head">
                                        <th class="table-online">Online</th>
                                        <th class="table-level">Lvl</th>
                                        <th>Name</th>
                                        <th>ID</th>
                                        <th class="table-last">Last</th>
                                        <th class="table-status">Status</th>
                                        <th class="table-position">Position</th>
                                        <th class="table-days">Days</th>
                                        <th>Attack</th>
                                        <th class="table-bs">BS</th>
                                        <th class="table-networth">Networth</th>
                                        <th>Description</th>
                                    </tr>
                                </table>
                            </div>`),C("#table-faction").find(".table-faction-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;");t=`https://api.torn.com/faction/${i}?selections=basic&key=${x}`;const r=C("#bmw_faction_tips");r.text("---探测中 "+i+"---"),fetch(t).then(t=>t.ok?t.json():void r.text("---探测失败 "+i+"---"),t=>{r.text("---网络异常 "+i+"---")}).then(t=>{console.log("API fetched: "+i),null!=t&&r.text("---探测完成 "+i+"---"),C("#name-faction").children("span").text(`${t.name} - ${i}`),C("#tag-faction").attr("src",`https://factiontags.torn.com/${t.tag_image}`),C("#rank-faction").text(`Rank: ${t.rank.name} - ${t.rank.division}`),Dt("faction_compare_history",i,t.name),C("#bwm_faction_history").empty(),o(),C(".id-history").each(function(){C(this).text()==i&&C(this).parent().parent().children(".content-history").css("background-color","NavajoWhite")});var e=Object.keys(t.members).length;const a=t.respect;var n=a.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","});C("#detail-faction").text(`Members: ${e} | Resp: ${n} | Best Chain: ${t.best_chain}`),C.each(t.members,function(t,e){var a=t,n=A(a),i=M(e.last_action.timestamp),r=e.status.state,o=e.status.description,s=e.status.until,t=e.status.color,r=T(o,r,s),s=function(t){let e=It("networths",t),a="";null!=e&&null!=e?a=yt(e):e=0;return[e,a]}(a);let l="white";"Leader"!=e.position&&"Co-leader"!=e.position||(l="NavajoWhite");let d="grey",c=1;"Online"==e.last_action.status?(d="DarkSeaGreen",c=3):"Idle"==e.last_action.status&&(d="Orange",c=2);e=`
                                        <tr class="content">
                                            <td class="table-online" code="${c}" style="border: 1px solid darkgray;padding:5px;color:white;background-color:${d}">${e.last_action.status}</td>
                                            <td class="table-level" style="border: 1px solid darkgray;padding:5px;">${e.level}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;"><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${e.name}</a></td>
                                            <td style="border: 1px solid darkgray;padding:5px;text-align:right;">${a}</td>
                                            <td class="table-last" style="border: 1px solid darkgray;padding:5px;" last-action-minutes="${i[0]}">${i[1]}</td>
                                            <td class="table-status t-${t}" style="border: 1px solid darkgray;padding:5px;" hospital-minutes="${r[1]}">${r[0]}</td>
                                            <td class="table-position" style="border:1px solid darkgray;padding:5px;background-color:${l}">${e.position}</td>
                                            <td class="table-days" style="border: 1px solid darkgray;padding:5px;">${e.days_in_faction}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;"><a style="color:#006699;text-decoration:none;" href="/loader.php?sid=attack&user2ID=${a}" target="_blank">Attack</a></td>
                                            <td class="table-bs" style="border: 1px solid darkgray;padding:5px;" estimate-bs="${n[0]}">${n[2]}</td>
                                            <td class="table-networth" style="border: 1px solid darkgray;padding:5px;" networth="${s[0]}">${s[1]}</td>
                                            <td style="border: 1px solid darkgray;padding:5px;">${e.status.details}</td>
                                        </tr>`;C("#table-faction").children(".table-faction-table").children().append(e)})}).catch(t=>console.log("fetch error",t))}C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="bwm_faction_container" style="width: inherit">
                            <div id="bwm_faction_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <input type="text" id="faction-input-id" name="faction-input-id" placeholder="帮派 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
                                <button id="faction-load-btn" class="torn-btn" style="margin:5px;">读取帮派</button>
                                <button id="faction-parade-start-btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
                                <button id="faction-parade-stop-btn" class="torn-btn" style="margin:5px;" disabled>停止阅兵</button>
                            </div>
                            <div id="bmw_faction_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="bwm_faction_history" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
                            <div id="bmw_faction_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",n),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l),o();let e=window.localStorage.getItem("MY_FACTION_ID");void 0!==e&&null!==e||(e="20465"),C("#faction-load-btn").click(function(){C("#faction-input-id").val()||C("#faction-input-id").val(e),t(C("#faction-input-id").val(),C("#bmw_faction_wrapper")),Ft(C("th.table-bs"),F),Ft(C("th.table-last"),O),Ft(C("th.table-status"),S),Ft(C("th.table-online"),k),Ft(C("th.table-level"),_),Ft(C("th.table-position"),I),Ft(C("th.table-days"),D),Ft(C("th.table-networth"),$)});let i=!0;C("#faction-parade-start-btn").click(function(){i=!0,C("#faction-load-btn").prop("disabled",!0),C("#faction-parade-start-btn").prop("disabled",!0),C("#faction-parade-stop-btn").removeAttr("disabled"),C("tr.head").attr("style","pointer-events: none;");const t=C(".table-faction-table").children().children("tr.content").first();t.length<=0?(C("#bmw_faction_tips").text("未找到用户列表"),C("#faction-load-btn").removeAttr("disabled"),C("#faction-parade-start-btn").removeAttr("disabled"),C("#faction-parade-stop-btn").prop("disabled",!0),C("tr.head").removeAttr("style")):(C("#bmw_faction_tips").text("阅兵开始"),setTimeout(()=>{!function e(a){if("1"==a.attr("detected"))C("#bmw_faction_tips").text("用户已完成"),setTimeout(()=>{e(a.next())},0);else if(a.length<=0||0==i)C("#bmw_faction_tips").text("阅兵已结束"),C("#faction-load-btn").removeAttr("disabled"),C("#faction-parade-start-btn").removeAttr("disabled"),C("#faction-parade-stop-btn").prop("disabled",!0),C("tr.head").removeAttr("style");else{a.attr("detected","1");const n=a.find("a.user.name").attr("href").replace(/[^0-9|-]/gi,"");C("#bmw_faction_tips").text("正在阅兵: "+n),Ot(n,function(t){a.children("td.table-bs").text(yt(t.estimate_bs)),a.children("td.table-bs").attr("estimate-bs",t.estimate_bs),Dt("battlestats",n,t.estimate_bs),a.children("td.table-networth").attr("networth",t.personalstats.networth),a.children("td.table-networth").text(yt(t.personalstats.networth)),Dt("networths",n,t.personalstats.networth),setTimeout(()=>{e(a.next())},1e3)},function(t){C("#bmw_faction_tips").text("蛙蛙探测 "+n+" 失败 "+t),setTimeout(()=>{e(a.next())},1e3)})}}(t)},1e3))}),C("#faction-parade-stop-btn").click(function(){i=!1})}),C("#bwm-target").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="bwm_target_container" style="width: inherit">
                            <div id="bwm_target_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <button id="target-load-excel" class="torn-btn" style="margin:5px;">加载本地excel文件</button>
                                <button id="target-clear-cache" class="torn-btn" style="margin:5px;" disabled>清除缓存</button>
                            </div>
                            <input type="file" id="file" style="display: none;" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"/>
                            <div id="bmw_target_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;">请按以下模板来导入表格 仅限xlsx格式</div>
                            <div id="bmw_target_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;">
                                <table style="margin: auto;">
                                    <tr>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: white;"></th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">A</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">B</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">C</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">D</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">E</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">F</th>
                                        <th style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">G</th>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">1</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">Name</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">ID</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">STR</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">DEF</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">SPD</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">DEX</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">TOTAL</td>
                                    </tr>
                                    <tr>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: gray; color: green; font-weight: bold; text-align: center;">2</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">GoodLuck</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">2356929</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">200,000,000</td>
                                        <td style="border: 1px solid darkgray; padding: 5px; background-color: white; color: black; text-align: center;">800,000,000</td>
                                    </tr>
                                </table>
                            </div>

                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",n),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l);var t=window.localStorage.getItem("BINGWA_TARGET");let r=t?JSON.parse(t):{};function i(t){0==t.length||"ID"in(t=Object.values(t)[0])&&(t=t.ID,console.log(t),et(t).then(function(t){console.log("arr "+t),function e(a,n){window.localStorage.setItem("BINGWA_TARGET_FLAG","refreshing");var t=`https://api.torn.com/faction/${a}?selections=basic&key=${x}`;const i=C("#bmw_target_tips");i.text("---第 "+n+" 次刷新---频率每3秒一次---");fetch(t).then(t=>t.ok?t.json():void i.text("---探测失败 "+a+"---"),t=>{i.text("---网络异常 "+a+"---")}).then(t=>{console.log("faction api refreshed"),C.each(t.members,function(t,p){C(".target-id").each(function(){if(t==C(this).text()){var a=p.last_action.status;let t=qt.yellow;"Online"==a?t=qt.yellowgreen:"Offline"==a&&(t=qt.gray),C(this).siblings(".target-online").css({"background-color":t,color:"white"}).text(a);var n=M(p.last_action.timestamp);C(this).siblings(".target-last").attr("last-action-minutes",n[0]).text(n[1]);var i,r=p.status.description,o=p.status.state,s=p.status.until,l=T(r,o,s);let e=qt.green;"red"==p.status.color?(i=Math.min(l[1]/600,.8)+.2,e="rgba(255, 115, 115, "+i+")"):"blue"==p.status.color&&(e=qt.blue),C(this).siblings(".target-status").attr("hospital-minutes",l[1]).css({"background-color":e,color:"white"}).text(l[0]),C(this).siblings(".target-level").text(p.level);var d=C(this).siblings(".target-fairfight").text();if(d!=isNaN){const c=.25*d*(Math.log(p.level)+1);C(this).siblings(".target-flatrespect").text(c.toFixed(2))}}})}),0<r.length&&0<C(".target-id").length?setTimeout(()=>{e(a,n+1)},3e3):(window.localStorage.setItem("BINGWA_TARGET_FLAG",""),console.log("faction api refreshing ended"))}).catch(t=>console.log("fetch error",t))}(t[0],1)}).catch(t=>console.log("startRefreshing "+t)))}function o(){var t=`https://api.torn.com/user/?selections=battlestats&key=${x}`;const e=C("#bmw_target_tips");e.text("---BS探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---BS探测失败---"),t=>{e.text("---BS网络异常---")}).then(t=>{if(null!=t)if("error"in t)e.text(t.error);else{const r=Math.sqrt(t.strength)+Math.sqrt(t.defense)+Math.sqrt(t.speed)+Math.sqrt(t.dexterity);console.log("My score:"+r),C(".target-fairfight").each(function(){var t=ut(C(this).siblings(".target-str").text()),e=ut(C(this).siblings(".target-def").text()),a=ut(C(this).siblings(".target-spd").text()),n=ut(C(this).siblings(".target-dex").text());let i=((Math.sqrt(t)+Math.sqrt(e)+Math.sqrt(a)+Math.sqrt(n))/r*8/3+1).toFixed(2);3<=i&&(i=3..toFixed(2)),C(this).text(i)})}else e.text("error")}).catch(t=>console.log("fetch error",t))}function s(t){let e=`
                            <table style="margin: auto;">
                                <tr>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Online</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Lvl</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">Name</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #725334; color: white; font-weight: bold; text-align: center;">ID</th>
                                    <th class="head-last" style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">Last</th>
                                    <th class="head-status" style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">Status</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;" title="Fair fight 系数">FF</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;" title="基础面子系数">FR</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #757947; color: white; font-weight: bold; text-align: center;">Attack</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #033649; color: white; font-weight: bold; text-align: center;">TOTAL</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #458994; color: white; font-weight: bold; text-align: center;">STR</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #458994; color: white; font-weight: bold; text-align: center;">DEF</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #458994; color: white; font-weight: bold; text-align: center;">SPD</th>
                                    <th style="border: 1px solid darkgray; padding: 5px; background-color: #458994; color: white; font-weight: bold; text-align: center;">DEX</th>
                                </tr>
                            `;for(var a in t)e+=`
                                <tr>
                                    <td class="target-online" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-level" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-name" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">
                                        <a class="user name" href="/profiles.php?XID=${t[a].ID}" target="_blank">${t[a].Name}</a>
                                    </td>
                                    <td class="target-id" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: right;">${t[a].ID||""}</td>
                                    <td class="target-last" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-status" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-fairfight" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-flatrespect" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;"></td>
                                    <td class="target-attack" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">
                                        <a href="/loader.php?sid=attack&user2ID=${t[a].ID}" style="color: #006699; text-decoration: none;" target="_blank">Attack</a>
                                    </td>
                                    <td class="target-total" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">${ut(t[a].TOTAL)||0}</td>
                                    <td class="target-str" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">${ut(t[a].STR)||0}</td>
                                    <td class="target-def" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">${ut(t[a].DEF)||0}</td>
                                    <td class="target-spd" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">${ut(t[a].SPD)||0}</td>
                                    <td class="target-dex" style="border: 1px solid darkgray; padding: 5px; background-color: #FFF5F7; color: black; text-align: center;">${ut(t[a].DEX)||0}</td>
                                </tr>
                                `;return e+="</table>",e}0<r.length&&(C("#target-load-excel").prop("disabled",!0),C("#file").prop("disabled",!0),C("#target-clear-cache").removeAttr("disabled"),C("#bmw_target_tips").text("加载成功"),C("#bmw_target_wrapper").html(s(r)),o(),"refreshing"!=window.localStorage.getItem("BINGWA_TARGET_FLAG")&&i(r)),C("#target-load-excel").click(function(){document.getElementById("file").click()}),C("#file").change(function(n){var t=n.target.files;0!=t.length&&(t=t[0],/\.xlsx$/g.test(t.name)?function(t,e){const a=new FileReader;a.onload=function(t){t=t.target.result,t=XLSX.read(t,{type:"binary"});e&&e(t)},a.readAsBinaryString(t)}(t,function(t){var e,a;for(a in r=(t=(e=t).SheetNames,t=e.Sheets[t[0]],XLSX.utils.sheet_to_json(t)),r)r[a].Name&&"string"!=typeof r[a].Name&&(r[a].Name=r[a].Name.toString());C("#target-load-excel").prop("disabled",!0),C("#file").prop("disabled",!0),C("#target-clear-cache").removeAttr("disabled"),console.log(r),n.target.value="",C("#bmw_target_tips").text("加载成功"),C("#bmw_target_wrapper").html(s(r)),window.localStorage.setItem("BINGWA_TARGET",JSON.stringify(r)),o(),"refreshing"!=window.localStorage.getItem("BINGWA_TARGET_FLAG")&&i(r)}):alert("仅支持读取xlsx格式！"))}),C("#target-clear-cache").click(function(){1==confirm("确定清除缓存吗？")?(C("#target-load-excel").removeAttr("disabled"),C("#file").removeAttr("disabled"),C("#target-clear-cache").prop("disabled",!0),C("#bmw_target_wrapper").empty(),C("#bmw_target_tips").text("无数据"),window.localStorage.removeItem("BINGWA_TARGET"),r={}):console.log("clear cancelled")})}),C("#bwm-settings").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(function(){let e="";return Lt.forEach(t=>{e+=`
                            <tr style="height: 32px;">
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.title}</td>
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">${t.desc}</td>
                                <td style="border:3px solid darkgray;padding:10px;color:#333;background-color:#ccc">
                                    <select id="bwm_settings_${t.name}">
                                        <option value="false">关闭</option>
                                        <option value="true">打开</option>
                                    </select>
                                </td>
                            </tr>
                        `}),`
                        <div id="bwm_settings_container" style="width: inherit">
                            <div id="bwm_settings_header" style="text-align:center; margin-bottom: 10px;">
                                <table style="margin: auto">
                                    <tr>
                                        <td style="padding: 10px;">
                                            <span class="border-round" style="font-size: large; color: #333; background-color:#ccc; padding:5px;border:3px solid #333;">设置</span>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="bwm_settings_table" style="text-align:center; margin-bottom: 10px;">
                                <table style="border:1px solid darkgray; padding: 5px; margin: auto">
                                    <tr style="height: 32px;">
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能名称</th>
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能描述</th>
                                        <th style="border:3px solid darkgray;padding:10px;color:#ccc;background-color:#111;">功能状态</th>
                                    </tr>
                                    ${e}
                                </table>
                            </div>
                        </div>
                    `}()),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-settings").attr("style",n),C("#bwm-warroom").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l),Lt.forEach(t=>{C(`#bwm_settings_${t.name}`).val(It("BWM_SETTINGS",t.name)),C(`#bwm_settings_${t.name}`).change(function(){Dt("BWM_SETTINGS",t.name,C(this).val())}),window[t.name]="true"==It("BWM_SETTINGS",t.name)})}),C("#bwm-mug").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="mug_container" style="width: inherit">
                            <div id="mug-head" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                <input type="text" id="mug-watchlist-id-input" placeholder="肥羊 ID" size="10" style="font-size: larger; padding: 5px; margin: 5px;" />
                                <button id="mug-watchlist-add-input" class="torn-btn" style="margin: 5px;">加入监视</button>
                            </div>
                            <div id="mug-watchlist" style="margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;"></div>
                            <div id="mug-loglist" style="min-height:400px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden; overflow-x: auto;"></div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",n),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l);let r={};function a(){var t=window.localStorage.getItem("muglog-watchlist");if(null!=t){var a,n=JSON.parse(t);let e=`
                            <table id="mug-watchlist-table" style=" background-color: white; font-size:12px; margin:auto;"><tr class="mug-watchlist-table-head"><th>Victim ID</th><th>Victim Name</th><th>Total Mugged</th><th>删除</th></tr>`;for(a in n){let t="$0";a in r&&(t=xt(r[a].amount)),e+=`
                                    <tr class="mug-watchlist-table-content">
                                        <td class="mug-watchlsit-victimid">${a}</td>
                                        <td><a class="user name" href="/profiles.php?XID=${a}" target="_blank">${n[a].name}</a></td>
                                        <td>${t}</td>
                                        <td><a class="mug-watchlist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
                                    </tr>`}e+="</table>",C("#mug-watchlist").append(e),C("#mug-watchlist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),C("#mug-watchlist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}C(".mug-watchlist-delete").click(function(){var t=C(this).parent().parent().children(".mug-watchlsit-victimid").text();St("muglog-watchlist",t),C(this).parent().parent().remove(),console.log("删除成功 "+t)})}!function(){var e=window.localStorage.getItem("muglog");if(null!=e){var a,n=JSON.parse(e);let t="</table>";for(a in n){var i=n[a].victim_id;i in r?r[i].amount+=xt(n[a].money_mugged):r[i]={name:n[a].victim_name,amount:xt(n[a].money_mugged)},t=`
                                    <tr class="mug-loglist-table-content">
                                        <td class="mug-loglist-ts">${a}</td>
                                        <td class="mug-loglist-time">${n[a].timestring}</td>
                                        <td class="mug-loglist-victimid">${n[a].victim_id}</td>
                                        <td class="mug-loglist-victimname"><a class="user name" href="/profiles.php?XID=${n[a].victim_id}" target="_blank">${n[a].victim_name}</a></td>
                                        <td class="mug-loglist-amount" title="${n[a].timestring}">${n[a].money_mugged}</td>
                                        <td><a class="mug-loglist-watch" role="button" style="cursor: pointer; color: darkblue;">监视</a></td>
                                        <td><a class="mug-loglist-delete" role="button" style="cursor: pointer; color: darkblue;">删除</a></td>
                                    </tr>`+t}t=`
                                <table id="mug-loglist-table" style=" background-color: white; font-size:12px; margin: auto;">
                                    <tr class="mug-loglist-table-head">
                                        <th class="mug-loglist-ts">Timestamp</th>
                                        <th class="mug-loglist-time">Time</th>
                                        <th class="mug-loglist-victimid">Victim ID</th>
                                        <th class="mug-loglist-victimname">Victim Name</th>
                                        <th class="mug-loglist-amount">Money Mugged</th>
                                        <th>监视</th><th>删除</th>
                                    </tr>`+t,C("#mug-loglist").append(t)}C("#mug-loglist-table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;"),C("#mug-loglist-table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),C("#mug_container")[0].clientWidth<400&&(C(".mug-loglist-ts").hide(),C(".mug-loglist-victimid").hide(),C(".mug-loglist-time").hide())}(),a(),C(".mug-loglist-delete").click(function(){var t=C(this).parent().parent().children(".mug-loglist-ts").text();St("muglog",t),C(this).parent().parent().remove(),console.log("删除成功 "+t)}),C(".mug-loglist-watch").click(function(){var t=C(this).parent().parent().children(".mug-loglist-victimid").text();Dt("muglog-watchlist",t,{name:C(this).parent().parent().children(".mug-loglist-victimname").text()}),C("#mug-watchlist-table").remove(),a(),console.log("监视成功 "+t)}),C("#mug-watchlist-add-input").click(function(){const e=C("#mug-watchlist-id-input").val();var t;isNaN(e)||0==e||""==e?alert("无效ID"):(t=`https://api.torn.com/user/${e}?selections=profile&key=${x}`,fetch(t).then(t=>t.json()).then(t=>{if(console.log("API fetched"),null!=t.error&&6==t.error.code)throw alert("无效ID "+e),new Error("Incorrect ID");Dt("muglog-watchlist",e,{name:t.name}),C("#mug-watchlist-table").remove(),a(),alert("监视成功 "+t.name+"["+e+"]"),console.log("监视成功 "+t.name+"["+e+"]")}).catch(t=>console.log("fetch error: ",t.message)))})}),C("#bwm-return").click(function(){C("#bwm").slideUp("slow",function(){C("#bwm").remove()})}),C("#bwm-warroom").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="bwm_warroom_container" style="width:inherit;">
                            <div id="bwm_warroom_header" style="margin:10px 0px; border:1px solid darkgray;text-align:center;">
                                <span id="bwm_warroom_counter" style="margin:5px;padding:5px;"></span>
                                <span style="font-size: large;">WAR ROOM</span>
                                <button class="torn-btn" id="warroom-btn" style="margin:5px;padding:5px;">更多详情</button>
                            </div>
                            <div id="bwm_warroom_filter" style="margin:10px 0px; border:1px solid darkgray; padding: 5px; text-align:center;">
                            </div>
                            <div id="bwm_warroom_wrapper" style="margin:10px 0px; overflow:hidden;">
                            </div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-warroom").attr("style",n),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",l);let e=[];!function(){const t=`https://api.torn.com/torn/?selections=territorywars&key=${x}`,e=C("#bwm_warroom_filter");e.text("---探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---探测失败---"),t=>{e.text("---网络异常---")}).then(t=>{null!=t&&e.text("---探测完成---"),C("#bwm_warroom_counter").text("(当前存在 "+Object.keys(t.territorywars).length+" 场战斗)"),C.each(t.territorywars,function(t,e){var a=function(t,e){let a=Math.abs(parseInt((new Date).getTime()/1e3)-t);e=parseInt(100*a/e);let n="";86400<=a&&(n+=parseInt(a/86400)+"天",a%=86400);3600<=a&&(n+=parseInt(a/3600)+"时",a%=3600);60<=a&&(n+=parseInt(a/60)+"分",a%=60);return n+=a+"秒",[n,e]}(e.started,259200);C("#bwm_warroom_wrapper").append(`
                                        <div class="ttwar" style="width:279px; float:left; border:1px solid darkgray; padding: 5px 2px;margin:5px 2px;background-color:white;background-image: linear-gradient(rgba(192,84,47,0.8),rgba(192,84,47,0.5));">
                                            <div class="ttwar-title" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><button class="torn-btn">${t}</button></div>
                                                <div style="width:100px; float:left; text-align:center; margin:11px 3px;"><b>进攻方</b></div>
                                                <div style="width:100px; float:left; text-align:center; margin:11px 3px;"><b>防守方</b></div>
                                            </div>
                                            <div class="ttwar-faction" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派ID</b></div>
                                                <div class="factionid" style="width:100px; float:left; text-align:center; margin:5px 3px;"><a href="/factions.php?step=profile&ID=${e.assaulting_faction}">${e.assaulting_faction}</a></div>
                                                <div class="factionid" style="width:100px; float:left; text-align:center; margin:5px 3px;"><a href="/factions.php?step=profile&ID=${e.defending_faction}">${e.defending_faction}</a></div>
                                            </div>
                                            <div class="ttwar-factionname" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派名称</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px; overflow:hidden; text-overflow:ellipsis;     white-space:nowrap;"></div> 
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px; overflow:hidden; text-overflow:ellipsis;  white-space:nowrap;"></div>  
                                            </div>
                                            <div class="ttwar-factiontag" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派缩写</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-factionresp" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>帮派声望</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-hospitalcount" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>医院人数</b></div>
                                                <div class="faction-${e.assaulting_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                                <div class="faction-${e.defending_faction}" style="width:100px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-score" style="overflow:hidden; display:none;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>当前分数</b></div>
                                                <div class="territory-${t}" style="width:206px; float:left; text-align:center; margin:5px 3px;"></div>
                                            </div>
                                            <div class="ttwar-score-pbar" style="overflow:hidden; display:none;">
                                                <div class="faction-${e.assaulting_faction}" style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>分数进度</b></div>
                                                <div class="territory-${t}" style="width:212px; height:16px; margin:3px; float:left; text-align:center; overflow:hidden; background-color:#ddd;"></div>
                                            </div>
                                            <div class="ttwar-time" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>时间已过</b></div>
                                                <div style="width:206px; float:left; text-align:center; margin:5px 3px;">${a[0]}</div>
                                            </div>
                                            <div class="ttwar-time-pbar" style="overflow:hidden;">
                                                <div style="width:55px; float:left; text-align:center; margin:5px 3px;"><b>时间进度</b></div>
                                                <div style="width:212px; height:16px; margin:3px; float:left; text-align:center; overflow:hidden; background-color:#ddd;">${At(16,a[1],"#5580a0","white",a[1]+"%")}</div>
                                            </div>
                                        </div>`)})}).catch(t=>console.log("fetch error: ",t.message))}(),C("#warroom-btn").click(function(){C(".factionid").each(function(){var t=C(this).text();-1==e.indexOf(t)&&e.push(t)}),90<e.length&&(e=e.slice(0,90)),C.each(e,function(t,e){!function(t,e){const a=`https://api.torn.com/faction/${t}?selections=basic&key=${x}`,n=C("#bwm_warroom_filter");n.text("---探测中---"),fetch(a).then(t=>t.ok?t.json():void n.text("---探测失败---"),t=>{n.text("---网络异常---")}).then(t=>{null!=t&&n.text("---探测完成---");let a=0;C.each(t.members,function(t,e){"Hospital"==e.status.state&&(a+=1)}),t.hospital_count=a,e(t)}).catch(t=>console.log("fetch error: ",t.message))}(e,function(r){console.log("api fetched"),C.each(r.territory_wars,function(t,e){var a=e.territory,n=e.score+" / "+e.required_score;C(".ttwar-score").children(".territory-"+a).text(n);n=parseInt(100*e.score/e.required_score),e=At(16,n,"#499360","white",n+"%");C(".ttwar-score-pbar").children(".territory-"+a).html(e);n=(r.hospital_count/500).toFixed(2);const i=C(".territory-"+a).parent().parent().css("background-image");e=i.split(",")[3].replace(")",""),n=Number(e)+Number(n);C(".territory-"+a).parent().parent().css("background-image","linear-gradient(rgba(192,84,47,"+n+"),rgba(192,84,47,0.5))")}),C(".ttwar-factionname").children(".faction-"+e).text(r.name),C(".ttwar-factiontag").children(".faction-"+e).text(r.tag),C(".ttwar-factionresp").children(".faction-"+e).text(ut(r.respect)),C(".ttwar-hospitalcount").children(".faction-"+e).text(r.hospital_count)})}),C("[class*='ttwar'][style*='none']").attr("style","overflow:hidden"),C(this).attr("disabled","true")})}),C("#bwm-revive").click(function(){C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="bwm_revive_container" style="width: inherit">
                            <div id="bwm_revive_header" style="margin:10px 0px; border:1px solid darkgray; text-align:center;">
                                    <input type="text" id="faction-input-id" name="faction-input-id" placeholder="多个帮派ID可以使用逗号分隔" size="30" style="font-size: larger; padding: 5px; margin: 5px;" />
                                    <button id="revive-start-btn" class="torn-btn" style="margin:5px;">开始复活</button>
                                    <button id="revive-stop-btn" class="torn-btn" style="margin:5px;" disabled>停止复活</button>
                            </div>
                            <div id="bwm_revive_filter" style="margin:10px 0px; border:1px solid darkgray; text-align:center; overflow: hidden;">
                                <div style="display: inline; margin:0px 15px;">
                                    <span>每次刷新间隔</span>
                                    <select id="bwm_revive_delay" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="1" selected>1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                    </select>
                                    <span>秒</span>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示Online</span>
                                    <select id="bwm_revive_online_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false" selected>否</option>
                                        <option value="true">是</option>
                                    </select>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示Hospitalized</span>
                                    <select id="bwm_revive_hosp_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false" selected>否</option>
                                        <option value="true">是</option>
                                    </select>
                                </div>
                                <div style="display: inline; margin:0px 15px;">
                                    <span>只显示在城内</span>
                                    <select id="bwm_revive_town_only" style="padding:1px 0px;margin:8px 3px;">
                                        <option value="false">否</option>
                                        <option value="true" selected>是</option>
                                    </select>
                                </div>
                            </div>
                            <div id="bmw_revive_tips" style="text-align:center; margin-bottom: 3px; font-size: 4px;"></div>
                            <div id="bmw_revive_wrapper" style="min-height:700px;margin:10px 0px; border:1px solid darkgray;  text-align:center;overflow:hidden;">
                            </div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",n),C("#bwm-rankedwar").attr("style",l);let d=!0,c=0,u=1;C("#revive-start-btn").click(function(){C("#bmw_revive_wrapper").empty(),C("#revive-start-btn").prop("disabled",!0),C("#revive-stop-btn").removeAttr("disabled"),C("#faction-input-id").prop("disabled",!0),C("#bwm_revive_delay").prop("disabled",!0),C("#bwm_revive_online_only").prop("disabled",!0),C("#bwm_revive_hosp_only").prop("disabled",!0),C("#bwm_revive_town_only").prop("disabled",!0),C("#bmw_revive_tips").text("即将开始刷新......"),d=!0,u=1;const t=C("#faction-input-id").val().trim().split(/,|，/).map(function(t,e,a){return t.trim()}),s=t.length||1;let e=new Array(s).fill(null);const l=1e3*C("#bwm_revive_delay").val();let b="";"true"==C("#bwm_revive_online_only").val()&&(b="Online");let f="";"true"==C("#bwm_revive_hosp_only").val()&&(f="Hospitalized");let m="";"true"==C("#bwm_revive_town_only").val()&&(m="town"),c=setTimeout(()=>{!function e(a,n,i){if(0==d||0==C("#bmw_revive_wrapper").length)C("#bmw_revive_wrapper").children(":last").remove(),C("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:200px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.purple}; color: white;">刷新结束 本次共完成了 ${u-1} 次刷新</div></div>`);else{const g=a[i];let t=0;i<a.length-1&&(t=i+1);const h=n[i];var r=`https://api.torn.com/faction/${g}?selections=basic&key=${x}`;const o=C("#bmw_revive_tips");o.text("---探测中 "+g+"---"),fetch(r).then(t=>t.ok?t.json():void o.text("---探测失败 "+g+"---"),t=>{o.text("---网络异常 "+g+"---")}).then(p=>{console.log(`faction: ${g} | delay: ${l/1e3}s | online: ${C("#bwm_revive_online_only").val()} | hosp: ${C("#bwm_revive_hosp_only").val()} | town: ${C("#bwm_revive_town_only").val()}`),n[i]=p,C("#bmw_revive_wrapper").children(":last").remove(),C.each(p.members,function(t,e){const a=e.last_action.status;let n=qt.yellow;"Online"==a?n=qt.green:"Offline"==a&&(n=qt.gray);var i=M(e.last_action.timestamp),r=e.status.description;const o=e.status.details,s=e.status.state;var l=e.status.until,d=e.status.color;const c=T(r,s,l);var i=`
                                                <div style="overflow: hidden;">
                                                    <div class="border-round" style="float: left; width:80px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.purple}; color: white;">第${u}次刷新</div>
                                                    <div class="border-round" style="float: left; width:35px; padding: 2px 4px; margin: 2px 4px; background-color: ${n}; color: white;">${a}</div>
                                                    <div class="border-round" style="float: left; width:35px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.pink};">
                                                        <a href="/factions.php?step=profile&ID=${g}" style="text-decoration: none; color: white;" target="_blank">${p.tag}</a>
                                                    </div>                       
                                                    <div class="border-round" style="float: left; width:90px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.blue};">
                                                        <a href="/profiles.php?XID=${t}" style="text-decoration: none; color: white;" target="_blank">${e.name}</a>
                                                    </div>                        
                                                    <div class="border-round" style="float: left; width:100px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.green}; color: white;">上次在线 ${i[1]}</div>                     
                                                    <div class="border-round" style="float: left; width:100px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.red}; color: white;">入院时间 ${c[0]}</div>                     
                                                    <div class="border-round" style="float: left; width:300px; padding: 2px 4px; margin: 2px 4px; color:#ccc;background-color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${o}</div>
                                                </div>`;0==s.indexOf("Hospital")&&(0!=a.indexOf(b)||0!=o.indexOf(f)||0!=c[2].indexOf(m)||null!=h&&h.members[t].status.until==l||C("#bmw_revive_wrapper").append(i))}),u+=1,C("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:80px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.purple}; color: white;">第${u}次刷新</div></div>`),c=setTimeout(()=>{e(a,n,t)},l*s)}).catch(t=>console.log("fetch error",t))}}(t,e,0)},l*s)}),C("#revive-stop-btn").click(function(){d=!1,clearTimeout(c),C("#revive-stop-btn").prop("disabled",!0),setTimeout(()=>{C("#revive-start-btn").removeAttr("disabled"),C("#faction-input-id").removeAttr("disabled"),C("#bwm_revive_delay").removeAttr("disabled"),C("#bwm_revive_online_only").removeAttr("disabled"),C("#bwm_revive_hosp_only").removeAttr("disabled"),C("#bwm_revive_town_only").removeAttr("disabled"),C("#bmw_revive_wrapper").children(":last").remove(),C("#bmw_revive_wrapper").append(`<div style="overflow: hidden;"><div class="border-round" style="float: left; width:200px; padding: 2px 4px; margin: 2px 4px; background-color: ${qt.purple}; color: white;">刷新结束 本次共完成了 ${u-1} 次刷新</div></div>`)},1e3)})}),C("#bwm-rankedwar").click(function(){function g(t){t=Math.abs(parseInt((new Date).getTime()/1e3)-t);let e="";return e=86400<=t?parseInt(t/86400)+"天"+parseInt(t%86400/3600)+"小时":3600<=t?parseInt(t/3600)+"小时":60<=t?parseInt(t/60)+"分钟":t+"秒",e}C("#bwm").children(":last").remove(),C("#bwm").append(`
                        <div id="bwm_rw_container" style="width:inherit;">
                            <div id="bwm_rw_header" style="margin: 10px 0px; border: 1px solid darkgray; text-align: center;">
                                <span style="font-size: large;">RANKED WAR</span>
                            </div>
                            <div id="bwm_rw_filter" style="margin:10px 0px; padding: 5px; text-align: center;">
                            </div>
                            <div id="bwm_rw_wrapper" style="margin:10px 0px; text-align: center; overflow: hidden; overflow-x: auto;">
                            </div>
                        </div>`),C("#bwm-version").attr("style",l),C("#bwm-api").attr("style",l),C("#bwm-company").attr("style",l),C("#bwm-faction").attr("style",l),C("#bwm-target").attr("style",l),C("#bwm-mug").attr("style",l),C("#bwm-warroom").attr("style",l),C("#bwm-settings").attr("style",l),C("#bwm-revive").attr("style",l),C("#bwm-rankedwar").attr("style",n),function(){const t=`https://api.torn.com/torn/?selections=rankedwars&key=${x}`,e=C("#bwm_rw_filter");e.text("---探测中---"),fetch(t).then(t=>t.ok?t.json():void e.text("---探测失败---"),t=>{e.text("---网络异常---")}).then(t=>{null!=t&&("error"in t?e.text(`--- API错误 --- code: ${t.error.code} error: ${t.error.error}`):"rankedwars"in t&&(e.text("---探测成功---"),C("#bwm_rw_wrapper").append(`
                                        <table class="rankedwar-records" style="width: 100%; margin: auto;">
                                            <tr class="head">
                                                <th class="war">ID</th>
                                                <th class="team">获胜 / 领先方</th>
                                                <th class="team">分数</th>
                                                <th class="team">分数</th>
                                                <th class="team">失败 / 落后方</th>
                                                <th class="war">分差 / 目标</th>
                                                <th class="war">进度</th>
                                                <th class="war">状态</th>
                                                <th class="war">描述</th>
                                            </tr>
                                        </table>`),C(".rankedwar-records").find("th.war").attr("style","border: 1px solid #333;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),C(".rankedwar-records").find("th.team").attr("style","border: 1px solid #333;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),C.each(t.rankedwars,function(t,e){var a=parseInt((new Date).getTime()/1e3);const n=Object.keys(e.factions),i=e.war.winner;let r=0,o=0,s="",l="",d="";var c=e.factions[n[0]].score,p=e.factions[n[1]].score;o=0<=n.indexOf(i.toString())?(s="已结束",l=`结束于 ${g(e.war.end)}前`,d="over",n[0]==i.toString()?(r=n[0],n[1]):(r=n[1],n[0])):a>=e.war.start?(s="战斗中",l=`战斗已持续${g(e.war.start)}`,d="warring",p<=c?(r=n[0],n[1]):(r=n[1],n[0])):(s="未开始",l=`即将开始于${g(e.war.start)}后`,d="notyet",r=n[0],n[1]);c=Math.abs(c-p),p=parseInt(100*c/e.war.target);C(".rankedwar-records").children().append(`
                                            <tr class="content">
                                                <td class="${d}"><a class="war-id" href="/war.php?step=rankreport&rankID=${t}" target="_blank">${t}</a></td>
                                                <td><a class="faction winning" href="/factions.php?step=profile&ID=${r}" target="_blank">${e.factions[r].name}</a></td>
                                                <td class="${d} score">${ut(e.factions[r].score)}</td>
                                                <td class="${d} score">${ut(e.factions[o].score)}</td>
                                                <td><a class="faction losing" href="/factions.php?step=profile&ID=${o}" target="_blank">${e.factions[o].name}</a></td>
                                                <td class="${d} score">${ut(c)} / ${ut(e.war.target)}</td>
                                                <td class="${d}">${p}%</td>
                                                <td class="${d}">${s}</td>
                                                <td class="${d}">${l}</td>
                                            </tr>
                                            `)}),C(".rankedwar-records").find("td").attr("style","border: 1px solid #333; padding: 5px; text-align: center; color: white; text-decoration: none;"),C(".rankedwar-records").find("a.faction").attr("style","color: white; text-decoration: none;"),C(".rankedwar-records").find("a.war-id").attr("style","color: #333; text-decoration: none;"),C(".rankedwar-records").find("td.over").css("background-color","#FFF5F7").css("color","#333"),C(".rankedwar-records").find("td.warring").css("background-color",qt.yellow),C(".rankedwar-records").find("td.notyet").css("background-color",qt.blue),C(".rankedwar-records").find("a.winning").parent().css("background-color",qt.green),C(".rankedwar-records").find("a.losing").parent().css("background-color",qt.red),C(".rankedwar-records").find("td.score").css("font-size","large")))})}()})}})}{function v(){const c=C("div.profile-buttons div.profile-container div.empty-block");if(0<c.length){c.hasClass("profile-container-description")||c.addClass("profile-container-description"),clearInterval(d),c.css({height:"75","padding-top":"5px","overflow-x":"auto"}),c.siblings(".buttons-wrap").css("padding","0px"),c.html("蛙蛙探测器工作中...");const t=C(".basic-information").find(".info-table").children(":first").children(".user-info-value").children().text();console.log(`user: ${t}`);const e=t?t.split("[")[0].trim():"",a=t?t.split("[")[1].replace("]","").trim():"",n=`/loader.php?sid=attack&user2ID=${a}`;C(".profile-status").children().children(".title-black").empty().append(`
                        <span class="border-round" style="color:white;background-color:#DAA520;padding:3px;text-shadow:none;">
                            <a href="${n}" style="color: white; text-decoration: none;">攻击</a></span>`);const i=Mt(e);i?C(".profile-status").children().children(".title-black").append(`
                        <span class="border-round" style="color:white;background-color:${i[0]};padding:3px;margin-left:5px;">上次唠嗑: ${i[1]}</span>`):console.log("没唠过");const r=Tt(a);if(console.log("mug_display_arr "+r),r){const o=r.split(",")[0],s=r.split(",")[1],l=r.split(",")[2];C(".profile-status").children().children(".title-black").append(`
                        <span class="border-round" style="color:white;background-color:${o};padding:3px;margin-left:5px;">上次mug: ${l} - ${s}</span>`)}else console.log("没mug过");Ot(a,function(t){const e=parseInt(100*t.life.current/t.life.maximum),a=t.life.current+"/"+t.life.maximum+" ("+e+"%)";let n="";n=e<=66?`
                            <div style="height:20px; overflow:hidden;">
                                ${At(20,e,"#c0542f","#FFF5F7",a)}
                            </div>`:(100<e&&(e=100),`
                            <div style="height:20px; overflow:hidden;">
                                ${At(20,e,"#5d9525","#FFF5F7",a)}
                            </div>`),c.html(`
                            <table style="width:100%; background-color: #FFF5F7;">
                                <tr>
                                    <td class="bw-bs">战力</td>
                                    <td colspan="3">${t.estimate_bs_display}</td>
                                    <td class="bw-stat">XAN</td>
                                    <td>${t.personalstats.xantaken||0}</td>
                                    <td class="bw-other">活跃天数</td>
                                    <td>${parseInt(t.estimate_active_days)||0}</td>
                                </tr>
                                <tr>
                                    <td class="bw-bs">血量</td>
                                    <td class="bw-hp" colspan="3">${n}</td>
                                    <td class="bw-stat">LSD</td>
                                    <td>${t.personalstats.lsdtaken||0}</td>
                                    <td class="bw-other">估算WS</td>
                                    <td>${yt(t.estimate_ws)||0}</td>
                                </tr>
                                <tr>
                                    <td class="bw-nw">资产</td>
                                    <td>${yt(t.personalstats.networth)}</td>
                                    <td class="bw-nw">估算NNB</td>
                                    <td>${t.estimate_nnb||10}</td>
                                    <td class="bw-stat">SE</td>
                                    <td>${t.personalstats.statenhancersused||0}</td>
                                    <td colspan="2"><a class="t-blue" role="button" id="a_click_start_wawa" style="cursor: pointer">更多&gt;&gt;</a></td>
                                </tr>
                            </table>
                        `),c.find("td").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;"),c.find(".bw-bs").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #033649;color: white;font-weight: bold;"),c.find(".bw-nw").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #757947;color: white;font-weight: bold;"),c.find(".bw-other").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #725334;color: white;font-weight: bold;"),c.find(".bw-stat").attr("style","border: 2px solid darkgray; padding:2px; text-align:center;background-color: #458994;color: white;font-weight: bold;"),c.find(".bw-hp").attr("style","border: 2px solid darkgray; text-align:center;"),C("div.user-information-section:contains('Last action')").next().children("span").text(t.last_action_details);const i=C("div.profile-buttons.profile-action").html(),r=`
                    <div>
                        <div class="title-black top-round">蛙蛙探测器&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <a class="t-white" role="button" id="a_click_start_wawa_back" style="cursor: pointer">返回</a>
                        </div>
                        <div class="cont bottom-round ">
                            <div class="profile-container basic-info bottom-round">
                                <table style="width:100%; min-height: 320px;">
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">估算战力</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_bs_display}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">Xanax数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.xantaken||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">SE数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.statenhancersused||0}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">攻击胜率</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.attackWinRatio)||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">防守胜率</td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.defendWinRatio)||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">防守胜场</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.defendswon||0}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">能量续满</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.refills||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">LSD数量</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.personalstats.lsdtaken||0}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">DP占比</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.donator_percent)}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">活跃天数</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_active_days}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">日均嗑药</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.average_drugs}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">Booster</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.personalstats.boostersused)}</span></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align:middle"><span class="bold">估算ACE</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_ace}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">估算NNB</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${t.estimate_nnb}</span></td>
                                        <td style="vertical-align:middle"><span class="bold">总资产</span></td>
                                        <td style="vertical-align:middle"><span class="bold">${yt(t.personalstats.networth)}</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>`,o=function(){C("div.profile-buttons.profile-action").html(r),C("div.profile-status").hide(),C("#a_click_start_wawa_back").click(function(){C("div.profile-buttons.profile-action").html(i),C("div.profile-status").show(),C("#a_click_start_wawa").click(o)})};C("#a_click_start_wawa").click(o);let s=0;s+=t.enemies/10,s-=t.friends/20,s+=t.personalstats.moneymugged/2e8,s+=t.personalstats.bountiesreceived/50,s=parseInt(s);let l="",d="";d=s<=0?(l="大善人",qt.yellowgreen):s<=10?(l="好人",qt.blue):s<=100?(l="坏人",qt.yellow):(l="大恶人",qt.red),C("div.basic-information").find("ul.info-table").children("li:eq(9)").children("div.user-info-value").append(`
                    &nbsp;<span class="border-round" style="padding:2px;background-color:${d};color:white;" title="0分及以下：大善人<br>1-10分：好人<br>11-100分：坏人<br>100分以上：大恶人">${l}</span>
                    &nbsp;<span title="每有10个敌人加1分<br>每有20个朋友减1分<br>每mug200m加1分<br>每收到50次悬赏加1分"><b>坏比指数: ${s}</b></span>
                    `)},function(t){c.html(t)})}}0<=window.location.href.indexOf("profiles.php")&&(d=setInterval(v,500))}function w(n,t){let i=!0;if(C("#parade_filter").length<=0){C(n).before('<div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">阅兵</div><div id="parade_filter" class="cont-gray bottom-rounded content" style="overflow:hidden"><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Level" checked="checked">Level</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="BS" checked="checked">BS</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Mugged" checked="checked">Mugged</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rehab" checked="checked">Rehab</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Rank" checked="checked">Rank</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Job" checked="checked">Job</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Networth" checked="checked">Networth</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Bazaar">Bazaar</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Defendslost">Defendslost</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Property">Property</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Elimination">Elimination</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Signup">Signup</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Last" checked="checked">Last</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Status" checked="checked">Status</div><div class="checkbox-wrap" style="margin:5px 10px;"><input type="checkbox" style="margin:1px 5px;" value="Life">Life</div></div><div class="checkboxset-wrap" style="margin:5px 10px; float:left"><div class="input-wrap" style="margin:5px 10px;"><label for="nw">Bazaar价值 大于 </label><input id="parade_bazaar_value" type="text" style="margin:1px 5px; width:50px" value="10">M</div><div class="btn-wrap" style="margin:5px 10px;"><span class="btn"><button id="parade_start" class="torn-btn" style="margin:1px 5px;">开始阅兵</button></span><span class="btn"><button id="parade_stop" class="torn-btn" style="margin:1px 5px;">暂停阅兵</button></span></div></div></div>'),C("#parade_stop").prop("disabled",!0);const a=It("parade_option","checkbox_vals");var e=It("parade_option","text_vals");null!=a&&null!=a&&(C("#parade_bazaar_value").val(e),C("#parade_filter input:checkbox").removeAttr("checked"),C("#parade_filter input:checkbox").each(function(t,e){0<=a.indexOf(C(this).val())&&C(this).attr("checked","checked")}))}C("#parade_start").click(function(){i=!0;let e=C(t).children("li").first();if(e.length<=0)alert("未找到用户列表");else{const g=C("#parade_bazaar_value").val().replace(/[^\d]/g,"");let c=[];C("#parade_filter input:checkbox:checked").each(function(t,e){c.push(C(this).val())}),console.log(c),C("#parade_filter input[type='checkbox']").prop("disabled",!0),C("#parade_filter input[type='text']").prop("disabled",!0),C(this).prop("disabled",!0),C("#parade_stop").removeAttr("disabled"),C("#parade_filter").css("background-color",qt.blue);let t={};if(t.checkbox_vals=c,t.text_vals=g,window.localStorage.setItem("parade_option",JSON.stringify(t)),C("#search_parade_table").length<1){let e='<p id="search_parade_progress">阅兵进度</p><table id="search_parade_table" style="width:100%;background-color: white;font-size:12px;"><tr><th>Name</th>';for(let t=0;t<c.length;t++)e+=`<th>${c[t]}</th>`;e+="<th>Attack</th></tr></table>",C(n).before(e),C("#search_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")}function a(){if("1"==e.attr("detected"))console.log("user detected"),p(0);else{e.attr("detected","1");const d=e.children(".expander").children(".user.name").attr("href").replace(/[^0-9|-]/gi,"");C("#search_parade_progress").text(`正在阅兵：${d}`),Ot(d,function(t){let n="Closed",i=0,r=0;if(t.basicicons.icon35){n="Opened";const e=t.bazaar;null!=e&&e.map(function(t,e,a){i+=t.quantity*t.market_price,r+=t.quantity*t.price})}if("Federal"==t.status.state||"Fallen"==t.status.state)console.log("被封/去世，跳过"),C("#search_parade_progress").text(`阅兵：${d} 被封/去世，跳过`),p(1e3);else if(g&&i<1e6*g)console.log("太穷，跳过"),C("#search_parade_progress").text(`阅兵：${d} 太穷，跳过`),Dt("battlestats",d,t.estimate_bs),p(1e3);else{let e={};e.Level=t.level,e.BS=yt(t.estimate_bs),e.Mugged=yt(t.personalstats.moneymugged),e.Rehab=yt(t.personalstats.rehabcost||0),e.Rank=t.rank_title,e.Networth=yt(t.personalstats.networth),e.Defendslost=t.personalstats.defendslost,e.Property=t.property,e.Signup=t.signup,e.Last=t.last_action_brief,e.Status=t.status.state,e.Elimination=null==t.competition?"":t.competition.team;const l=t.job.company_type;var o,s=t.job.position;0==l?e.Job=s:null!=(o=It("APICache_companies","companies"))&&null!=o?(e.Job=o[l.toString()].name,e.Job+="Director"==s?"(D)":"(E)"):e.Job=l,e.Life=parseInt(t.life.current/t.life.maximum*100)+"%",e.Bazaar='<span class="t-red">Closed</span>',"Opened"==n&&(e.Bazaar=`<a href="/bazaar.php?userId=${d}"><span class="t-green">${yt(i)}</span><span class="t-red">/${yt(r)}</span></a>`);let a=`<tr><td><a class="user name" href="/profiles.php?XID=${d}" target="_blank">${t.name}</a></td>`;for(let t=0;t<c.length;t++)a+=`<td>${e[c[t]]}</td>`;a+=`<td><a class="t-blue c-pointer h attack-act" href="/loader2.php?sid=getInAttack&user2ID=${d}" target="_blank">Attack</a></td></tr>`,console.log(`蛙蛙探测 userId ${d} 成功: ${a}`),C("#search_parade_table").append(a),C("#search_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),Dt("battlestats",d,t.estimate_bs),p(1e3)}},function(t){console.log(`蛙蛙探测 userId: ${d} 失败`),p(1e3)})}}function p(t){e=e.next(),0<e.length&&1==i?(console.log(i),setTimeout(a,t)):(console.log("阅兵完成"),C("#search_parade_progress").text("阅兵完成"),C("#parade_filter input[type='checkbox']").removeAttr("disabled"),C("#parade_filter input[type='text']").removeAttr("disabled"),C("#parade_start").removeAttr("disabled"),C("#parade_stop").prop("disabled",!0),C("#parade_start").text("继续阅兵"),C("#parade_filter").css("background-color","#f2f2f2"))}console.log("阅兵开始"),a()}}),C("#parade_stop").click(function(){i=!1,console.log("阅兵暂停"),C("#search_parade_progress").text("阅兵暂停"),C("#parade_filter input[type='checkbox']").removeAttr("disabled"),C("#parade_filter input[type='text']").removeAttr("disabled"),C("#parade_start").removeAttr("disabled"),C("#parade_filter").css("background-color","#f2f2f2")})}foo&&0<=window.location.href.indexOf("page.php?sid=UserList")&&(w("div.userlist-wrapper","ul.user-info-list-wrap"),setInterval(function(){const t=C(".user-info-list-wrap").find(".user-icons");0<t.length&&t.each(function(){if("1"!=C(this).attr("hasdone")){C(this).attr("hasdone","1");const e=C(this).parent().siblings().children("a.user.name").children().attr("title");if(e){var t=Mt(e.split("[")[0].trim());if(t){const a=C(this).children(".icons-wrap");a.width(a.width()-70),C(this).children(".icons-wrap").after(`
                                        <span class= "border-round" title="<strong>上次唠嗑: </strong>${t[1]}" style="float:left;width:54px;height:18px;padding:2px;margin:0px 3px;background-color:${t[0]};text-align:center;">
                                            <span style="font-size:12px;display:inline-block;vertical-align:middle;color:white;padding:2px;">${t[1]}</span>
                                        </span>`)}}}})},500));{function h(t){const e=t.find("a.faction").attr("href");return e?e.substring(30):0}function v(){const t=C("ul.users-list").children("li");0<t.length&&t.each(function(t,e){if("1"!=C(this).attr("oversea")){const a=h(C(this)),n=C(this).find("a.name").attr("href").substring(18).trim();a in o&&C(this).css("background-color","NavajoWhite"),a in Gt&&C(this).css("background-color","DarkSeaGreen"),n in i&&C(this).css("background-color",qt.purple),C(this).attr("oversea","1")}})}foo&&0<=window.location.href.indexOf("index.php?page=people")&&(w("div.travel-people","ul.users-list"),i={},null!=(it=window.localStorage.getItem("muglog-watchlist"))&&(i=JSON.parse(it)),setInterval(v,1e3))}const te={Mexico:{name:"墨西",time:18},Cayman:{name:"开曼",time:25},Canada:{name:"加拿",time:29},Hawaii:{name:"夏威",time:94},Argentina:{name:"阿根",time:117},United:{name:"英国",time:111},Switzerland:{name:"瑞士",time:123},Japan:{name:"日本",time:158},China:{name:"中国",time:169},UAE:{name:"迪拜",time:190},South:{name:"南非",time:208}};function _(t){return C(t).find("td.table-level").text()}function k(t){return C(t).find("td.table-online").attr("code")}function $(t){return C(t).find("td.table-networth").attr("networth")}function I(t){return C(t).find("td.table-position").text()}function D(t){return C(t).find("td.table-days").text()}function O(t){return C(t).find("td.table-last").attr("last-action-minutes")}function S(t){return C(t).find("td.table-status").attr("hospital-minutes")}function F(t){return C(t).find("td.table-bs").attr("estimate-bs")}function A(t){let e=It("battlestats",t),a="",n="";return null!=e&&null!=e?(a=ut(e),n=yt(e)):e=0,[e,a,n]}function M(t){const e=new Date;t=parseInt(parseInt(e.getTime()/1e3)-t);let a="";return a=60<=t&&t<3600?parseInt(t/60)+"m":3600<=t&&t<86400?parseInt(t/3600)+"h":86400<=t?parseInt(t/86400)+"d":t+"s",[t,a]}function T(n,i,r){let o=0,s="town";const l=new Date;n=n.split(" ");if("Abroad"==i)i="="+te[n[1]].name,o=0-te[n[1]].time;else if("Traveling"==i)1<n.length&&("Traveling"==n[0]?(i=">"+te[n[2]].name,o=0-te[n[2]].time):"Returning"==n[0]&&(i="<"+te[n[4]].name,o=0-te[n[4]].time));else if("Hospital"==i){r=parseInt(r-parseInt(l.getTime()/1e3));let t=parseInt(r/3600);t=t<10?"0"+t:t;let e=parseInt(r%3600/60);e=e<10?"0"+e:e;let a=r%60;a=a<10?"0"+a:a,"hospital"==n[1]?i=t+":"+e+":"+a:(i="海"+t+":"+e+":"+a,s="oversea"),o=r}return[i,o,s]}function N(t){C("li.days").text("Last"),C("li.position").text("BattleStats");let r=200;0<C("li.position").length&&(r=window.getComputedStyle(C("li.position")[0]).width.replace(/px$/g,""),console.log(r));var e=`https://api.torn.com/faction/${t}?selections=basic&key=${x}`;fetch(e).then(t=>t.json()).then(i=>{console.log("facPageEnhanced "+t),C("li.table-row").each(function(){var t=C(C(this).find("[class^=userWrap]")).children().attr("href").substring(18),e=A(t);100<Number(r)?C(C(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[1]):C(C(this).find("div.position")).attr("estimate-bs",e[0]).children(":first").text(e[2]);var a=M(i.members[t].last_action.timestamp);C(C(this).find("div.days")).attr("last-action-minutes",a[0]).text(a[1]);var n=i.members[t].status.state,e=i.members[t].status.description,a=i.members[t].status.until,t=i.members[t].status.color,a=T(e,n,a);C(C(this).find("div.status")).attr("sort_score",a[1]).html(`<span class="t-${t}">${a[0]}</span>`)})}).catch(t=>console.log("fetch error",t))}function z(t,e,a){let n=[0,0,0];var i=It("APICache_companies","companies");function r(t){return t[0]+t[1]<t[2]?2:t[0]>t[1]?0:1}function o(t){return 0<(t[0]-t[1])*(t[1]-t[2])?1:0<(t[0]-t[2])*(t[2]-t[1])?2:0}function s(t,e){return e/t<=1?e/t:1+(e-t)/t*.5}function l(t,e){return 0==t?"":e/t<1?"eff-red":e/t<2?"eff-yellow":"eff-green"}"unassigned"!=e&&null!=i&&null!=i&&(c=i[t].positions[e].man_required,p=i[t].positions[e].int_required,g=i[t].positions[e].end_required,n=[c,p,g]);var d,e=n[r(n)],c=a[r(n)],p=n[o(n)],g=a[o(n)];const h=.67*s(e,c)+.33*s(p,g),b=(d=h)<1?"eff-red":d<1.5?"eff-yellow":"eff-green",f=l(n[0],a[0]),m=l(n[1],a[1]),u=l(n[2],a[2]);p=Math.floor(Math.min(45,c/e*45*1.225)+Math.floor(Math.min(45,g/p*45*1.225)+Math.floor(Math.max(0,5*Math.log2(1.225*c/e)))+Math.floor(Math.max(0,5*Math.log2(1.225*g/p)))));return[h,b,f,m,u].concat(n).concat(p)}function P(t){let e=0;t=It("EMPLOYEE_RANK",t);return null!=t&&null!=t&&(e=t),e}function E(t){var e=`https://api.torn.com/company/?selections=profile,employees&key=${x}`;const a=C("#tips-view-company");a.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void a.text("---探测失败---"),t=>{a.text("---网络异常---")}).then(c=>{if(a.text("---探测完成---"),"error"in c)a.text(`---错误代码：${c.error.code} 错误：${c.error.error}---`);else if("company_employees"in c){C("#companyname").text(c.company.name),t.prepend(`
                        <table class="company-effectiveness" style="background-color: #FFF5F7;font-size:12px;margin:auto;">
                            <tr class="head">
                                <th class="employee-basic table-position">岗位</th>
                                <th class="employee-basic table-days">天</th>
                                <th class="employee-ws table-man">MAN</th>
                                <th class="employee-ws table-int">INT</th>
                                <th class="employee-ws table-end">END</th>
                                <th class="employee-effectiveness table-ws" title="Working Stats">属</th>
                                <th class="employee-effectiveness table-ep" title="Effectiveness Prediction">估</th>
                                <th class="employee-basic table-last">登</th>
                                <th class="employee-basic table-username">名字</th>
                                <th class="employee-effectiveness table-settled" title="Settled In">天</th>
                                <th class="employee-effectiveness table-merits" title="Merits">点</th>
                                <th class="employee-effectiveness table-education" title="Director Education">课</th>
                                <th class="employee-effectiveness table-management" title="Management">理</th>
                                <th class="employee-effectiveness table-addiction" title="Addiction">药</th>
                                <th class="employee-effectiveness table-total" title="Total">总</th>
                                <th class="employee-status table-tornstats">参</th>
                            </tr>
                        </table>`);const p=t.children(".company-effectiveness");p.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),p.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;");let a=[];C.each(c.company_employees,function(t,e){e.userid=t,e.position_rank=P(t),a.push(e)}),a.sort(function(t,e){return t.position_rank-e.position_rank});const g={0:"",1:"eff-yellow",3:"eff-red"};C.each(a,function(t,e){var a=M(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,i=e.effectiveness.addiction||0,r=i<=-10?3:i<=-5?1:0,o=e.effectiveness.merits||0,s=o<=2?3:o<=4?1:0,l=n+r+s,d=3<=l?3:1<=l?1:0,l=z(c.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]);p.children().append(`
                            <tr class="content">
                                <td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
                                <td class="table-days">${e.days_in_company}</td>
                                <td class="table-man tright ${l[2]}" man="${e.manual_labor}" title="MAN Required: ${ut(l[5])}">${tt(e.manual_labor)}</td>
                                <td class="table-int tright ${l[3]}" int="${e.intelligence}" title="INT Required: ${ut(l[6])}">${tt(e.intelligence)}</td>
                                <td class="table-end tright ${l[4]}" end="${e.endurance}" title="END Required: ${ut(l[7])}">${tt(e.endurance)}</td>
                                <td class="table-ws">${e.effectiveness.working_stats||0}</td>
                                <td class="table-ep">${l[8]}</td>
                                <td class="table-last ${g[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
                                <td class="table-username ${g[d]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
                                <td class="table-settled">${e.effectiveness.settled_in||0}</td>
                                <td class="table-merits ${g[s]}">${o}</td>
                                <td class="table-education">${e.effectiveness.director_education||0}</td>
                                <td class="table-management">${e.effectiveness.management||0}</td>
                                <td class="table-addiction ${g[r]}">${i}</td>
                                <td class="table-total"><b>${e.effectiveness.total||0}</b></td>
                                <td class="table-tornstats tright ${l[1]}" effectiveness="${l[0]}"><span>${(100*l[0]).toFixed(0)}%</span></td>
                            </tr>`)}),p.find("th").css("cursor","pointer"),p.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),p.find("td.tright").css("text-align","right"),p.find("td.tleft").css("text-align","left"),p.find("td.eff-green").css("background-color","#D0E9C6"),p.find("td.eff-yellow").css("background-color","#FAF2CC"),p.find("td.eff-red").css("background-color","#EBCCCC"),Ft(p.find("th.table-position"),R),Ft(p.find("th.table-days"),W),Ft(p.find("th.table-man"),B),Ft(p.find("th.table-int"),L),Ft(p.find("th.table-end"),G),Ft(p.find("th.table-ws"),q),Ft(p.find("th.table-settled"),H),Ft(p.find("th.table-merits"),X),Ft(p.find("th.table-education"),J),Ft(p.find("th.table-management"),U),Ft(p.find("th.table-addiction"),K),Ft(p.find("th.table-total"),Y),Ft(p.find("th.table-last"),O),Ft(p.find("th.table-tornstats"),Q)}}).catch(t=>console.log("fetch error",t))}function j(k){let $=$t("company-history-items"),I=0;$&&(I=Object.keys($).length);const t=new Date,D=new Date(new Date(t.setDate(t.getDate()-1)).setHours(t.getHours()-2)).format("yyyy-MM-dd"),S=It("company-history-items",D);const F=It("company-history-items",new Date(t.setDate(t.getDate()-1)).format("yyyy-MM-dd"));if(null===k){if(I<=0)return void console.log("没有历史数据，跳过自动获取公司产量数据");if(S)return void console.log("本次产量数据已存过，跳过自动获取公司产量数据");console.log("本次产量数据还没存过，将自动获取公司产量数据")}var e=`https://api.torn.com/company/?selections=profile,employees,stock,detailed&key=${x}`;const A=C("#tips-view-company");A.text("---探测中---"),fetch(e).then(t=>t.ok?t.json():void A.text("---探测失败---"),t=>{A.text("---网络异常---")}).then(h=>{if(console.log(h),k){if(null!=h.error&&7==h.error.code)throw A.text("---员工无权限查看---"),new Error("not a director");null!=h&&A.text("---探测完成---"),C("#companyname").text(h.company.name),k.append(`
                        <table class="company-effectiveness" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                            <tr class="head">
                                <th class="employee-basic table-position">岗位</th>
                                <th class="employee-basic table-days">天</th>
                                <th class="employee-ws table-man">MAN</th>
                                <th class="employee-ws table-int">INT</th>
                                <th class="employee-ws table-end">END</th>
                                <th class="employee-effectiveness table-ws" title="Working Stats">属</th>
                                <th class="employee-effectiveness table-ep" title="Effectiveness Prediction">估</th>
                                <th class="employee-basic table-last">登</th>
                                <th class="employee-basic table-username">名字</th>
                                <th class="employee-effectiveness table-settled" title="Settled In">天</th>
                                <th class="employee-effectiveness table-merits" title="Merits">点</th>
                                <th class="employee-effectiveness table-education" title="Director Education">课</th>
                                <th class="employee-effectiveness table-management" title="Management">理</th>
                                <th class="employee-effectiveness table-addiction" title="Addiction">药</th>
                                <th class="employee-effectiveness table-inactivity" title="Inactivity">离</th>
                                <th class="employee-effectiveness table-total" title="Total">总</th>
                                <th class="employee-effectiveness table-wage" title="Wage">薪</th>
                                <th class="employee-status table-tornstats">参</th>
                            </tr>
                        </table><br /><br />
                        <table class="company-history" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                            <tr class="head">
                                <th colspan=2>生产日期</th>
                                <th>收入</th>
                                <th>工资</th>
                                <th>广告费</th>
                                <th>利润</th>
                                <th>总效率</th>
                                <th>产量</th>
                                <th>销量</th>
                                <th>库存</th>
                                <th>单价</th>
                                <th>成本</th>
                                <th>记录时间</th>
                            </tr>
                        </table>`);const u=k.find(".company-effectiveness");u.find("th.employee-basic").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-ws").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-effectiveness").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #757947;color: white;font-weight: bold;text-align:center;"),u.find("th.employee-status").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #725334;color: white;font-weight: bold;text-align:center;")}let a='<br /><table class="company-stock" style="width:100%;background-color: #FFF5F7;font-size:12px;"><tr class="head"><th>库存种类</th>';C.each(h.company_stock,function(t,e){a+=`<th>${t}</th>`}),a+='</tr><tr class="content"><td class="stock-title">SOLD WORTH</td>',C.each(h.company_stock,function(t,e){a+=`<td class="stock-content">${ut(e.sold_worth)}</td>`}),a+='</tr><tr class="content"><td class="stock-title">SOLD AMOUNT</td>',C.each(h.company_stock,function(t,e){a+=`<td class="stock-content">${ut(e.sold_amount)}</td>`}),a+="</tr></table>",C(".company-effectiveness").after(a),C(".company-stock").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),C(".company-stock").find("td.stock-content").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),C(".company-stock").find("td.stock-title").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #458994;color: white;font-weight: bold;text-align:center;");let n=[];C.each(h.company_employees,function(t,e){e.userid=t,e.position_rank=P(t),n.push(e)}),n.sort(function(t,e){return t.position_rank-e.position_rank});const b={0:"",1:"eff-yellow",3:"eff-red"};let f=0,m=0;C.each(n,function(t,e){if(f+=e.wage||0,m+=e.effectiveness.total||0,null===k)return!0;var a=M(e.last_action.timestamp),n=172800<=a[0]?3:86400<=a[0]?1:0,i=e.effectiveness.addiction||0,r=i<=-10?3:i<=-5?1:0,o=e.effectiveness.inactivity||0,s=o<0?3:0,l=e.effectiveness.merits||0,d=l<=2?3:l<=4?1:0,c=n+r+d,p=3<=c?3:1<=c?1:0,c=z(h.company.company_type,e.position,[e.manual_labor,e.intelligence,e.endurance]),c=`
                        <tr class="content">
                            <td class="table-position tleft" position-value="${e.position_rank}">${e.position}</td>
                            <td class="table-days">${e.days_in_company}</td>
                            <td class="table-man tright ${c[2]}" man="${e.manual_labor}" title="MAN Required: ${ut(c[5])}">${tt(e.manual_labor)}</td>
                            <td class="table-int tright ${c[3]}" int="${e.intelligence}" title="INT Required: ${ut(c[6])}">${tt(e.intelligence)}</td>
                            <td class="table-end tright ${c[4]}" end="${e.endurance}" title="END Required: ${ut(c[7])}">${tt(e.endurance)}</td>
                            <td class="table-ws">${e.effectiveness.working_stats||0}</td>
                            <td class="table-ep">${c[8]}</td>
                            <td class="table-last ${b[n]}" last-action-minutes="${a[0]}">${a[1]}</td>
                            <td class="table-username ${b[p]}"><a class="user name" href="/profiles.php?XID=${e.userid}" target="_blank">${e.name}</a></td>
                            <td class="table-settled">${e.effectiveness.settled_in||0}</td>
                            <td class="table-merits ${b[d]}">${l}</td>
                            <td class="table-education">${e.effectiveness.director_education||0}</td>
                            <td class="table-management">${e.effectiveness.management||0}</td>
                            <td class="table-addiction ${b[r]}">${i}</td>
                            <td class="table-inactivity ${b[s]}">${o}</td>
                            <td class="table-total"><b>${e.effectiveness.total||0}</b></td>
                            <td class="table-wage" wage="${e.wage}"><b>$${ut(e.wage||0)}</b></td>
                            <td class="table-tornstats tright ${c[1]}" effectiveness="${c[0]}"><span>${(100*c[0]).toFixed(0)}%</span></td>
                        </tr>`;const g=k.find(".company-effectiveness");g.children().append(c)});var t=parseInt(h.company.daily_income||0),e=parseInt(h.company_detailed.advertising_budget||0);let i=0,r=0,o=0,s=0,l=0,d="";C.each(h.company_stock,function(t,e){i+=e.sold_amount*e.cost,r+=e.sold_amount,o+=e.in_stock,s+=e.sold_worth,d+=`${t} $${e.price} `}),0<r&&(l=parseInt(s/r));let c=o;F?(console.log("有上一次的产量数据"),console.log(F),c=F.Stock||o):console.log("没有上一次的产量数据，本次的产量将设置为与销量相等");var p=o+r-c,g=t-f-e-i,p={Date:D,Income:t,Wages:f,Ad:e,Profit:g,Effectiveness:m,Produced:p,Sold:r,Stock:o,Price:l,Cost:i,RecordTime:(new Date).format("MM-dd hh:mm:ss")};if(console.log(p),S?console.log("本次产量数据已存过，不再覆盖"):(console.log("本次产量数据未保存，现在保存"),Dt("company-history-items",D,p),$=$t("company-history-items")),console.log($),null===k)return!0;const u=k.find(".company-effectiveness");u.find("th").css("cursor","pointer"),u.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),u.find("td.tright").css("text-align","right"),u.find("td.tleft").css("text-align","left"),u.find("td.eff-green").css("background-color","#D0E9C6"),u.find("td.eff-yellow").css("background-color","#FAF2CC"),u.find("td.eff-red").css("background-color","#EBCCCC"),Ft(u.find("th.table-position"),R),Ft(u.find("th.table-days"),W),Ft(u.find("th.table-man"),B),Ft(u.find("th.table-int"),L),Ft(u.find("th.table-end"),G),Ft(u.find("th.table-ws"),q),Ft(u.find("th.table-si"),H),Ft(u.find("th.table-me"),X),Ft(u.find("th.table-de"),J),Ft(u.find("th.table-ma"),U),Ft(u.find("th.table-ad"),K),Ft(u.find("th.table-ia"),V),Ft(u.find("th.table-to"),Y),Ft(u.find("th.table-wg"),Z),Ft(u.find("th.table-last"),O),Ft(u.find("th.table-tornstats"),Q),u.after(`<br /><b>实时人数：${Object.keys(h.company_employees).length}，总工资：$${ut(p.Wages)}，广告费：$${ut(p.Ad)}，周销售：$${ut(h.company.weekly_income)}，单价：${d}</b><br />`);let x={Income:0,Wages:0,Ad:0,Profit:0,Effectiveness:0,Produced:0,Sold:0,Stock:0,Price:0,Cost:0};const y=k.find(".company-history");let v=0,w=0,_=0;C.each($,function(t,e){var a=parseInt(((new Date).getTime()-new Date(t).getTime())/864e5);if(31<a)return console.log(`删除过期数据：${t}`),St("company-history-items",t),delete $[t],!0;_++;t=`
                        <tr class="content">
                            <td>${_}</td>
                            <td>${t}</td>
                            <td>$${ut(e.Income)}</td>
                            <td>$${ut(e.Wages)}</td>
                            <td>$${ut(e.Ad)}</td>
                            <td>$${ut(e.Profit)}</td>
                            <td>${ut(e.Effectiveness)}</td>
                            <td>${ut(e.Produced)}</td>
                            <td>${ut(e.Sold)}</td>
                            <td>${ut(e.Stock)}</td>
                            <td>$${ut(e.Price)}</td>
                            <td>$${ut(e.Cost)}</td>
                            <td>${e.RecordTime||"-"}</td>
                        </tr>`;y.children().append(t),x.Income+=parseInt(e.Income),x.Wages+=parseInt(e.Wages),x.Ad+=parseInt(e.Ad),x.Profit+=parseInt(e.Profit),x.Effectiveness+=parseInt(e.Effectiveness),x.Produced+=parseInt(e.Produced),x.Sold+=parseInt(e.Sold),x.Stock+=parseInt(e.Stock),x.Price+=parseInt(e.Price),x.Cost+=parseInt(e.Cost||0),a<=7&&(v+=parseInt(e.Profit),w++)}),I=Object.keys($).length;p=`
                    <tr class="content">
                        <td colspan=2><b>平均值</b></td>
                        <td>$${ut((x.Income/I).toFixed(0))}</td>
                        <td>$${ut((x.Wages/I).toFixed(0))}</td>
                        <td>$${ut((x.Ad/I).toFixed(0))}</td>
                        <td>$${ut((x.Profit/I).toFixed(0))}</td>
                        <td>${ut((x.Effectiveness/I).toFixed(0))}</td>
                        <td>${ut((x.Produced/I).toFixed(0))}</td>
                        <td>${ut((x.Sold/I).toFixed(0))}</td>
                        <td>${ut((x.Stock/I).toFixed(0))}</td>
                        <td>$${ut((x.Price/I).toFixed(0))}</td>
                        <td>$${ut((x.Cost/I).toFixed(0))}</td>
                        <td>${(new Date).format("MM-dd hh:mm:ss")}</td>
                    </tr>`;y.children().append(p),y.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),y.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),y.after(`<br /><b>共 ${I} 天数据，总利润：$${ut(x.Profit)}，近一周(${w}天)利润：$${ut(v)}</b>`)}).catch(t=>console.log("fetch error: ",t.message))}function R(t){return C(t).find("td.table-position").attr("position-value")}function W(t){return C(t).find("td.table-days").text()}function B(t){return C(t).find("td.table-man").attr("man")}function L(t){return C(t).find("td.table-int").attr("int")}function G(t){return C(t).find("td.table-end").attr("end")}function q(t){return C(t).find("td.table-ws").text()}function H(t){return C(t).find("td.table-settled").text()}function X(t){return C(t).find("td.table-merits").text()}function J(t){return C(t).find("td.table-education").text()}function U(t){return C(t).find("td.table-management").text()}function K(t){return C(t).find("td.table-addiction").text()}function V(t){return C(t).find("td.table-inactivity").text()}function Y(t){return C(t).find("td.table-total").text()}function Z(t){return C(t).find("td.table-wage").attr("wage")}function Q(t){return C(t).find("td.table-tornstats").attr("effectiveness")}function tt(t){return t<1e4?t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}):parseInt(t/1e3)+"k"}function et(n){return new Promise((e,a)=>{var t=`https://api.torn.com/user/${n}?selections=profile&key=${x}`;fetch(t).then(t=>t.ok?t.json():void console.log("---探测失败 "+n+"---"),t=>{console.log("---网络异常 "+n+"---")}).then(t=>{null!=t?"error"in t?a(t.error):(console.log(`userId2otherIds: ${n} => (${t.faction.faction_id} - ${t.faction.position}) (${t.job.company_id} - ${t.job.position})`),e([t.faction.faction_id,t.faction.position,t.job.company_id,t.job.position])):a()}).catch(t=>a(t))})}function at(r){return new Promise((e,n)=>{const i=C("#mainContainer").find("div:contains('unavailable')").last();i.text("蛙蛙探测器工作中...");var t=`https://api.torn.com/faction/${r}?selections=basic,chain&key=${x}`;fetch(t).then(t=>t.ok?t.json():void i.text("---探测失败 "+r+"---"),t=>{i.text("---网络异常 "+r+"---")}).then(t=>{if(null!=t)if("error"in t)n(t.error);else{C("#skip-to-content").text(`帮派: ${t.name}`),i.html(`<b>声望:</b> ${ut(t.respect)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${ut(t.age)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最大连击:</b> ${ut(t.best_chain)}&nbsp;&nbsp;&nbsp;&nbsp;<b>成员数:</b> ${Object.keys(t.members).length}`),0<t.chain.current&&i.append(`</br /></br /><b>正在连击:</b> ${ut(t.chain.current)}/${ut(t.chain.max)}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*t.chain.start).format("yyyy-MM-dd hh:mm:ss")}&nbsp;&nbsp;&nbsp;&nbsp;<b>连击超时:</b> ${t.chain.timeout}(秒)&nbsp;&nbsp;&nbsp;&nbsp;<b>声望系数:</b> ${t.chain.modifier}&nbsp;&nbsp;&nbsp;&nbsp;<b>冷却时间:</b> ${t.chain.cooldown}`),t.territory_wars&&0<Object.keys(t.territory_wars).length&&(i.append("</br />"),C.each(t.territory_wars,function(t,e){e.assaulting_faction==r?i.append(`</br /><b>正在进攻地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>防守方:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):i.append(`</br /><b>正在防守地盘:</b> ${e.territory}&nbsp;&nbsp;&nbsp;&nbsp;<b>进攻方:</b> <a href='/factions.php?step=profile&ID=${e.assaulting_faction}' target='_blank'>${e.assaulting_faction}</a>`),i.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>推墙进度:</b> ${ut(e.score)}/${ut(e.required_score)}&nbsp;&nbsp;&nbsp;&nbsp;<b>最迟结束时间:</b> ${new Date(1e3*e.end_time).format("yyyy-MM-dd hh:mm:ss")}`)})),t.peace&&0<Object.keys(t.peace).length&&(i.append("</br />"),C.each(t.peace,function(t,e){i.append(`</br /><b>和平条约:</b> <a href='/factions.php?step=profile&ID=${t}' target='_blank'>${t}</a>&nbsp;&nbsp;&nbsp;&nbsp;<b>到期时间:</b> ${new Date(1e3*e).format("yyyy-MM-dd hh:mm:ss")}`)})),t.raid_wars&&0<Object.keys(t.raid_wars).length&&(i.append("</br />"),C.each(t.raid_wars,function(t,e){e.raiding_faction==r?i.append(`</br /><b>正在突击:</b> <a href='/factions.php?step=profile&ID=${e.defending_faction}' target='_blank'>${e.defending_faction}</a>`):i.append(`</br /><b>正在被</b> <a href='/factions.php?step=profile&ID=${e.raiding_faction}' target='_blank'>${e.raiding_faction}</a> 突击`),i.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>突击进度(攻/守):</b> ${e.raider_score}/${e.defender_score}&nbsp;&nbsp;&nbsp;&nbsp;<b>开始时间:</b> ${new Date(1e3*e.start_time).format("yyyy-MM-dd hh:mm:ss")}`)})),C(".content-wrapper").last().append(`
                            <table id="faction-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                                <tr class="head">
                                    <th>名字</th>
                                    <th>天数</th>
                                    <th>上次活动</th>
                                    <th>状态</th>
                                    <th>角色</th>
                                </tr>
                            </table>`);const a=C("#faction-members");C.each(t.members,function(t,e){e=`
                                <tr class="content">
                                    <td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
                                    <td>${e.days_in_faction}</td>
                                    <td>${e.last_action.relative}</td>
                                    <td>${e.status.description}</td>
                                    <td>${e.position}</td>
                                </tr>`;a.children().append(e)}),a.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),a.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),e()}else n()}).catch(t=>i.text(t))})}function nt(a){return new Promise((t,i)=>{const r=C("#mainContainer").find("div:contains('unavailable')").last();r.text("蛙蛙探测器工作中...");var e=`https://api.torn.com/company/${a}?selections=profile&key=${x}`;fetch(e).then(t=>t.ok?t.json():void r.text("---探测失败 "+a+"---"),t=>{r.text("---网络异常 "+a+"---")}).then(e=>{if(null!=e)if("error"in e)i(e.error);else{var a,t={1:"Hair Salon",2:"Law Firm",3:"Flower Shop",4:"Car Dealership",5:"Clothing Store",6:"Gun Shop",7:"Game Shop",8:"Candle Shop",9:"Toy Shop",10:"Adult Novelties",11:"Cyber Cafe",12:"Grocery Store",13:"Theater",14:"Sweet Shop",15:"Cruise Line",16:"Television Network",18:"Zoo",19:"Firework Stand",20:"Property Broker",21:"Furniture Store",22:"Gas Station",23:"Music Store",24:"Nightclub",25:"Pub",26:"Gents Strip Club",27:"Restaurant",28:"Oil Rig",29:"Fitness Center",30:"Mechanic Shop",31:"Amusement Park",32:"Lingerie Store",33:"Meat Warehouse",34:"Farm",35:"Software Corporation",36:"Ladies Strip Club",37:"Private Security Firm",38:"Mining Corporation",39:"Detective Agency",40:"Logistics Management"};if(C("#skip-to-content").html(`公司: ${e.company.name}`),r.html(`<b>类型:</b> ${t[e.company.company_type]}&nbsp;&nbsp;&nbsp;&nbsp;<b>星级:</b> ${e.company.rating}&nbsp;&nbsp;&nbsp;&nbsp;<b>员工数:</b> ${e.company.employees_hired}/${e.company.employees_capacity}&nbsp;&nbsp;&nbsp;&nbsp;<b>日销售:</b> $${ut(e.company.daily_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>周销售:</b> $${ut(e.company.weekly_income)}&nbsp;&nbsp;&nbsp;&nbsp;<b>天数:</b> ${ut(e.company.days_old)}`),28==e.company.company_type){r.append("&nbsp;&nbsp;&nbsp;&nbsp;<b>估算单价x销量:</b>");for(let t=200;120<=t;--t)e.company.daily_income%t==0&&(a=parseInt(e.company.daily_income/t),r.append(` ${t}x${ut(a)}`))}else 16==e.company.company_type&&(t=parseInt(e.company.daily_income/e.company.daily_customers),r.append(`&nbsp;&nbsp;&nbsp;&nbsp;<b>单价x销量:</b> ${ut(t)}x${ut(e.company.daily_customers)}`));C(".content-wrapper").last().append(`
                                <table id="company-members" style="width:100%;background-color: #FFF5F7;font-size:12px;">
                                    <tr class="head">
                                        <th>名字</th>
                                        <th>天数</th>
                                        <th>上次活动</th>
                                        <th>状态</th>
                                        <th>职位</th>
                                    </tr>
                            </table>`);const n=C("#company-members");C.each(e.company.employees,function(t,e){e=`
                                <tr class="content">
                                    <td><a href='/profiles.php?XID=${t}' target='_blank'>${e.name}</a></td>
                                    <td>${e.days_in_company}</td>
                                    <td>${e.last_action.relative}</td>
                                    <td>${e.status.description}</td>
                                    <td>${e.position}</td>
                                </tr>`;n.children().append(e)}),n.find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: #033649;color: white;font-weight: bold;text-align:center;"),n.find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;")}else i()}).catch(t=>r.text(t))})}if(0<=window.location.href.indexOf("factions.php?step=your")){const ee=C("[href^='/forums.php#!p=forums&f=999&b=1&a=']").attr("href");var it=0;if(null!=ee&&(it=ee.substring(34),window.localStorage.setItem("MY_FACTION_ID",it)),foo){let e=setInterval(rt,1e3),a=0;function rt(){if(console.log("faction other"),0<=window.location.href.indexOf("factions.php?step=your#/tab=info")&&0<C("li.position").length){clearInterval(e),a=setInterval(ot,1e3),console.log("li position"),w("div.f-war-list","ul.table-body");const t=C("div[data-faction]").attr("data-faction");N(t)}}function ot(){console.log("faction info"),window.location.href.indexOf("factions.php?step=your#/tab=info")<0&&(clearInterval(a),e=setInterval(rt,1e3))}}}if(0<=window.location.href.indexOf("factions.php?step=profile&"))if(0<C("#mainContainer").find("div:contains('unavailable')").last().length)if(0<=window.location.href.indexOf("profile&ID=")){const fID=/profile&ID=(\d+)/.exec(window.location.href)[1];console.log("fID "+fID),at(fID).catch(t=>console.log("factionPageRedraw "+t))}else 0<=window.location.href.indexOf("profile&userID=")&&(n=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+n),et(n).then(function(t){console.log(t),at(t[0]).catch(t=>console.log("factionPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));else{function rt(){if(0<C("li.position").length){clearInterval(a),console.log("li position"),w("div.f-war-list","ul.table-body");const t=C("div[data-faction]").attr("data-faction");N(t)}}foo&&(a=setInterval(rt,1e3))}if(0<=window.location.href.indexOf("p=corpinfo&"))if(0<C("#mainContainer").find("div:contains('unavailable')").last().length)if(0<=window.location.href.indexOf("corpinfo&ID=")){const ae=/corpinfo&ID=(\d+)/.exec(window.location.href)[1];console.log("companyID "+ae),new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t()},2e3)}).then(function(){nt(ae).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("companyPageRedraw "+t))}else 0<=window.location.href.indexOf("corpinfo&userID=")&&(n=/userID=(\d+)/.exec(window.location.href)[1],console.log("userId "+n),et(n).then(function(a){return new Promise(function(t,e){setTimeout(function(){console.log("2 Seconds"),t(a)},2e3)})}).then(function(t){console.log(t),nt(t[2]).catch(t=>console.log("companyPageRedraw "+t))}).catch(t=>console.log("userId2otherIds "+t)));else{var st=setInterval(v,500);function v(){if(0<=C("div.company-details").children("div.title-black").text().indexOf("Oil Rig")){clearInterval(st);const e=C("div.company-details").find("li:contains('Daily income')").text().replace(/[^\d]/g,"");for(let t=250;120<=t;--t)if(e%t==0){const a=parseInt(e/t);C("div.company-details").children("div.title-black").append(`<span class="m-hide"> - 估算单价: ${t}，估算销量: ${ut(a)} </span>`)}}}}if(bounty_parade&&window.location.href.indexOf("bounties.php#!p=main")&&setInterval(function(){const t=C("ul.bounties-list").children(),e=t.first();e.length<=0?C("div.bounties-total").text("未找到用户列表"):"1"==e.attr("detected")||(C("div.bounties-total").text("阅兵开始"),setTimeout(()=>{!function e(a){a.attr("detected","1");const n=a.find("div.status");if(0<n.children(".t-red").length)C("div.bounties-total").text("本条已阅兵完毕"),setTimeout(()=>{e(a.next())},0);else if(null==a.attr("data-id"))C("div.bounties-total").text("本页阅兵结束");else{const i=a.find("div.target").children("a"),r=i.attr("href").replace(/[^0-9]/gi,"");var t=i.text();C("div.bounties-total").text("正在阅兵: "+r+" "+t),Ot(r,function(t){n.children(".t-green").text(yt(t.estimate_bs)),Dt("battlestats",r,t.estimate_bs),setTimeout(()=>{e(a.next())},0)},function(t){C("div.bounties-total").text("蛙蛙探测 "+r+" 失败 "+t),setTimeout(()=>{e(a.next())},0)})}}(e)},0))},2e3),mugoo&&0<=window.location.href.indexOf("imarket.php")){let d=window.location.href,c=setInterval(v,500),b=0;var lt=["Donator Pack","Xanax","Erotic DVD","Drug Pack","Feathery Hotel Coupon","Anti Tank","Large Suitcase","Wind Proof Lighter","Six Pack of Energy Drink","Sierra Cosworth"],dt=["Tribulus Omanense","Peony","African Violet","Cherry Blossom","Heather","Ceibo Flower","Edelweiss"],ct=["Camel Plushie","Lion Plushie","Panda Plushie","Monkey Plushie","Chamois Plushie","Red Fox Plushie","Nessie Plushie"],pt=["Can of X-MASS","Can of Taurine Elite","Can of Rockstar Rudolph","Can of Red Cow","Can of Munster","Can of Santa Shooters"];function v(){const t=C(".guns-list.cont-gray");if(t&&0<t.length){clearInterval(c),clearInterval(b),d=window.location.href,b=setInterval(gt,500);const a=C(".msg.right-round");a.html(`
                    <div id="important" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${qt.gray}; color:white;">重要</div></div>
                    <div id="flower" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${qt.gray}; color:white;">花花</div></div>
                    <div id="plushie" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${qt.gray}; color:white;">玩偶</div></div>
                    <div id="can" style="margin:6px 0px; overflow:hidden;"><div style="float:left; padding:2px; margin:3px; background-color:${qt.gray}; color:white;">能饮</div></div>
                `);for(let t=0;t<lt.length;t++){const r=lt[t].split(" ")[0];C("#important").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${qt.yellowgreen}; color:white;" name="${lt[t]}">${r}</div>`)}for(let t=0;t<dt.length;t++){const o=dt[t].split(" ")[0];C("#flower").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${qt.pink}; color:white;" name="${dt[t]}">${o}</div>`)}for(let t=0;t<ct.length;t++){const s=ct[t].replace(/ Plushie/g,"");C("#plushie").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${qt.blue}; color:white;" name="${ct[t]}">${s}</div>`)}for(let t=0;t<pt.length;t++){const l=pt[t].replace(/Can of /g,"");C("#can").append(`<div class="border-round header-link" style="float:left; cursor:pointer; padding:2px; margin:3px; background-color:${qt.yellow}; color:white;" name="${pt[t]}">${l}</div>`)}C(".header-link").click(function(){const t=C(this).attr("name"),e="/imarket.php#/p=shop&step=shop&type=&searchname="+t.replace(/ /g,"+");console.log(e),window.location.href=e});const I=C(".items").children(":first").find("[itemid]").attr("itemid"),n=t.children(":first").find(".name.t-gray-6").text();if(0<=lt.indexOf(n)||0<=dt.indexOf(n)||0<=ct.indexOf(n)||0<=pt.indexOf(n)){let d={};const p=It("bazaar_cache",n);let c=0;const g=C(".desc.t-blue-cont.t-overflow");if(g.each(function(t,e){const a=C(this).find(".price.t-gray-6"),n=C(this).find(".user.t-overflow").children("a"),i=n.attr("href"),r=i?i.replace(/[^\d]/g,""):0,o=a.text().split("(")[0].trim(),s=xt(o),l=a.text().split("(")[1].replace(/\)/g,"").trim();d[r]={price:s,price_formal:o,amount:l},s>c&&(c=s)}),!C.isEmptyObject(p))for(var e in p)if(null==d[e]&&p[e].price>=c){const h=`
                                    <li>
                                        <span class="item-desc">
                                            <span class="item">
                                                <img class="img___3jDmV" src="/images/items/${I}/large.png?v=1528808940574" alt="${n}">
                                                <a class="item-hover" href="/bazaar.php?userID=${e}"></a>
                                            </span>
                                            <span class="desc t-blue-cont t-overflow">
                                                <span class="user t-overflow">
                                                    <a href="/bazaar.php?userID=${e}">Pampa's bazaar</a>
                                                </span>
                                                <span class="name t-gray-6">${n}</span>
                                                <span class="price t-gray-6"> ${p[e].price_formal}
                                                    <span class="stock t-gray-9">(${p[e].amount})</span>
                                                </span>
                                            </span>
                                        </span>
                                    </li>`;t.children(":last").before(h)}ht(I,n,d,p)}const i=C(".desc.t-blue-cont.t-overflow");i.each(function(t,e){const v=C(this).find(".price.t-gray-6"),w=C(this).find(".user.t-overflow").children("a"),a=w.attr("href"),_=a?a.replace(/[^\d]/g,""):0;v.prev().remove();const n=v.text().split("(")[0].trim(),k=xt(n),$=v.text().split("(")[1].replace(/\)/g,"").trim();Ot(_,function(t){const e=M(t.last_action.timestamp),a=t.status.color,n=T(t.status.description,t.status.state,t.status.until),i=t.job.company_type,r=t.basicicons.icon72,o=t.last_action.status,s=t.bazaar,l=t.faction.faction_id;let d={};if(s.map(function(t,e,a){d[t.ID]={name:t.name,quantity:t.quantity,price:t.price}}),!(I in d))return v.parent().parent().parent().remove(),1;{const x=d[I].quantity,y=d[I].price;x==$&&y==k||v.html(`${xt(y)} <span class="stock t-gray-9">(${x})</span>`)}l in Gt&&w.parent().parent().css("background-color",qt.green);let c="";c="Online"==o?'<span title="<b>Online</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:0px 0; background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':"Offline"==o?'<span title="<b>Offline</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-18px 0;   background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>':'<span title="<b>Idle</b>" style="width:16px;height:16px;margin:0px 2px;vertical-align:bottom; display:inline-block; background-position:-1098px 0;  background-image:url(/images/v2/svg_icons/sprites/user_status_icons_sprite.svg)"></span>';let p="打",g=qt.purple;5==i&&(p="衣",g=qt.gray),null!=r&&(p="新",g=qt.gray),w.text("");const h=`${c}<a href="/profiles.php?XID=${_}">${t.name}</a>`,b=`<a class= "border-round" style="padding:1px 2px;background-color:${g};color:white;" href="/loader.php?sid=attack&user2ID=${_}">${p}</a>`;w.before(b),w.after(h);let f=0;null!=s&&s.map(function(t,e,a){f+=t.quantity*t.market_price}),v.parent().siblings(".item").css("margin","2px 10px"),v.parent().siblings(".item").append(`<div style="font-size: 13px; line-height: 17px; text-align: center;"><span class="border-round" style="background-color: ${qt.purple}; color: white; padding: 1px 3px;">全店 ${yt(f)}</span></div>`);let m="";"blue"==a&&(m=qt.blue),"green"==a&&(m=qt.green),"red"==a&&(m=qt.red);let u=`
                            <span class="left" style="">
                                <span class= "border-round" style="padding: 1px 3px; background-color: ${m}; color: white;" title="Status: ${t.status.description}">${n[0]}</span>
                                <span style="padding: 1px 3px;" title="Last Action: ${t.last_action.relative}">${e[1]}</span>
                                <span style="padding: 1px 3px;" title="BattleStats: ${yt(t.estimate_bs)}">${yt(t.estimate_bs)}</span>
                            </span>`;v.after(u)})})}}function gt(){d!=window.location.href&&(clearInterval(c),clearInterval(b),d=window.location.href,c=setInterval(v,500))}function ht(r,o,s,l){var t=`https://api.torn.com/market/${r}?selections=bazaar&key=${x}`;fetch(t).then(t=>t.json()).then(t=>{console.log(r+" bazaar API fetched");var e=t.bazaar;let a={};for(let t=0;t<e.length;t++){if(!C.isEmptyObject(l))for(var n in l)l[n].apiid==e[t].ID&&(a[n]={apiid:e[t].ID,price:e[t].cost,price_formal:xt(e[t].cost),amount:e[t].quantity});if(!C.isEmptyObject(s))for(var i in s)s[i].price==e[t].cost&&s[i].amount==e[t].quantity&&(a[i]={apiid:e[t].ID,price:e[t].cost,price_formal:xt(e[t].cost),amount:e[t].quantity})}Dt("bazaar_cache",o,a)}).catch(t=>console.log("fetch error",t))}}{function v(){const t=C(".users-point-sell").children("li");if(t&&0<t.length){clearInterval(r);let o=[];C("li.total-price").attr("id","total-price");const e=document.getElementById("total-price"),s=window.getComputedStyle(e).width.replace(/px$/g,"");t.each(function(t,e){const c=C(this).find(".total-price"),a=C(this).find(".user.name").attr("href"),n=a?a.replace(/[^\d]/g,""):0,i=C(this).find(".user.faction").attr("href"),r=i?i.replace(/[^\d]/g,""):0;r in Gt&&C(this).css("background-color",qt.green),-1==o.indexOf(n)&&(o.push(n),Number(s)<200&&c.text(""),Ot(n,function(t){const e=M(t.last_action.timestamp),a=t.status.color,n=T(t.status.description,t.status.state,t.status.until),i=t.job.company_type,r=t.basicicons.icon72;let o="打",s=qt.purple;5==i&&(o="衣",s=qt.gray),null!=r&&(o="新",s=qt.gray);let l="";"blue"==a&&(l=qt.blue),"green"==a&&(l=qt.green),"red"==a&&(l=qt.red);let d="<span class='left'>";d+=`<span style="padding:1px;margin:1px;background-color:${s};color:white;">${o}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${l};color:white;" title="Status: ${t.status.description}">${n[0]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${qt.gray};color:white;" title="Last Action: ${t.last_action.relative}">${e[1]}</span>`,d+=`<span style="padding:1px;margin:1px;background-color:${qt.blue};color:white;" title="BattleStats: ${yt(t.estimate_bs)}">${yt(t.estimate_bs)}</span></span>`,c.prepend(d)}))})}}mugoo&&0<=window.location.href.indexOf("pmarket.php")&&(r=setInterval(v,500))}if(mugoo&&0<=window.location.href.indexOf("bazaar.php")){var bt={};const ne=C("#mainContainer").find("div:contains('unavailable')").last();function ft(){var t=`https://api.torn.com/torn/?selections=items&key=${x}`;fetch(t).then(t=>t.json()).then(t=>{console.log("API fetched");let e={};const a=new Date;for(var n in e["last-updated"]=a.toString(),t.items)e[n]=t.items[n].market_value;window.localStorage.setItem("ITEMS",JSON.stringify(e))}).catch(t=>console.log("fetch error",t))}function v(){const h=C("[class*='messageContent___']");if("1"!=h.attr("hasdone")){h.attr("hasdone","1"),C("#sum").remove();let t='<div id="sum">',e=0;for(var a in bt)t+=" (<span class='t-green'> "+bt[a].name+" "+bt[a].total_formal+" </span>) ",e+=bt[a].total;t+="<span class='t-red'><b> Total Selected: "+yt(e)+" </b></span></div>",h.append(t)}const t=It("ITEMS","last-updated"),e=C("[class^='rowItems___']").children();t&&e&&0<e.length&&e.each(function(t,e){const a=C(this).find("[class^='name___']").text(),n=C(this).find("[class^='price___']");let i=0;""!=n.text()&&(i=n.text().replace(/[^\d]/g,""));const r=C(this).find("img").attr("src");let o=0,s=0;null!=r&&(s=r.split("/")[3],0<s&&(o=It("ITEMS",s)));const l=C(this).find("[class^='amount___']");let d=0;if(""!=l.text()&&(d=l.text().replace(/[^\d]/g,"")),0<o&&0<i&&0<d&&"1"!=C(this).attr("hasdone")){C(this).attr("hasdone","1");const c=((i-o)/o*100).toFixed(1),p=yt(i*d);l.append(`&nbsp;&nbsp;<span><span class="t-blue">${p}</span></span>`),0<=c?n.append(`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${c}%</span></span>`):n.append(`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${c}%</span></span>`);const g=C(this).find("[class^='description___']");null!=bt[s]&&g.css("background-color","NavajoWhite"),g.click(function(){C(this).attr("selected")?(delete bt[s],C(this).removeAttr("selected"),h.removeAttr("hasdone"),C(this).css("background-color","")):(bt[s]={name:a,price:i,amount:d,total:i*d,total_formal:yt(i*d)},C(this).attr("selected","selected"),h.removeAttr("hasdone"),C(this).css("background-color","NavajoWhite"))})}})}0<ne.length?(mt=window.location.href.replace(/[^\d]/g,""),ne.text("蛙蛙探测器工作中..."),mt=`https://api.torn.com/user/${mt}?selections=basic,bazaar&key=${x}`,fetch(mt).then(t=>t.ok?t.json():void ne.text("---探测失败 "+fID+"---"),t=>{ne.text("---网络异常 "+fID+"---")}).then(a=>{if(ne.html(`蛙蛙探测成功^_^ [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),null==a.bazaar)ne.html(`货物卖光了:( [ <a class="t-blue" href="/profiles.php?XID=${a.player_id}">${a.name}</a>的小店 ]`),console.log("no item in bazaar");else{C(".content-wrapper").last().append('<div class="bazaar-wrapper" style="margin-top:10px;"><div class="bazaar-content" style="width:inherit; overflow:hidden; background-color:white;"></div></div>');for(let e=0;e<a.bazaar.length;e++){var n=((a.bazaar[e].price-a.bazaar[e].market_price)/a.bazaar[e].market_price*100).toFixed(2);let t="";t=0<n?`&nbsp;&nbsp;<span class="change up"><i class="arrow-change-icon" role="img" aria-label="stock price is up"></i><span class="t-green">${n}%</span></span>`:`&nbsp;&nbsp;<span class="change down"><i class="arrow-change-icon" role="img" aria-label="stock price is down"></i><span class="t-red">${n}%</span></span>`,C(".bazaar-content").append(`
                                <div class="item-wrapper" style="width:288px; float:left; overflow:hidden;">
                                    <div style="width:100px; height:50px; margin:7px; padding:3px; float:left; border:1px solid darkgray;">
                                        <img src="/images/items/${a.bazaar[e].ID}/large.png">
                                    </div>
                                    <div class="item-description" style="width:150px; margin:7px; float:left; border:1px solid darkgray;overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                        <p class="item-name" style="margin:5px">${a.bazaar[e].name}</p>
                                        <p class="item-price" style="margin:5px">${xt(a.bazaar[e].price)}${t}</p>
                                        <p class="item-quantity" style="margin:5px">(${a.bazaar[e].quantity} in stock)
                                            <span class="t-blue">&nbsp;&nbsp;${yt(a.bazaar[e].price*a.bazaar[e].quantity)}</span>
                                        </p>
                                    </div>
                                </div>`)}}}).catch(t=>ne.text(t))):(function(){var e=It("ITEMS","last-updated");if(null!=e&&null!=e){var a=new Date;let t=new Date(e);t.setDate(t.getDate()+1),t<a&&ft()}else ft()}(),setInterval(v,500))}{function v(){const i=C(".buy-item-info").find(".private-bazaar");0<i.length&&i.each(function(t,e){if("1"!=C(this).attr("hasdone")){C(this).attr("hasdone","1");const a=C(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),n=C(this);Ot(a,function(t){n.attr("user_id",a),n.attr("user_name",t.name),n.attr("user_level",t.level),n.attr("user_bs",yt(t.estimate_bs)),n.attr("user_last",t.last_action.relative),n.attr("user_stat",t.status.description),n.attr("user_job_type",t.job.company_type),n.attr("newbie",t.basicicons.icon72)})}});const t=C(".buy-item-info-wrap").find(".private-bazaar");0<t.length&&t.each(function(t,e){if("1"!=C(this).attr("hasdone")){const c=C(this).find('[href^="bazaar"]').attr("href").replace(/[^\d]/g,""),a=C(this).find(".user.faction").attr("href"),n=a?a.replace(/[^\d]/g,""):0;n in Gt&&C(this).css("background-color",qt.green);const p=C(this);i.each(function(t,e){if(C(this).attr("user_id")==c){console.log(C(this).attr("user_name"));const a=C(this).attr("user_name"),n=C(this).attr("user_level"),i=C(this).attr("user_bs"),r=C(this).attr("user_last"),o=C(this).attr("user_stat"),s=C(this).attr("user_job_type"),l=C(this).attr("newbie");let t="打";5==s?t="衣":null!=l&&(t="新");const d=`
                                    <li class="private-bazaar wawa-bazaar" hasdone="1">
                                        <ul class="item t-blue-cont h">
                                            <li class="item-name">
                                                <div class="item-t right t-gray-9">${o}</div>
                                                <div class="name-t icons left">
                                                    <span class="t-gray-9">Lv:${n}</span>
                                                <a class="user name" href="/profiles.php?XID=${c} ">
                                                    <span title="${a} [${c}]"><b>BS: ${i}</b><span></span></span>
                                                </a>
                                                </div>
                                                <div class="name-t name-mobile left">
                                                    <span class="t-gray-9 italic">sold by</span>
                                                    <a class="t-blue" href="profiles.php?XID=${c}">BS: ${i}</a>
                                                </div>
                                                <div class="clear"></div>
                                            </li>
                                            <li class="cost">
                                                <span class="t-gray-9" title="${o}">${r}</span>
                                            </li>
                                            <li class="view">
                                                <a href="/loader.php?sid=attack&user2ID=${c}"><b>${t}</b></a>
                                            </li>
                                            <li class="clear"></li>
                                        </ul>
                                    </li>`;return p.after(d),p.attr("hasdone","1"),!1}})}})}mugoo&&0<=window.location.href.indexOf("imarket.php")&&setInterval(v,500)}{function v(){const t=C("[class^='btn___']");if(0<t.length){const e=t[0];if(C(e).text().includes("CONTINUE")){const a=C(e).parent().parent().children(":first").text().split(" ");clearInterval(p),console.log(a);const n=a[2],i=a[1],r=new Date,o=parseInt(r.getTime()/1e3),s=r.format("yyyy-MM-dd hh:mm:ss");if("mugged"==i){let t=a[5];console.log(t),"wallet"==t&&(t="$0");const l={timestring:s,victim_id:c,victim_name:n,money_mugged:t};Dt("muglog",o,l)}}}}0<=window.location.href.indexOf("loader.php?sid=attack&user2ID")&&(c=window.location.href.match(/loader\.php\?sid=attack\&user2ID=(\d+)/)[1],p=setInterval(v,300))}if(0<=window.location.href.indexOf("companies.php")){C(".info-msg-cont").after("<div id='effectiveness-wrap' style='margin-top:10px; overflow-x: auto;'></div>");var mt=Nt();console.log("userId "+mt),et(mt).then(function(t){console.log(t);t=t[3];"Employee"==t?E(C("#effectiveness-wrap")):"Director"==t&&j(C("#effectiveness-wrap"))}).catch(t=>console.log("userId2otherIds "+t));const ie=setInterval(function(){const t=C(".employee-list-wrap").children("ul.employee-list").children("li");if(0<t.length){clearInterval(ie);let n={},i=0;t.each(function(t,e){var a=C(this).attr("data-user");n[a]=i,i+=1}),window.localStorage.setItem("EMPLOYEE_RANK",JSON.stringify(n))}},1e3)}else j(null);0<=window.location.href.indexOf("joblist.php")&&setInterval(function(){const t=C("ul.rank-list");if(0<t.length&&"1"!=t.attr("hasdone")){t.attr("hasdone","1");t.after(`
                    <div id="company_parade">
                        <div class="title-black m-top10 title-toggle tablet top-round faction-title active title" data-title="description" role="heading" aria-level="5">公司阅兵</div>
                        <div class="cont-gray bottom-rounded content" style="overflow:hidden; margin-bottom:10px;">
                            <button id="company_parade_start_btn" class="torn-btn" style="margin:5px;">开始阅兵</button>
                            <button id="company_parade_stop_btn" class="torn-btn" style="margin:5px;">暂停阅兵</button>
                            <span id="company_parade_tip" style="margin:5px;"></span>
                        </div>
                    </div>`);let a=!0;C("#company_parade_start_btn").click(function(){a=!0,C("#company_parade_start_btn").prop("disabled",!0),C("#company_parade_stop_btn").removeAttr("disabled");const t=C("ul.company-list").children().first();t.length<=0?(C("#company_parade_tip").text("未找到公司列表"),C("#company_parade_start_btn").removeAttr("disabled"),C("#company_parade_stop_btn").prop("disabled",!0)):(C("#company_parade_tip").text("阅兵开始"),C("#company_parade_table").length<=0&&(C("#company_parade").after(`
                                <div id="company_parade_table">
                                    <table style="margin:auto;background-color:white;font-size:12px;">
                                        <tr class="head">
                                            <th>星级</th>
                                            <th>名称</th>
                                            <th>老板</th>
                                            <th>天数</th>
                                            <th>员工数</th>
                                            <th title="24h未上线">不活跃</th>
                                            <th title="入职不到10天">新员工</th>
                                            <th>日收入</th>
                                            <th>日单价</th>
                                            <th>周收入</th>
                                            <th>周单价</th>
                                        </tr>
                                    </table>
                                </div>`),C("#company_parade_table").find("th").attr("style","border: 1px solid darkgray;padding: 5px;background-color: black;color: white;font-weight: bold;text-align:center;")),setTimeout(()=>{!function d(c){if("1"==c.attr("detected"))C("#company_parade_tip").text("公司已完成"),setTimeout(()=>{d(c.next())},0);else if(c.length<=0||0==a)C("#company_parade_tip").text("阅兵已结束"),C("#company_parade_start_btn").removeAttr("disabled"),C("#company_parade_stop_btn").prop("disabled",!0);else{c.attr("detected","1");const e=c.children().children("li.view").children().attr("href"),p=e?e.replace(/[^\d]/g,""):0,g=c.children().children("li.company").text();var t=`https://api.torn.com/company/${p}?selections=profile&key=${x}`;C("#company_parade_tip").text(`正在阅兵：${p} ${g}`),fetch(t).then(t=>t.json()).then(a=>{if("company"in a){var n=a.company.director,i=a.company.employees[n].name;let t=0,e=0;var r,o=parseInt((new Date).getTime()/1e3);for(r in a.company.employees){var s=a.company.employees[r].last_action.timestamp;86400<=o-s&&(t+=1);var l=a.company.employees[r].days_in_company;l<10&&(e+=1)}C("#company_parade_table").children().append(`
                                        <tr class="content">
                                            <td>${a.company.rating}</td>
                                            <td><a href="#!p=corpinfo&ID=${p}" target="_blank">${a.company.name}</a></td>
                                            <td><a class="user name" href="/profiles.php?XID=${n}" target="_blank">${i}</a></td>
                                            <td>${a.company.days_old}</td>
                                            <td>${a.company.employees_hired}/${a.company.employees_capacity}</td>
                                            <td>${t}</td>
                                            <td>${e}</td>
                                            <td>${yt(a.company.daily_income)}</td>
                                            <td>${yt(a.company.daily_income/a.company.daily_customers)}</td>
                                            <td>${yt(a.company.weekly_income)}</td>
                                            <td>${yt(a.company.weekly_income/a.company.weekly_customers)}</td>
                                        </tr>`),C("#company_parade_table").find("td").attr("style","border: 1px solid darkgray;padding:5px;text-align:center;"),setTimeout(()=>{d(c.next())},1e3)}else"error"in a&&C("#company_parade_tip").text(`蛙蛙探测失败：${p} ${g} ${a.error.error}`)}).catch(t=>console.log(t))}}(t)},1e3))}),C("#company_parade_stop_btn").click(function(){a=!1})}},500)}function ut(t){return 0<=t.toString().indexOf(",")?Number(t.replace(/,/g,"")):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","})}function xt(t){return 0<=t.toString().indexOf("$")?Number(t.replace(/\$|,/g,"")):Number.isNaN(Number(t))?0:t.toString().replace(/\d{1,3}(?=(\d{3})+$)/g,function(t){return t+","}).replace(/^[^\$]\S+/,function(t){return"$"+t})}function yt(t){return t<0?"-"+yt(-t):0==t?"0":t<=1?(100*t).toFixed(2)+"%":t<1e3?""+parseInt(t):1e3<=t&&t<1e6?(t/1e3).toFixed(2)+"k":1e6<=t&&t<1e9?(t/1e6).toFixed(2)+"m":1e9<=t&&t<1e12?(t/1e9).toFixed(2)+"b":1e12<=t&&t<1e15?(t/1e12).toFixed(2)+"t":1e15<=t?"MAX":void 0}function vt(t){return"[object Array]"===Object.prototype.toString.call(t)?t:"[object Object]"===Object.prototype.toString.call(t)?Object.values(t):null}function wt(t){var e=vt(t);if(null==e||e.length<=0)return null;if(t=e,"[object Array]"===Object.prototype.toString.call(t)&&(!(t.length<=1)&&("[object Object]"===Object.prototype.toString.call(t[0])&&0<Object.keys(t[0]).length)))return e;for(let t=0;t<e.length;++t){var a=wt(e[t]);if(null!=a)return console.log(`在第 ${t} 个节点发现有效数据集`),a}return null}function _t(t){for(var e in t)!function(t,e){var a=t[e];if("object"==typeof a){for(var n in a){var i=a[n];"object"==typeof i?_t(a):t[n+"_"+e]=i}delete t[e]}}(t,e)}function kt(e){var t=e[0];_t(t);let a=Object.keys(t);console.log(`item_keys: ${a}`);for(let t=1;t<e.length;++t){var n=e[t];_t(n);var i=Object.keys(n);for(let t=0;t<i.length;t++){var r=i[t];console.log(`add item_key: ${r}`),-1==a.indexOf(r)&&a.push(r)}}let o=a.sort().join(",");for(let t=0;t<e.length;++t){o+="\n";var s=e[t];_t(s);for(let e=0;e<a.length;++e){let t=s[a[e]]+"";"object"==typeof t&&(t=JSON.stringify(t)),t='"'+t.replace(/<[^>]+>/g,"").trim().replace(/\"/g,'""')+'"',0<e&&(o+=","),o+=t}}return encodeURIComponent(o)}function $t(t){if(void 0!==window.localStorage)return null===window.localStorage.getItem(t)?null:JSON.parse(window.localStorage.getItem(t))}function It(t,e){t=$t(t);if(void 0!==t)return null===t?null:void 0!==t[e]?t[e]:void 0}function Dt(e,a,n){if(void 0!==window.localStorage)if(null===window.localStorage.getItem(e)){let t={};t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}else{let t=JSON.parse(window.localStorage.getItem(e));t[a]=n,window.localStorage.setItem(e,JSON.stringify(t))}}function St(t,e){if(void 0!==window.localStorage&&null!==window.localStorage.getItem(t)){const a=JSON.parse(window.localStorage.getItem(t));void 0===a[e]||(delete a[e],window.localStorage.setItem(t,JSON.stringify(a)))}}function Ft(i,r){i.click(function(){const t=C(this).siblings();t.each(function(){var t=C(this).text().replace(/[↑↓]/,"");C(this).text(t)});var e=C(this).text().replace(/[↑↓]/,"");let a="",n="";n="TH"==i[0].tagName?(a=i.parent().siblings(),i.parent().parent()):(a=i.parent().next().children(),i.parent().next()),"descend"==C(this).attr("sort")?(a.sort(function(t,e){const a=r(t);e=r(e);return isNaN(a)?a.localeCompare(e):a-e}),a.detach().appendTo(n),C(this).attr("sort","ascend").text(e+"↑")):(a.sort(function(t,e){t=r(t);const a=r(e);return isNaN(t)?a.localeCompare(t):a-t}),a.detach().appendTo(n),C(this).attr("sort","descend").text(e+"↓"))})}function At(t,e,a,n,i){return`
            <div style="position:relative; top:0; width:100%; height:${t-4}px; color:${a}; background-color:${n}; padding:2px 0px; text-align:center;">${i}</div>
            <div style="position:relative; top:-${t}px; width:100%; left:${e-100}%; height:${t-4}px; padding:2px 0px; z-index:2; overflow:hidden;">
                <div style="position:absolute; top:0; width:100%; left:${100-e}%; height:${t-4}px; color:${n}; background-color:${a}; padding:2px 0px; text-align:center;">${i}</div>
            </div>`}function Ot(t,ft,e){let a=`https://api.torn.com/user/${t}?selections=profile,crimes,personalstats,bazaar&key=${x}`;console.log(`Request: ${a}`),fetch(a).then(t=>t.ok?t.json():void e("蛙蛙探测失败，请刷新重试"),t=>{e("蛙蛙探测失败，网络异常，请刷新重试")}).then(g=>{if(console.log(`Response: ${a}`),console.log(g),null!=g)if(g.hasOwnProperty("error"))e(`蛙蛙探测失败：${JSON.stringify(g,null,4)}`);else{var h=g.personalstats,b=h.defendslost||0,f=h.defendsstalemated||0,m=h.defendswon||0,u=h.attackswon||0,x=h.attacksdraw||0,y=h.attackslost||0,v=h.cantaken||0,w=h.exttaken||0,_=h.kettaken||0,k=h.lsdtaken||0,$=h.opitaken||0,I=h.pcptaken||0,D=h.shrtaken||0,S=h.spetaken||0,F=h.victaken||0,A=h.xantaken||0,O=g.age||1,C=h.trainsreceived||0,M=w+k+A,T=((g.xan_lsd_ecs=M)/O).toFixed(2);g.average_drugs=T;var N=h.refills||0,z=h.statenhancersused||0,P=h.useractivity||0,E=h.traveltime||0,j=(h.logins,h.dumpsearches||0),R=h.energydrinkused||0,W=h.boostersused||0,M=h.revives||0,T=u+x+y,x=h.daysbeendonator||0,y=Math.min(O,parseInt((new Date-new Date("2011/11/22"))/864e5));const tt=Math.min(x/y,1);g.donator_percent=tt.toFixed(2);const et=480+240*tt;const at=611255/et;console.log(`统计DP时间 ${x}d，最多 ${y}d，DP比例：${yt(tt)}，一天完整能量：${et.toFixed(2)}，实现CAP需要活跃：${at.toFixed(2)}天`);y=g.last_action.timestamp||0;let t=parseInt((new Date).getTime()/1e3)-y,e="";86400<t&&(e+=parseInt(t/86400)+"天",t%=86400),3600<t&&(e+=parseInt(t/3600)+"时",t%=3600),60<t&&(e+=parseInt(t/60)+"分",t%=60),e+=t+"秒",g.last_action_details=e;const nt=g.last_action.relative;g.last_action_brief=nt.replace(" minute ago","m").replace(" minutes ago","m").replace(" hours ago","h").replace(" hour ago","h").replace(" days ago","d").replace(" day ago","d");let a=0;nt.includes("d")&&(a=parseInt(nt.replace(/[^0-9|-]/gi,"")));const it=Math.max(1,21*(O-a)/24);console.log(`年龄${O}天，上次登录${a}天前，最大活跃天数${it.toFixed(2)}`);const rt=P/86400,ot=E/86400,st=3*rt+ot;console.log(`ched_active_days: 3*${rt.toFixed(2)}(activity) + ${ot.toFixed(2)}(travel) = ${st.toFixed(2)}`);const lt=(75*v+210*w+52.5*_+425*k+215*$+430*I+209.5*D+301*S+300*F+420*A)/1440;console.log(`drug_active_days: ${lt.toFixed(2)}`);v=g.criminalrecord.other||0,w=g.criminalrecord.selling_illegal_products||0,_=g.criminalrecord.theft||0,$=g.criminalrecord.drug_deals||0,I=g.criminalrecord.computer_crimes||0,D=g.criminalrecord.murder||0,S=g.criminalrecord.fraud_crimes||0,F=g.criminalrecord.auto_theft||0;let n=.11*_+.5*I+.66*D+S+.66*F+.05*$;n<0&&(n=0),g.estimate_ace=parseInt(n),12862<n?g.estimate_nnb=60:9171<n?g.estimate_nnb=55:5950<n?g.estimate_nnb=50:4324<n?g.estimate_nnb=45:2750<n?g.estimate_nnb=40:1198<n?g.estimate_nnb=35:450<n?g.estimate_nnb=30:250<n?g.estimate_nnb=25:100<n?g.estimate_nnb=20:50<n?g.estimate_nnb=15:g.estimate_nnb=10;let i=5*(2*v+3*w+5*_+8*$/.8+9*I/.75+10*D/.75+11*S/.95+12*F/.7)/1440;i<at&&(B=Math.min(at/i,3),console.log(`新手 crime_active_days 补偿系数：${B}`),i*=B),console.log(`crime_active_days: ${i.toFixed(2)}`);var B=Math.min(it,Math.max(st,lt,i)).toFixed(2);console.log(`估算活跃天数: ${B}`),g.estimate_active_days=B;O=parseInt(75*C+30*B+70*O);console.log(`估算WS: ${O}`),g.estimate_ws=O;const dt=parseInt(et*B);console.log(`估算的自然恢复能量: ${dt}`);B=parseInt(150*N),N=250*A+50*k,R=20*R,W=150*W;const ct=B+N+R+W;console.log(`物品能量：${B}(refill) + ${N}(drug) + ${R}(can) + ${W}(FHC) = ${ct}`);W=25*T,M=25*M,j=5*j;const pt=W+M+j;console.log(`消耗能量：${W}(attack) + ${M}(revive) + ${j}(dump) = ${pt}`);let r=dt+ct-pt;r<0&&(r=0),console.log(`总锻炼能量：${dt}(自然) + ${ct}(物品) - ${pt}(消耗) = ${r}`),g.total_energy=r.toFixed(0),g.nature_energy=dt.toFixed(0),g.item_energy=ct.toFixed(0),g.expend_energy=pt.toFixed(0);let o=40;var L=[2,2.8,3.2,3.2,3.6,3.8,3.7,4,4.8,4.8,5.2,5.2,5.4,5.8,5.8,6,6.4,6.6,6.8,7,7,7,7,7.3],G=[200,500,1e3,2e3,2750,3e3,3500,4e3,6e3,7e3,8e3,11e3,12420,18e3,18100,24140,31260,36610,46640,56520,67775,84535,106305,Number.MAX_SAFE_INTEGER];let s=0,l=r,d=G[0];for(;0<l&&o<2e8;){var q=Math.min(G[s],l,d,1e3),H=L[s];const gt=1.122*1.02*H*q*((348e-9*Math.log(4750)+31e-7)*o/4+.32433-.0301431777);o+=gt,l-=q,d-=q,l<=0?console.log(`能量已用光，最近这次在系数为 ${H} 的健身房锻炼了 ${q} 能量，属性 +${gt.toFixed(2)} 变为 ${o.toFixed(2)}`):2e8<=o?console.log(`已达到CAP，最近这次在系数为 ${H} 的健身房锻炼了 ${q} 能量，属性 +${gt.toFixed(2)} 变为 ${o.toFixed(2)}，剩余 ${l} 能量`):s<L.length-1&&d<=0&&(console.log(`要换健身房了，最近这次在系数为 ${H} 的健身房锻炼了 ${q} 能量，属性 +${gt.toFixed(2)} 变为 ${o.toFixed(2)}，剩余 ${l} 能量`),++s,d=G[s])}if(0<l)if(console.log(`实现CAP消耗的能量：${r-l}`),A<k&&A<=100){const ht=3240*l;o+=ht,console.log(`LSD青年，剩余能量还能再 +${ht.toFixed(2)} 属性，变为 ${o.toFixed(2)}`)}else{const bt=2510*l;o+=bt,console.log(`普通青年，剩余能量还能再 +${bt.toFixed(2)} 属性，变为 ${o.toFixed(2)}`)}else console.log("未达CAP");0<z&&(o=.5*o+.5*o*(1+.9*(Math.pow(1.01,.5*z)-1)),console.log(`再用上 +${z} 个SE，属性变为 ${o.toFixed(2)}`)),o=parseInt(o);let c=yt(o);console.log(`估算bs为：${c}`);var X,J=[2,6,11,26,31,50,71,100],U=[100,5e3,1e4,2e4,3e4,5e4],K=[5e6,5e7,5e8,5e9,5e10],k=[2e3,2e4,2e5,2e6,2e7,2e8],A=[2500,25e3,25e4,25e5,35e6,25e7],V={"Absolute beginner":1,Beginner:2,Inexperienced:3,Rookie:4,Novice:5,"Below average":6,Average:7,Reasonable:8,"Above average":9,Competent:10,"Highly competent":11,Veteran:12,Distinguished:13,"Highly distinguished":14,Professional:15,Star:16,Master:17,Outstanding:18,Celebrity:19,Supreme:20,Idolised:21,Champion:22,Heroic:23,Legendary:24,Elite:25,Invincible:26};let p=0;for(X in V)if(0==g.rank.indexOf(X)){p=V[X],g.rank_value=p,g.rank_name=X;break}z=g.rank.split(" ");if(g.rank_title=z[z.length-1],console.log(`Rank: value = #${p}, name = ${g.rank_name}, title = ${g.rank_title}, full = ${g.rank}`),0<p&&o<Number.MAX_SAFE_INTEGER){--p;var Y=g.level||0;for(let t=0;t<J.length;++t)Y>=J[t]&&--p;console.log(`Rank 减掉 level trigger 还剩下 ${p}`);var Z=g.criminalrecord.total||0;for(let t=0;t<U.length;++t)Z>=U[t]&&--p;console.log(`Rank 减掉 crimes trigger 还剩下 ${p}`);var Q=h.networth||0;for(let t=0;t<K.length;++t)Q>=K[t]&&--p;console.log(`Rank 减掉 networth trigger 还剩下 ${p}`);let t=0,e=Number.MAX_SAFE_INTEGER;p<=0?e=A[0]:p>=k.length?t=k[k.length-1]:(t=k[p-1],e=A[p]),console.log(`根据Rank推算bs区间：[${t}, ${e})`),o<t?(c=`${c} ~ ${yt(t)}`,console.log(`估算总bs小于按Rank推算的下限值：${yt(t)}`)):o>e?(c=`${yt(e)} ~ ${c}`,console.log(`估算总bs高于按Rank推算的上限值：${yt(e)}`)):console.log("估算总bs符合按Rank推算的区间")}g.estimate_bs=o,g.estimate_bs_display=c,g.attackWinRatio=u/T,g.defendWinRatio=(m+f)/(m+f+b),ft(g)}})}function Ct(t){C("#api_result_container").val(C("#api_result_container").val()+"\n"+t)}function Mt(a){a=It("CHAT_LAST_MESSAGE",a);if(a){a=function(t){var e=t.split("-")[0].trim();const a=t.split("-")[1].replace("TCT","");var n="20"+a.split("/")[2],i=a.split("/")[1],t=a.split("/")[0];const r=new Date(n+"/"+i+"/"+t+" "+e);return r.setHours(r.getHours()-(new Date).getTimezoneOffset()/60),parseInt(r.getTime()/1e3)}(a),a=parseInt((new Date).getTime()/1e3)-a;let t="",e="";return a<3600?(t=parseInt(a/60)+"m ago",e="#5d9525"):3600<=a&&a<86400?(t=parseInt(a/3600)+"h ago",e="#DAA520"):86400<=a&&a<3024e3?(t=parseInt(a/86400)+"d ago",e="#c0542f"):3024e3<=a&&(t=parseInt(a/86400)+"d ago",e="#777"),[e,t]}}function Tt(t){var e=window.localStorage.getItem("muglog");if(e){var e=JSON.parse(e),n=Object.entries(e);for(let a=n.length-1;0<=a;a--)if(n[a][1].victim_id==t){var i=n[a][0],r="$"+yt(xt(n[a][1].money_mugged)),i=parseInt((new Date).getTime()/1e3)-i;let t="",e="";return i<3600?(t=parseInt(i/60)+"m ago",e="#5d9525"):3600<=i&&i<86400?(t=parseInt(i/3600)+"h ago",e="#DAA520"):86400<=i&&(t=parseInt(i/86400)+"d ago",e="#c0542f"),e+","+t+","+r}}}function Nt(){return C("script[uid]").attr("uid")}function zt(){var t=`https://api.torn.com/torn/?selections=companies&key=${x}`;fetch(t).then(t=>t.json()).then(e=>{const a=new Date;if("companies"in e){let t={};for(var n in t["last-updated"]=a.toString(),t.companies={},e.companies)t.companies[n]={name:e.companies[n].name,positions:e.companies[n].positions};window.localStorage.setItem("APICache_companies",JSON.stringify(t))}else"error"in e&&Dt("APICache_companies","last-updated",a.toString())}).catch(t=>console.log("fetch error",t))}function Pt(){const n={"中文Wiki":"<a href='https://torn.huijiwiki.com/' target='_blank'>",YATA:"<a href='https://yata.yt/' target='_blank'>",NGA:"<a href='https://nga.178.com/thread.php?stid=30081562' target='_blank'>","赛车":"<a href='/loader.php?sid=racing'>","啤酒":"<a href='/shops.php?step=bitsnbobs'>","飞行":"<a href='/travelagency.php'>","库存":"<a href='https://yata.yt/bazaar/abroad/' target='_blank'>","市场":"<a href='/imarket.php'>","点市":"<a href='/pmarket.php'>","股市":"<a href='/page.php?sid=stocks'>","巴扎":"<a href='/bazaar.php'>"};setInterval(function(){const t=C("ul.menu-items");if("1"!=t.attr("hasdone")){if(0<t.siblings().length)for(var e in n)t.append('<li class="menu-item-link">'+n[e]+e+"</a></li>");else for(var a in t.attr("style","width:295px; margin-top:6px; line-height:16px;"),t.children(":last").remove(),t.children(":last").remove(),t.children(":last").remove(),n)t.append('<li class="menu-item-link">'+n[a]+a+"</a></li>");t.attr("hasdone","1")}},1e3)}function Et(){setInterval(function(){const t=C("[class*='chat-active_']"),e=new Date,o=parseInt(e.getTime()/1e3),a=t.children("[class*='chat-box-content_']").children("[class*='viewport_']").children().children("[class*='chat-last-message-label_']");a.each(function(t,e){Dt("CHAT_LAST_MESSAGE",C(this).parent().parent().parent().siblings("[class^='chat-box-head_']").children().attr("title"),C(this).children("span").text())});const n=t.children("[class*='chat-box-content_']").children("[class*='viewport_']").children().children("[class*='message_']");n.each(function(t,e){const a=C(this).attr("name");var n=a.split("-")[0],n=o-n;let i="",r="";n<3600?(i="["+parseInt(n/60)+"m ago]",r="#5d9525"):3600<=n&&n<86400?(i="["+parseInt(n/3600)+"h ago]",r="#DAA520"):86400<=n&&(i="["+parseInt(n/86400)+"d ago]",r="#c0542f"),C(this).children(".fac-ts").remove(),C(this).prepend('<span class="fac-ts" style="color:'+r+'">'+i+"&nbsp;</span>")})},1e3)}function jt(){const o={20465:["Leader","Co-leader","WEIYUAN","CHANGWEI"],36134:["Leader","Co-leader","Paladin","Minister"],16335:["Leader","Co-leader","Karajan","Haydn","Chopin","Schubert"],16424:["Leader","Co-leader","Lion","Panda","Dove","Rabbit"],10741:["Leader","Co-leader","General","Marshal"]};setInterval(function(){const t=C("[class*='type-list_']");if(0<t.length){const e=t.children("li:eq(3)").attr("class");if(0<=e.indexOf("active")){const a=C("[class*='people-list_']");"1"!=a.attr("hasDone")&&(a.attr("hasDone","1"),function(i){var t=`https://api.torn.com/faction/?selections=basic&key=${x}`;fetch(t).then(t=>t.json()).then(t=>{if("members"in t){let r=[];for(const n in t.members){var e=t.members[n].position,a=t.members[n].status.state;0<=o[t.ID].indexOf(e)&&"Okay"==a&&r.push(n)}i.each(function(t,e){const a=C(this).attr("class"),n=C(this).children("a").attr("href");var i=n?n.substring(18):0;0<=r.indexOf(i)&&0<=a.indexOf("online")&&(C(this).children("a").append("<span style='color:white'><b> 可取钱 在城内</b></span>"),C(this).css("background-color","Darkseagreen"))})}else"error"in t&&console.log(t.error.error)}).catch(t=>console.log("fetch error",t))}(a.children("li")))}}},3e3)}function Rt(t){0<C("#icon15-sidebar").length&&C("#nurse").length<1&&(C(t).before(`
                <div style="margin-bottom:5px;">
                    <div id='nurse' style='color:#333;width:inherit;margin:auto;padding:10px;border:5px solid gray;background-color:#ccc;text-align:center;'>
                        <div id='nurse-eff' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-cd' style='font-size:24px;padding:2px;'>小护士竭诚为你服务</div>    
                        <div id='nurse-item' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-suggestion' style='font-size:24px;padding:2px;'></div>
                        <div id='nurse-item-life' style='font-size:12px;padding:2px;'></div>
                        <div id='nurse-suggestion-life' style='font-size:24px;padding:2px;'></div>
                    </div>
                </div>`),t=`https://api.torn.com/user/?selections=profile,cooldowns,perks&key=${x}`,fetch(t).then(t=>t.ok?t.json():void C("#nurse-cd").text("--- 小护士探测失败 ---"),t=>{C("#nurse-cd").text("--- 小护士网络异常 ---")}).then(b=>{if(null!=b)if("error"in b)C("#nurse-cd").text(`--- API错误 --- code: ${b.error.code} error: ${b.error.error}`);else if("basicicons"in b&&"icon15"in b.basicicons){function f(t){let e=parseInt(t/3600);e=e<10?"0"+e:e;let a=parseInt(t/60)%60;a=a<10?"0"+a:a;let n=t%60;return n=n<10?"0"+n:n,e+":"+a+":"+n}var m=b.states.hospital_timestamp,u=m?m-parseInt((new Date).getTime()/1e3):0,x=f(u),y=parseInt(u/60),v=100-(b.life.current||0)/(b.life.maximum||7500)*100,w=f(b.cooldowns.medical||0);let a=!1,t=0,e=0,n=0;if("education_perks"in b){const A=b.education_perks;0<=A.indexOf("+ Withdraw and deliver blood")&&(a=!0),0<=A.indexOf("+ 20% Medical item effectiveness")&&(t=20),0<=A.indexOf("+ 10% Medical item effectiveness")&&(t=10)}if("faction_perks"in b){const O=b.faction_perks;O.forEach(function(t){0<=t.indexOf("medical item effectiveness")&&(e=t.replace("+ Gain","").replace("% medical item effectiveness","").trim()),0<=t.indexOf("minutes of maximum medical cooldown")&&(n=t.replace("+ Adds","").replace("minutes of maximum medical cooldown","").trim())})}let i=6+parseInt(n/60);i=i<10?"0"+i:i;let r=n%60;r=r<10?"0"+r:r;var _=i+":"+r+":00";const F=parseInt(t)+parseInt(e)+100;console.log(F);let o=0,s=0,l=0,d=0;console.log(y);var k=function t(e){return a&&e>.7*F?(o+=1,t(e-1.2*F)):e>.4*F?(s+=1,t(e-.7*F)):e>.2*F?(l+=1,t(e-.4*F)):0<e?(d+=1,t(e-.2*F)):e}(y);console.log(k);var $=0==o?"":"大血包*"+o,I=0==s?"":"吗啡*"+s,D=0==l?"":"小蓝包*"+l,S=0==d?"":"小红包*"+d,m=30*o+20*s+15*l+10*d;let c=0,p=0,g=0,h=0;u=function t(e){return a&&e>.15*F?(c+=1,t(e-.3*F)):e>.1*F?(p+=1,t(e-.15*F)):e>.05*F?(g+=1,t(e-.1*F)):0<e?(h+=1,t(e-.05*F)):e}(v);console.log(u);b=0==c?"":"大血包*"+c,y=0==p?"":"吗啡*"+p,k=0==g?"":"小蓝包*"+g,v=0==h?"":"小红包*"+h,u=30*c+20*p+15*g+10*h;C("#nurse-cd").text(`住院时间 ${x} 医疗冷却 ${w}/${_}`),C("#nurse-eff").text(`抽血: ${a} 教育加成: +${t}% 帮派加成: +${e}%`),C("#nurse-item").text(`大血包: -${parseInt(1.2*F)}分钟 吗啡: -${parseInt(.7*F)}分钟 小蓝包: -${parseInt(.4*F)}分钟 小红包: -${parseInt(.2*F)}分钟`),C("#nurse-suggestion").text(`【出院模式】 ${$} ${I} ${D} ${S} (冷却 +${m}分钟)`),C("#nurse-item-life").text(`大血包: 回血+${parseInt(.3*F)}% 吗啡: 回血+${parseInt(.15*F)}% 小蓝包: 回血+${parseInt(.1*F)}% 小红包: 回血+${parseInt(.05*F)}%`),C("#nurse-suggestion-life").text(`【满血模式】 ${b} ${y} ${k} ${v} (冷却 +${u}分钟)`)}}).catch(t=>C("#nurse-cd").text(t)))}function Wt(t){return C(t).find("[bs]").attr("bs")}function Bt(t){return 1e15<=t?"max":1e13<=t?parseInt(t/1e12)+"t":1e12<=t?(t/1e12).toFixed(1)+"t":1e10<=t?parseInt(t/1e9)+"b":1e9<=t?(t/1e9).toFixed(1)+"b":1e7<=t?parseInt(t/1e6)+"m":1e6<=t?(t/1e6).toFixed(1)+"m":1e4<=t?parseInt(t/1e3)+"k":1e3<=t?(t/1e3).toFixed(1)+"k":t}}}();
